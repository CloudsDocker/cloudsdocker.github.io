<!DOCTYPE html>
<html lang=en>
<head><meta name="generator" content="Hexo 3.9.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="Enable Kafka listener annotated endpoints that are created under the covers by a AbstractListenerContainerFactory. To be used on Configuration classes as follows:   @Configuration   @EnableKafka   pub">
<meta property="og:type" content="article">
<meta property="og:title" content="Kafka In Spring">
<meta property="og:url" content="http://www.todzhang.com/2019-09-02-Kafka-In-Spring/index.html">
<meta property="og:site_name" content="Clouds &amp; Docker">
<meta property="og:description" content="Enable Kafka listener annotated endpoints that are created under the covers by a AbstractListenerContainerFactory. To be used on Configuration classes as follows:   @Configuration   @EnableKafka   pub">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-09-03T10:40:06.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Kafka In Spring">
<meta name="twitter:description" content="Enable Kafka listener annotated endpoints that are created under the covers by a AbstractListenerContainerFactory. To be used on Configuration classes as follows:   @Configuration   @EnableKafka   pub">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Kafka In Spring</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/projects_url">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2019-07-07-Kafka/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2019-02-26-TLS-SSL-HTTPS/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://www.todzhang.com/2019-09-02-Kafka-In-Spring/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://www.todzhang.com/2019-09-02-Kafka-In-Spring/&text=Kafka In Spring"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://www.todzhang.com/2019-09-02-Kafka-In-Spring/&title=Kafka In Spring"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://www.todzhang.com/2019-09-02-Kafka-In-Spring/&is_video=false&description=Kafka In Spring"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Kafka In Spring&body=Check out this article: http://www.todzhang.com/2019-09-02-Kafka-In-Spring/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://www.todzhang.com/2019-09-02-Kafka-In-Spring/&title=Kafka In Spring"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://www.todzhang.com/2019-09-02-Kafka-In-Spring/&title=Kafka In Spring"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://www.todzhang.com/2019-09-02-Kafka-In-Spring/&title=Kafka In Spring"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://www.todzhang.com/2019-09-02-Kafka-In-Spring/&title=Kafka In Spring"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://www.todzhang.com/2019-09-02-Kafka-In-Spring/&name=Kafka In Spring&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#flush"><span class="toc-number">1.</span> <span class="toc-text">flush</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Non-Blocking-Async"><span class="toc-number">1.1.</span> <span class="toc-text">Non Blocking (Async).</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Blocking-Sync"><span class="toc-number">1.2.</span> <span class="toc-text">Blocking (Sync).</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KafkaTransactionManager"><span class="toc-number">1.3.</span> <span class="toc-text">KafkaTransactionManager</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Kafka In Spring
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Clouds & Docker</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2019-09-03T10:40:06.000Z" itemprop="datePublished">2019-09-03</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>Enable Kafka listener annotated endpoints that are created under the covers by a AbstractListenerContainerFactory. To be used on Configuration classes as follows:<br>   @Configuration<br>   @EnableKafka<br>   public class AppConfig {<br>       @Bean<br>       public ConcurrentKafkaListenerContainerFactory myKafkaListenerContainerFactory() {<br>           ConcurrentKafkaListenerContainerFactory factory = new ConcurrentKafkaListenerContainerFactory();<br>           factory.setConsumerFactory(consumerFactory());<br>           factory.setConcurrency(4);<br>           return factory;<br>       }<br>       // other @Bean definitions<br>   }</p>
<p>The KafkaListenerContainerFactory is responsible to create the listener container for a particular endpoint. Typical implementations, as the ConcurrentKafkaListenerContainerFactory used in the sample above, provides the necessary configuration options that are supported by the underlying MessageListenerContainer.<br>@EnableKafka enables detection of KafkaListener annotations on any Spring-managed bean in the container. For example, given a class MyService:<br>   package com.acme.foo;</p>
<p>   public class MyService {<br>       @KafkaListener(containerFactory = “myKafkaListenerContainerFactory”, topics = “myTopic”)<br>       public void process(String msg) {<br>           // process incoming message<br>       }<br>   }</p>
<p>The container factory to use is identified by the containerFactory attribute defining the name of the KafkaListenerContainerFactory bean to use. When none is set a KafkaListenerContainerFactory bean with name kafkaListenerContainerFactory is assumed to be present.<br>the following configuration would ensure that every time a message is received from topic “myQueue”, MyService.process() is called with the content of the message:<br>   @Configuration<br>   @EnableKafka<br>   public class AppConfig {<br>       @Bean<br>       public MyService myService() {<br>           return new MyService();<br>       }</p>
<pre><code>// Kafka infrastructure setup</code></pre><p>   }</p>
<p>Alternatively, if MyService were annotated with @Component, the following configuration would ensure that its @KafkaListener annotated method is invoked with a matching incoming message:<br>   @Configuration<br>   @EnableKafka<br>   @ComponentScan(basePackages = “com.acme.foo”)<br>   public class AppConfig {<br>   }</p>
<p>Note that the created containers are not registered with the application context but can be easily located for management purposes using the KafkaListenerEndpointRegistry.<br>Annotated methods can use a flexible signature; in particular, it is possible to use the Message abstraction and related annotations, see KafkaListener Javadoc for more details. For instance, the following would inject the content of the message and the kafka partition header:<br>   @KafkaListener(containerFactory = “myKafkaListenerContainerFactory”, topics = “myTopic”)<br>   public void process(String msg, @Header(“kafka_partition”) int partition) {<br>       // process incoming message<br>   }</p>
<p>These features are abstracted by the MessageHandlerMethodFactory that is responsible to build the necessary invoker to process the annotated method. By default, DefaultMessageHandlerMethodFactory is used.<br>When more control is desired, a @Configuration class may implement KafkaListenerConfigurer. This allows access to the underlying KafkaListenerEndpointRegistrar instance. The following example demonstrates how to specify an explicit default KafkaListenerContainerFactory<br>   {<br>       @code<br>       @Configuration<br>       @EnableKafka<br>       public class AppConfig implements KafkaListenerConfigurer {<br>           @Override<br>           public void configureKafkaListeners(KafkaListenerEndpointRegistrar registrar) {<br>               registrar.setContainerFactory(myKafkaListenerContainerFactory());<br>           }</p>
<pre><code>    @Bean
    public KafkaListenerContainerFactory&lt;?, ?&gt; myKafkaListenerContainerFactory() {
        // factory settings
    }

    @Bean
    public MyService myService() {
        return new MyService();
    }
}</code></pre><p>   }</p>
<p>It is also possible to specify a custom KafkaListenerEndpointRegistry in case you need more control on the way the containers are created and managed. The example below also demonstrates how to customize the org.springframework.messaging.handler.annotation.support.DefaultMessageHandlerMethodFactory as well as how to supply a custom Validator so that payloads annotated with Validated are first validated against a custom Validator.<br>   {<br>       @code<br>       @Configuration<br>       @EnableKafka<br>       public class AppConfig implements KafkaListenerConfigurer {<br>           @Override<br>           public void configureKafkaListeners(KafkaListenerEndpointRegistrar registrar) {<br>               registrar.setEndpointRegistry(myKafkaListenerEndpointRegistry());<br>               registrar.setMessageHandlerMethodFactory(myMessageHandlerMethodFactory);<br>               registrar.setValidator(new MyValidator());<br>           }</p>
<pre><code>    @Bean
    public KafkaListenerEndpointRegistry myKafkaListenerEndpointRegistry() {
        // registry configuration
    }

    @Bean
    public MessageHandlerMethodFactory myMessageHandlerMethodFactory() {
        DefaultMessageHandlerMethodFactory factory = new DefaultMessageHandlerMethodFactory();
        // factory configuration
        return factory;
    }

    @Bean
    public MyService myService() {
        return new MyService();
    }
}</code></pre><p>   }</p>
<p>Implementing KafkaListenerConfigurer also allows for fine-grained control over endpoints registration via the KafkaListenerEndpointRegistrar. For example, the following configures an extra endpoint:<br>   {<br>       @code<br>       @Configuration<br>       @EnableKafka<br>       public class AppConfig implements KafkaListenerConfigurer {<br>           @Override<br>           public void configureKafkaListeners(KafkaListenerEndpointRegistrar registrar) {<br>               SimpleKafkaListenerEndpoint myEndpoint = new SimpleKafkaListenerEndpoint();<br>               // … configure the endpoint<br>               registrar.registerEndpoint(endpoint, anotherKafkaListenerContainerFactory());<br>           }</p>
<pre><code>    @Bean
    public MyService myService() {
        return new MyService();
    }

    @Bean
    public KafkaListenerContainerFactory&lt;?, ?&gt; anotherKafkaListenerContainerFactory() {
        // ...
    }

    // Kafka infrastructure setup
}</code></pre><p>   }</p>
<p>Note that all beans implementing KafkaListenerConfigurer will be detected and invoked in a similar fashion. The example above can be translated in a regular bean definition registered in the context in case you use the XML configuration.<br>See Also:<br>KafkaListener, KafkaListenerAnnotationBeanPostProcessor, org.springframework.kafka.config.KafkaListenerEndpointRegistrar, org.springframework.kafka.config.KafkaListenerEndpointRegistry<br>  spring-kafka-dist.spring-kafka.main</p>
<h1 id="flush"><a href="#flush" class="headerlink" title="flush"></a>flush</h1><p>If you wish to block the sending thread, to await the result, you can invoke the future’s get() method. You may wish to invoke flush() before waiting or, for convenience, the template has a constructor with an autoFlush parameter which will cause the template to flush() on each send. Note, however that flushing will likely significantly reduce performance.</p>
<h2 id="Non-Blocking-Async"><a href="#Non-Blocking-Async" class="headerlink" title="Non Blocking (Async)."></a>Non Blocking (Async).</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendToKafka</span><span class="params">(<span class="keyword">final</span> MyOutputData data)</span> </span>&#123;</span><br><span class="line"><span class="keyword">final</span> ProducerRecord&lt;String, String&gt; record = createRecord(data);</span><br><span class="line">ListenableFuture&lt;SendResult&lt;Integer, String&gt;&gt; future = template.send(record); future.addCallback(<span class="keyword">new</span> ListenableFutureCallback&lt;SendResult&lt;Integer, String&gt;&gt;() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(SendResult&lt;Integer, String&gt; result)</span> </span>&#123; handleSuccess(data);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Throwable ex)</span> </span>&#123; handleFailure(data, record, ex);</span><br><span class="line">&#125;</span><br><span class="line">&#125;); &#125;</span><br></pre></td></tr></table></figure>

<h2 id="Blocking-Sync"><a href="#Blocking-Sync" class="headerlink" title="Blocking (Sync)."></a>Blocking (Sync).</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendToKafka</span><span class="params">(<span class="keyword">final</span> MyOutputData data)</span> </span>&#123;</span><br><span class="line"><span class="keyword">final</span> ProducerRecord&lt;String, String&gt; record = createRecord(data);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">template.send(record).get(<span class="number">10</span>, TimeUnit.SECONDS); handleSuccess(data);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (ExecutionException e) &#123;</span><br><span class="line">        handleFailure(data, record, e.getCause());</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">catch</span> (TimeoutException | InterruptedException e) &#123; handleFailure(data, record, e);</span><br><span class="line">&#125; &#125;</span><br></pre></td></tr></table></figure>

<h2 id="KafkaTransactionManager"><a href="#KafkaTransactionManager" class="headerlink" title="KafkaTransactionManager"></a>KafkaTransactionManager</h2><p>The <code>KafkaTransactionManager</code> is an implementation of Spring Framework’s <code>PlatformTransactionManager</code>;</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/projects_url">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#flush"><span class="toc-number">1.</span> <span class="toc-text">flush</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Non-Blocking-Async"><span class="toc-number">1.1.</span> <span class="toc-text">Non Blocking (Async).</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Blocking-Sync"><span class="toc-number">1.2.</span> <span class="toc-text">Blocking (Sync).</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KafkaTransactionManager"><span class="toc-number">1.3.</span> <span class="toc-text">KafkaTransactionManager</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://www.todzhang.com/2019-09-02-Kafka-In-Spring/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://www.todzhang.com/2019-09-02-Kafka-In-Spring/&text=Kafka In Spring"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://www.todzhang.com/2019-09-02-Kafka-In-Spring/&title=Kafka In Spring"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://www.todzhang.com/2019-09-02-Kafka-In-Spring/&is_video=false&description=Kafka In Spring"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Kafka In Spring&body=Check out this article: http://www.todzhang.com/2019-09-02-Kafka-In-Spring/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://www.todzhang.com/2019-09-02-Kafka-In-Spring/&title=Kafka In Spring"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://www.todzhang.com/2019-09-02-Kafka-In-Spring/&title=Kafka In Spring"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://www.todzhang.com/2019-09-02-Kafka-In-Spring/&title=Kafka In Spring"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://www.todzhang.com/2019-09-02-Kafka-In-Spring/&title=Kafka In Spring"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://www.todzhang.com/2019-09-02-Kafka-In-Spring/&name=Kafka In Spring&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2020 Todd Zhang
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/projects_url">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

    <!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
