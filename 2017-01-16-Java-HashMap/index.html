<!DOCTYPE html>
<html lang=en>
<head><meta name="generator" content="Hexo 3.9.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="Hashmap in JDKSome note worth points about hashmap Lookup process Step# 1: Quickly determine the bucket number in which this element may reside (using key.hashCode()). Step# 2: Go over the mini-list a">
<meta name="keywords" content="java">
<meta property="og:type" content="article">
<meta property="og:title" content="HashMap in JDK">
<meta property="og:url" content="http://www.todzhang.com/2017-01-16-Java-HashMap/index.html">
<meta property="og:site_name" content="Clouds &amp; Docker">
<meta property="og:description" content="Hashmap in JDKSome note worth points about hashmap Lookup process Step# 1: Quickly determine the bucket number in which this element may reside (using key.hashCode()). Step# 2: Go over the mini-list a">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-05-31T13:03:27.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="HashMap in JDK">
<meta name="twitter:description" content="Hashmap in JDKSome note worth points about hashmap Lookup process Step# 1: Quickly determine the bucket number in which this element may reside (using key.hashCode()). Step# 2: Go over the mini-list a">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>HashMap in JDK</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/projects_url">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2017-01-02-Enum-Misc/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2017-01-03-IntelliJ-Tips/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://www.todzhang.com/2017-01-16-Java-HashMap/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://www.todzhang.com/2017-01-16-Java-HashMap/&text=HashMap in JDK"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://www.todzhang.com/2017-01-16-Java-HashMap/&title=HashMap in JDK"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://www.todzhang.com/2017-01-16-Java-HashMap/&is_video=false&description=HashMap in JDK"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=HashMap in JDK&body=Check out this article: http://www.todzhang.com/2017-01-16-Java-HashMap/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://www.todzhang.com/2017-01-16-Java-HashMap/&title=HashMap in JDK"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://www.todzhang.com/2017-01-16-Java-HashMap/&title=HashMap in JDK"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://www.todzhang.com/2017-01-16-Java-HashMap/&title=HashMap in JDK"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://www.todzhang.com/2017-01-16-Java-HashMap/&title=HashMap in JDK"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://www.todzhang.com/2017-01-16-Java-HashMap/&name=HashMap in JDK&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Hashmap-in-JDK"><span class="toc-number">1.</span> <span class="toc-text">Hashmap in JDK</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Some-note-worth-points-about-hashmap"><span class="toc-number">1.1.</span> <span class="toc-text">Some note worth points about hashmap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WeakReferenceMap-SoftReference-Map-etc"><span class="toc-number">1.2.</span> <span class="toc-text">WeakReferenceMap, SoftReference Map etc.</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Source-code-analysis"><span class="toc-number">1.3.</span> <span class="toc-text">Source code analysis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Internal-data-structure"><span class="toc-number">1.3.1.</span> <span class="toc-text">Internal data structure</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Put"><span class="toc-number">1.3.2.</span> <span class="toc-text">Put</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#V-putImpl-K-key-V-value"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">V putImpl(K key, V value)</span></a></li></ol></li></ol></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  

  <div class="content" itemprop="articleBody">
      
          <h1 id="Hashmap-in-JDK"><a href="#Hashmap-in-JDK" class="headerlink" title="Hashmap in JDK"></a>Hashmap in JDK</h1><h2 id="Some-note-worth-points-about-hashmap"><a href="#Some-note-worth-points-about-hashmap" class="headerlink" title="Some note worth points about hashmap"></a>Some note worth points about hashmap</h2><ul>
<li>Lookup process<ul>
<li>Step# 1: Quickly determine the bucket number in which this element may reside (using key.hashCode()).</li>
<li>Step# 2: Go over the mini-list and return the element that matches the key (using key.equals()).</li>
</ul>
</li>
<li>Immutability of keys</li>
<li>In Node&lt;K,V&gt; node of hashMap, besides key, value, hash, there is Node next link inside. So undelrying table is a linked list.</li>
<li>For <strong>get()</strong>, firstly using hashcode calculation, divide by bucket number and get reminder, to locate the bucket, then compare key via “.euqals()”, if matched, the value will be returned.</li>
<li>Load factor and resize<br>When new hashHap is being populated, the linkedList associated with each bucket of source hashMap is iterated and nodes are copied to the destination bucket. However, note that these new nodes are prepended to the head of the destination linkedList. So resizing has an side effect of reversing the order of the items in the list. Default load factor for hashMap is 0.75.</li>
<li>Worst-case performance:<br>In the worst case, a hashMap reduces to a linkedList.<br>However with Java 8, there is a change,<br>Java 8 intelligently determines if we are running in the worst-case performance scenario and converts the list into a binary search tree.</li>
<li>Collisions<br>Collisions happen when 2 distinct keys generate the same hashCode() value. Multiple collisions are the result of bad hashCode() algorithm.There are many collision-resolution strategies - chaining, double-hashing, clustering.<br>However, java has chosen chaining strategy for hashMap, so in case of collisions, items are chained together just like in a linkedList.</li>
<li>Some specialized hashMaps for specific purposes:</li>
<li><ul>
<li>ConcurrentHashMap: HashMap to be used in multithreaded applications.</li>
</ul>
</li>
<li><ul>
<li>EnumMap: HashMap with Enum values as keys.</li>
</ul>
</li>
<li><ul>
<li>LinkedHashMap: HashMap with predictable iteration order (great for FIFO/LIFO caches)</li>
</ul>
</li>
</ul>
<h2 id="WeakReferenceMap-SoftReference-Map-etc"><a href="#WeakReferenceMap-SoftReference-Map-etc" class="headerlink" title="WeakReferenceMap, SoftReference Map etc."></a>WeakReferenceMap, SoftReference Map etc.</h2><p>Weak references (a WeakHashMap) aren’t particularly good for this either, because as the elements in the cache become dereferenced by the application code they will quickly be removed from the cache by the garbage collector. This basically means there will be cache faults often (in other words, the cache lookups will fail).</p>
<p>Soft references can be very handy in situations such as this. Because soft references only exist if the memory is available, they can make very effective use of the space that is available. Unfortunately, although there is a WeakHashMap , there is no java.util.SoftHashMap . Why? I’m not really sure. Thankfully, a little trip back over to Jakarta-Commons-Collections digs up the org.apache.commons.collections.map.ReferenceMap .</p>
<p>SoftReferences are typically used for implementing memory caching. The JVM should try to keep softly referenced objects in memory as long as possible, and when memory is low clear the oldest soft references first. According to the JavaDoc, there are no guarantees though.</p>
<p>WeakReferences is the reference type I use most frequently. It’s typically used when you want weak listeners or if you want to connect additional information to an object (using WeakHashMap for example). Very useful stuff when you want to reduce class coupling. </p>
<p>Phantom references can be used to perform pre-garbage collection actions such as freeing resources. Instead, people usually use the finalize() method for this which is not a good idea. Finalizers have a horrible impact on the performance of the garbage collector and can break data integrity of your application if you’re not very careful since the “finalizer” is invoked in a random thread, at a random time.</p>
<p>In the constructor of a phantom reference, you specify a ReferenceQueue where the phantom references are enqueued once the referenced objects becomes “phantom reachable”. Phantom reachable means unreachable other than through the phantom reference. The initially confusing thing is that although the phantom reference continues to hold the referenced object in a private field (unlike soft or weak references), its getReference() method always returns null. This is so that you cannot make the object strongly reachable again.</p>
<p>From time to time, you can poll the ReferenceQueue and check if there are any new PhantomReferences whose referenced objects have become phantom reachable. In order to be able to to anything useful, one can for example derive a class from java.lang.ref.PhantomReference that references resources that should be freed before garbage collection. The referenced object is only garbage collected once the phantom reference becomes unreachable itself. </p>
<h2 id="Source-code-analysis"><a href="#Source-code-analysis" class="headerlink" title="Source code analysis"></a>Source code analysis</h2><h3 id="Internal-data-structure"><a href="#Internal-data-structure" class="headerlink" title="Internal data structure"></a>Internal data structure</h3><ul>
<li>transient Entry&lt;K, V&gt;[] elementData;</li>
<li>transient int modCount = 0;</li>
<li>private transient V[] cache;</li>
</ul>
<h3 id="Put"><a href="#Put" class="headerlink" title="Put"></a>Put</h3><p>It will call return putImpl(key, value); directly</p>
<h4 id="V-putImpl-K-key-V-value"><a href="#V-putImpl-K-key-V-value" class="headerlink" title="V putImpl(K key, V value)"></a>V putImpl(K key, V value)</h4><ul>
<li>if(key == null)</li>
<li><ul>
<li>entry = findNullKeyEntry();<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">entry = findNullKeyEntry();</span><br><span class="line">            <span class="keyword">if</span> (entry == <span class="keyword">null</span>) &#123;</span><br><span class="line">                modCount++;</span><br><span class="line">                entry = createHashedEntry(<span class="keyword">null</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                <span class="keyword">if</span> (++elementCount &gt; threshold) &#123;</span><br><span class="line">                    rehash();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<p>— findNullKeyEntry<br>Iterate the internal array to locate null entry</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> Entry&lt;K,V&gt; <span class="title">findNullKeyEntry</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Entry&lt;K,V&gt; m = elementData[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">while</span> (m != <span class="keyword">null</span> &amp;&amp; m.key != <span class="keyword">null</span>) &#123;</span><br><span class="line">            m = m.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> m;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>else (if key is not null)</li>
</ul>

        
  </div>
</article>

        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/projects_url">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Hashmap-in-JDK"><span class="toc-number">1.</span> <span class="toc-text">Hashmap in JDK</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Some-note-worth-points-about-hashmap"><span class="toc-number">1.1.</span> <span class="toc-text">Some note worth points about hashmap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WeakReferenceMap-SoftReference-Map-etc"><span class="toc-number">1.2.</span> <span class="toc-text">WeakReferenceMap, SoftReference Map etc.</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Source-code-analysis"><span class="toc-number">1.3.</span> <span class="toc-text">Source code analysis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Internal-data-structure"><span class="toc-number">1.3.1.</span> <span class="toc-text">Internal data structure</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Put"><span class="toc-number">1.3.2.</span> <span class="toc-text">Put</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#V-putImpl-K-key-V-value"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">V putImpl(K key, V value)</span></a></li></ol></li></ol></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://www.todzhang.com/2017-01-16-Java-HashMap/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://www.todzhang.com/2017-01-16-Java-HashMap/&text=HashMap in JDK"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://www.todzhang.com/2017-01-16-Java-HashMap/&title=HashMap in JDK"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://www.todzhang.com/2017-01-16-Java-HashMap/&is_video=false&description=HashMap in JDK"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=HashMap in JDK&body=Check out this article: http://www.todzhang.com/2017-01-16-Java-HashMap/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://www.todzhang.com/2017-01-16-Java-HashMap/&title=HashMap in JDK"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://www.todzhang.com/2017-01-16-Java-HashMap/&title=HashMap in JDK"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://www.todzhang.com/2017-01-16-Java-HashMap/&title=HashMap in JDK"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://www.todzhang.com/2017-01-16-Java-HashMap/&title=HashMap in JDK"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://www.todzhang.com/2017-01-16-Java-HashMap/&name=HashMap in JDK&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2020 Todd Zhang
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/projects_url">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

    <!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
