<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Ansible | My New Hugo Site</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.73.0" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.4fc0b62e4b82c997bb0041217cd6b979.css" rel="stylesheet">
    

    

    
      

    

    
    
    <meta property="og:title" content="Ansible" />
<meta property="og:description" content="Ansible: What Is It Good For? Ansible is often described as a configuration management tool, and is typically mentioned in the same breath as Chef, Puppet, and Salt. When we talk about configuration management, we are typically talking about writing some kind of state description for our servers, and then using a tool to enforce that the servers are, indeed, in that state: the right packages are installed, configuration files contain the expected values and have the expected permissions, the right services are running, and so on." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://example.org/posts/2018-06-21-ansible/" />

<meta itemprop="name" content="Ansible">
<meta itemprop="description" content="Ansible: What Is It Good For? Ansible is often described as a configuration management tool, and is typically mentioned in the same breath as Chef, Puppet, and Salt. When we talk about configuration management, we are typically talking about writing some kind of state description for our servers, and then using a tool to enforce that the servers are, indeed, in that state: the right packages are installed, configuration files contain the expected values and have the expected permissions, the right services are running, and so on.">

<meta itemprop="wordCount" content="2205">



<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Ansible"/>
<meta name="twitter:description" content="Ansible: What Is It Good For? Ansible is often described as a configuration management tool, and is typically mentioned in the same breath as Chef, Puppet, and Salt. When we talk about configuration management, we are typically talking about writing some kind of state description for our servers, and then using a tool to enforce that the servers are, indeed, in that state: the right packages are installed, configuration files contain the expected values and have the expected permissions, the right services are running, and so on."/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        My New Hugo Site
      
    </a>
    <div class="flex-l items-center">
      

      
      















    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        POSTS
      </aside>
      




  <div id="sharing" class="mt3">

    
    <a href="https://www.facebook.com/sharer.php?u=http://example.org/posts/2018-06-21-ansible/" class="facebook no-underline" aria-label="share on Facebook">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765,50.32h6.744V33.998h4.499l0.596-5.624h-5.095  l0.007-2.816c0-1.466,0.14-2.253,2.244-2.253h2.812V17.68h-4.5c-5.405,0-7.307,2.729-7.307,7.317v3.377h-3.369v5.625h3.369V50.32z   M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;"/></svg>

    </a>

    
    
    <a href="https://twitter.com/share?url=http://example.org/posts/2018-06-21-ansible/&amp;text=Ansible" class="twitter no-underline" aria-label="share on Twitter">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

    </a>

    
    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http://example.org/posts/2018-06-21-ansible/&amp;title=Ansible" class="linkedin no-underline" aria-label="share on LinkedIn">
      <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

    </a>
  </div>


      <h1 class="f1 athelas mt3 mb1">Ansible</h1>
      
      
      <time class="f6 mv4 dib tracked" datetime="0001-01-01T00:00:00Z">January 1, 0001</time>

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><h1 id="ansible-what-is-it-good-for">Ansible: What Is It Good For?</h1>
<p>Ansible is often described as a configuration management tool, and is typically mentioned in the same breath as Chef, Puppet, and Salt. When we talk about configuration management, we are typically talking about writing some kind of state description for our servers, and then using a tool to enforce that the servers are, indeed, in that state: the right packages are installed, configuration files contain the expected values and have the expected permissions, the right services are running, and so on. Like other configuration management tools, Ansible exposes a domain-specific language (DSL) that you use to describe the state of your servers.</p>
<p>These tools also can be used for doing deployment as well. When people talk about deployment, they are usually referring to the process of taking software that was written in-house, generating binaries or static assets (if necessary), copying the required files to the server(s), and then starting up the services. Capistrano and Fabric are two examples of open-source deployment tools. Ansible is a great tool for doing deployment as well as configuration management. Using a single tool for both configuration management and deployment makes life simpler for the folks responsible for operations.</p>
<p>Some people talk about the need for orchestration of deployment. This is where multiple remote servers are involved, and things have to happen in a specific order. For example, you need to bring up the database before bringing up the web servers, or you need to take web servers out of the load balancer one at a time in order to upgrade them without downtime. Ansible’s good at this as well, and is designed from the ground up for performing actions on multiple servers. Ansible has a refreshingly simple model for controlling the order that actions happen in.</p>
<p>Finally, you’ll hear people talk about provisioning new servers. In the context of public clouds such as Amazon EC2, this refers to spinning up a new virtual machine instance. Ansible’s got you covered here, with a number of modules for talking to clouds, including EC2, Azure, Digital Ocean, Google Compute Engine, Linode, and Rackspace, as well as any clouds that support the OpenStack APIs.</p>
<h1 id="architecture">Architecture</h1>
<p>As with most configuration management software, Ansible has two types of servers: controlling machines and nodes. First, there is a single controlling machine which is where orchestration begins. Nodes are managed by a controlling machine over SSH. The controlling machine describes the location of nodes through its inventory.</p>
<h2 id="agentless">Agentless</h2>
<p>In contrast with popular configuration management software — such as Chef, Puppet, and CFEngine — Ansible uses an agentless architecture.[14] With an agent-based architecture, nodes must have a locally installed daemon that communicates with a controlling machine. With an agentless architecture, nodes are not required to install and run background daemons to connect with a controlling machine. This type of architecture reduces the overhead on the network by preventing the nodes from polling the controlling machine.</p>
<h2 id="playbook">Playbook</h2>
<p>Playbooks are Ansible’s configuration, deployment, and orchestration language. They can describe a policy you want your remote systems to enforce, or a set of steps in a general IT process.</p>
<p>I like to think of <code>Ansible playbooks as executable documentation</code>. It’s like the README file that describes the commands you had to type out to deploy your software, except that the instructions will never go out-of-date because they are also the code that gets executed directly.</p>
<p>If Ansible modules are the tools in your workshop, playbooks are your instruction manuals, and your inventory of hosts are your raw material.</p>
<p>In Ansible, a script is called a playbook. A playbook describes which hosts (what Ansible calls remote servers) to configure, and an ordered list of tasks to perform on those hosts.</p>
<p>To execute the playbook using the ansible-playbook command. In the example, the playbook is named webservers.yml, and is executed by typing:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ansible-playbook webservers.yml
</code></pre></div><p>Ansible will make SSH connections in parallel to web1, web2, and web3. It will execute the first task on the list on all three hosts simultaneously. In this example, the first task is installing the nginx apt package (since Ubuntu uses the apt package manager), so the task in the playbook would look something like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">- <span style="color:#66d9ef">name</span>: install nginx
  <span style="color:#66d9ef">apt</span>: name=nginx
</code></pre></div><p>Ansible will:</p>
<ol>
<li>Generate a Python script that installs the nginx package.</li>
<li>Copy the script to web1, web2, and web3.</li>
<li>Execute the script on web1, web2, web3.</li>
<li>Wait for the script to complete execution on all hosts.</li>
</ol>
<p>Ansible will then move to the next task in the list, and go through these same four steps. It’s important to note that:</p>
<ul>
<li>Ansible runs each task in parallel across all hosts.</li>
<li>Ansible waits until all hosts have completed a task before moving to the next task.</li>
<li>Ansible runs the tasks in the order that you specify them.</li>
</ul>
<h2 id="variable">Variable</h2>
<p>Variable names should be letters, numbers, and underscores. Variables should always start with a letter.</p>
<p>foo_port is a great variable. foo5 is fine too.
foo-port, foo port, foo.port and 12 are not valid variable names.</p>
<p>Defining Variables in Playbooks
The simplest way to define variables is to put a vars section in your playbook with the names and values of variables.</p>
<p>Ansible also allows you to put variables into one or more files, using a section called vars_files.</p>
<p>We would replace the vars section with a vars_files that looks like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">vars_files</span>:
 - nginx.yml


<span style="color:#75715e">## nginx.yml</span>
<span style="color:#66d9ef">key_file</span>: /etc/nginx/ssl/nginx.key
<span style="color:#66d9ef">cert_file</span>: /etc/nginx/ssl/nginx.crt
<span style="color:#66d9ef">conf_file</span>: /etc/nginx/sites-available/default
<span style="color:#66d9ef">server_name</span>: localhost
</code></pre></div><h3 id="to-debug-variable">To debug variable</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">- <span style="color:#66d9ef">debug</span>: var=myvarname
</code></pre></div><h2 id="registering-variables">Registering Variables</h2>
<p>Often, you’ll find that you need to set the value of a variable based on the result of a task. To do so, we create a registered variable using the register clause when invoking a module.</p>
<p>In order to use the login variable later, we need to know what type of value to expect. The value of a variable set using the register clause is always a dictionary, but the specific keys of the dictionary are different, depending on the module that was invoked.</p>
<p>ACCESSING DICTIONARY KEYS IN A VARIABLE
If a variable contains a dictionary, then you can access the keys of the dictionary using either a dot (.) or a subscript ([]).</p>
<h3 id="facts">facts</h3>
<p>When Ansible gathers facts, it connects to the host and queries the host for all kinds of details about the host: CPU architecture, operating system, IP addresses, memory info, disk info, and more. This information is stored in variables that are called facts, and they behave just like any other variable does.</p>
<p>Here’s a simple playbook that will print out the operating system of each server:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">- <span style="color:#66d9ef">name</span>: print out operating system
  <span style="color:#66d9ef">hosts</span>: all
  <span style="color:#66d9ef">gather_facts</span>: True
  <span style="color:#66d9ef">tasks</span>:
  - <span style="color:#66d9ef">debug</span>: var=ansible_distribution
</code></pre></div><p>Viewing All Facts Associated with a Server
Ansible implements fact collecting through the use of a special module called the setup module. You don’t need to call this module in your playbooks because Ansible does that automatically when it gathers facts. However, if you invoke it manually with the ansible command-line tool, like this:</p>
<p>$ ansible server1 -m setup</p>
<h2 id="interactive-mode">interactive mode</h2>
<p>If Ansible did not succeed, add the -vvvv flag to see more details about the error:</p>
<p>$ ansible testserver -i hosts -m ping -vvvv</p>
<p>We can see that the module succeeded. The &ldquo;changed&rdquo;: false part of the output tells us that executing the module did not change the state of the server. The &ldquo;ping&rdquo;: &ldquo;pong&rdquo; text is output that is specific to the ping module.</p>
<h2 id="simplifying-with-the-ansiblecfg-file">Simplifying with the ansible.cfg File</h2>
<p>We had to type a lot of text in the inventory file to tell Ansible about our test server. Fortunately, Ansible has a number of ways you can specify these sorts of variables so we don’t have to put them all in one place.</p>
<p>Right now, we’ll use one such mechanism, the ansible.cfg file, to set some defaults so we don’t need to type as much.</p>
<h3 id="where-should-i-put-my-ansiblecfg-file">WHERE SHOULD I PUT MY ANSIBLE.CFG FILE?</h3>
<p>Ansible looks for an ansible.cfg file in the following places, in this order:</p>
<p>File specified by the ANSIBLE_CONFIG environment variable</p>
<p>./ansible.cfg (ansible.cfg in the current directory)</p>
<p>~/.ansible.cfg (.ansible.cfg in your home directory)</p>
<p>/etc/ansible/ansible.cfg</p>
<p>I typically put an ansible.cfg in the current directory, alongside my playbooks. That way, I can check it into the same version control repository my playbooks are in.</p>
<h2 id="run-command-remotely">Run command remotely</h2>
<p>I like to use the ansible command-line tool to run arbitrary commands on remote machines, like parallel SSH. You can execute arbitrary commands with the command module. When invoking this module, you also need to pass an argument to the module with the -a flag, which is the command to run.</p>
<p>For example, to check the uptime of our server, we can use:</p>
<p>$ ansible testserver -m command -a uptime</p>
<p>The command module is so commonly used that it’s the default module, so we can omit it:</p>
<p>$ ansible testserver -a uptime
$ ansible testserver -a &ldquo;tail /var/log/dmesg&rdquo;</p>
<h3 id="inventory">inventory</h3>
<p>WARNING
Although Ansible adds the localhost to your inventory automatically, you have to have at least one other host in your inventory file; otherwise, ansible-playbook will terminate with the error:</p>
<p>ERROR: provided hosts list is empty</p>
<h3 id="property-changed">property &ldquo;Changed&rdquo;</h3>
<p>The changed key is present in the return value of all Ansible modules, and Ansible uses it to determine whether a state change has occurred. For the command and shell module, this will always be set to true unless overridden with the changed_when clause</p>
<h2 id="ignore-error">ignore error</h2>
<p>Ignoring when a module returns an error</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">- <span style="color:#66d9ef">name</span>: Run myprog
  <span style="color:#66d9ef">command</span>: /opt/myprog
  <span style="color:#66d9ef">register</span>: result
  <span style="color:#66d9ef">ignore_errors</span>: True
- <span style="color:#66d9ef">debug</span>: var=result
</code></pre></div><h2 id="data-type">Data type</h2>
<p>All members of a list are lines beginning at the same indentation level starting with a &ldquo;- &quot; (a dash and a space):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">---
<span style="color:#75715e"># A list of tasty fruits</span>
<span style="color:#66d9ef">fruits</span>:
    - Apple
    - Orange
    - Strawberry
    - Mango
...
</code></pre></div><p>A dictionary is represented in a simple key: value form (the colon must be followed by a space):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#75715e"># An employee record</span>
<span style="color:#66d9ef">martin</span>:
    <span style="color:#66d9ef">name</span>: Martin D&#39;vloper
    <span style="color:#66d9ef">job</span>: Developer
    <span style="color:#66d9ef">skill</span>: Elite
</code></pre></div><p>More complicated data structures are possible, such as lists of dictionaries, dictionaries whose values are lists or a mix of both:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#75715e"># Employee records</span>
-  <span style="color:#66d9ef">martin</span>:
    <span style="color:#66d9ef">name</span>: Martin D&#39;vloper
    <span style="color:#66d9ef">job</span>: Developer
    <span style="color:#66d9ef">skills</span>:
      - python
      - perl
      - pascal
-  <span style="color:#66d9ef">tabitha</span>:
    <span style="color:#66d9ef">name</span>: Tabitha Bitumen
    <span style="color:#66d9ef">job</span>: Developer
    <span style="color:#66d9ef">skills</span>:
      - lisp
      - fortran
      - erlang
</code></pre></div><p>Dictionaries and lists can also be represented in an abbreviated form if you really want to:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">---
<span style="color:#66d9ef">martin</span>: {<span style="color:#66d9ef">name: Martin D&#39;vloper, job: Developer, skill</span>: Elite}
<span style="color:#66d9ef">fruits</span>: [<span style="color:#e6db74">&#39;Apple&#39;</span>, <span style="color:#e6db74">&#39;Orange&#39;</span>, <span style="color:#e6db74">&#39;Strawberry&#39;</span>, <span style="color:#e6db74">&#39;Mango&#39;</span>]
</code></pre></div><p>These are called “Flow collections”.</p>
<h3 id="span-multiple-lines">span multiple lines</h3>
<p>Values can span multiple lines using | or &gt;. Spanning multiple lines using a “Literal Block Scalar” | will include the newlines and any trailing spaces. Using a “Folded Block Scalar” &gt; will fold newlines to spaces; it’s used to make what would otherwise be a very long line easier to read and edit. In either case the indentation will be ignored. Examples are:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">include_newlines</span>: <span style="color:#e6db74">|
</span><span style="color:#e6db74">            exactly as you see</span>
            will appear these three
            lines of poetry

<span style="color:#66d9ef">fold_newlines</span>: <span style="color:#e6db74">&gt;
</span><span style="color:#e6db74">            this is really a</span>
            single line of text
            despite appearances
</code></pre></div><h1 id="commands">commands</h1>
<h2 id="file">file</h2>
<p>file - Sets attributes of files</p>
<p>Sets attributes of files, symlinks, and directories, or removes files/symlinks/directories. Many other modules support the same options as the file module - including copy, template, and assemble.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#75715e"># change file ownership, group and mode. When specifying mode using octal numbers, first digit should always be 0.</span>
- <span style="color:#66d9ef">file</span>:
    <span style="color:#66d9ef">path</span>: /etc/foo.conf
    <span style="color:#66d9ef">owner</span>: foo
    <span style="color:#66d9ef">group</span>: foo
    <span style="color:#66d9ef">mode</span>: <span style="color:#ae81ff">0644</span>
- <span style="color:#66d9ef">file</span>:
    <span style="color:#66d9ef">path</span>: /work
    <span style="color:#66d9ef">owner</span>: root
    <span style="color:#66d9ef">group</span>: root
    <span style="color:#66d9ef">mode</span>: <span style="color:#ae81ff">01777</span>
</code></pre></div><h2 id="delegation">delegation</h2>
<p>This isn’t actually rolling update specific but comes up frequently in those cases.</p>
<p>If you want to perform a task on one host with reference to other hosts, use the ‘delegate_to’ keyword on a task. This is ideal for placing nodes in a load balanced pool, or removing them. It is also very useful for controlling outage windows. Be aware that it does not make sense to delegate all tasks, debug, add_host, include, etc always get executed on the controller. Using this with the ‘serial’ keyword to control the number of hosts executing at one time is also a good idea:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">---

- <span style="color:#66d9ef">hosts</span>: webservers
  <span style="color:#66d9ef">serial</span>: <span style="color:#ae81ff">5</span>

  <span style="color:#66d9ef">tasks</span>:

  - <span style="color:#66d9ef">name</span>: take out of load balancer pool
    <span style="color:#66d9ef">command</span>: /usr/bin/take_out_of_pool {{ inventory_hostname }}
    <span style="color:#66d9ef">delegate_to</span>: <span style="color:#ae81ff">127.0.0.1</span>

  - <span style="color:#66d9ef">name</span>: actual steps would go here
    <span style="color:#66d9ef">yum</span>:
      <span style="color:#66d9ef">name</span>: acme-web-stack
      <span style="color:#66d9ef">state</span>: latest

  - <span style="color:#66d9ef">name</span>: add back to load balancer pool
    <span style="color:#66d9ef">command</span>: /usr/bin/add_back_to_pool {{ inventory_hostname }}
    <span style="color:#66d9ef">delegate_to</span>: <span style="color:#ae81ff">127.0.0.1</span>
</code></pre></div><p>These commands will run on 127.0.0.1, which is the machine running Ansible. There is also a shorthand syntax that you can use on a per-task basis: ‘local_action’. Here is the same playbook as above, but using the shorthand syntax for delegating to 127.0.0.1:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">---

<span style="color:#75715e"># ...</span>

  <span style="color:#66d9ef">tasks</span>:

  - <span style="color:#66d9ef">name</span>: take out of load balancer pool
    <span style="color:#66d9ef">local_action</span>: command /usr/bin/take_out_of_pool {{ inventory_hostname }}

<span style="color:#75715e"># ...</span>

  - <span style="color:#66d9ef">name</span>: add back to load balancer pool
    <span style="color:#66d9ef">local_action</span>: command /usr/bin/add_back_to_pool {{ inventory_hostname }}
</code></pre></div><p>A common pattern is to use a local action to call ‘rsync’ to recursively copy files to the managed servers. Here is an example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">---
<span style="color:#75715e"># ...</span>
  <span style="color:#66d9ef">tasks</span>:

  - <span style="color:#66d9ef">name</span>: recursively copy files from management server to target
    <span style="color:#66d9ef">local_action</span>: command rsync -a /path/to/files {{ inventory_hostname }}:/path/to/target/
</code></pre></div><p>Note that you must have passphrase-less SSH keys or an ssh-agent configured for this to work, otherwise rsync will need to ask for a passphrase.</p>
<p>dev experience
lead</p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://example.org/" >
    &copy;  My New Hugo Site 2020 
  </a>
    <div>














</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
