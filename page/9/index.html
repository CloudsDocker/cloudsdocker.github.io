<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.8.0">

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="Contact me via phray.zhang@gmail.com or wechat at helloworld_2000">
    

    <!--Author-->
    
        <meta name="author" content="Todd Zhang">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Clouds &amp; Docker">
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="Contact me via phray.zhang@gmail.com or wechat at helloworld_2000">
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Clouds &amp; Docker">

    <!--Type page-->
    
        <meta property="og:type" content="website">
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary">
    

    <!-- Title -->
    
    <title>page - Clouds &amp; Docker</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    


</head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about.html">
                    About
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/tags">
                    Tags
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/categories">
                    Categories
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/contact.html">
                    Contact
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
            <h1 id="main-title" class="title">Clouds & Docker</h1>
        
    </div>
</header>

        <section class="main">
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017-03-21-aws/">
                AWS Tips
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2019-05-31</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <p>After establishing a SSH session, you can install a default web server by executing sudo yum install httpd -y. To start the web server, type sudo service httpd start and press Return to execute the command. Your web browser should show a placeholder site if you open http://$PublicIp with $PublicIp replaced by the public IP address of your virtual server.</p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017-03-05-Spring/">
                Spring notes
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2019-05-31</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="Spring-Bean-Life-Cycle-Callback-Methods"><a href="#Spring-Bean-Life-Cycle-Callback-Methods" class="headerlink" title="Spring Bean Life Cycle Callback Methods"></a>Spring Bean Life Cycle Callback Methods</h1><p><img src="https://www.concretepage.com/spring/images/spring-bean-life-cycle-tutorial.jpg" alt="life cycle"><br>A bean life cycle includes the following steps. </p>
<ol>
<li>Within IoC container, a spring bean is created using class constructor. </li>
<li>Now the dependency injection is performed using setter method. </li>
<li>Once the dependency injection is completed, BeanNameAware.setBeanName() is called. It sets the name of bean in the bean factory that created this bean. </li>
<li>Now &lt; code&gt;BeanClassLoaderAware.setBeanClassLoader() is called that supplies the bean class loader to a bean instance. </li>
<li>Now &lt; code&gt;BeanFactoryAware.setBeanFactory() is called that provides the owning factory to a bean instance. </li>
<li>Now the IoC container calls BeanPostProcessor.postProcessBeforeInitialization on the bean. Using this method a wrapper can be applied on original bean. </li>
<li>Now the method annotated with @PostConstruct is called. </li>
<li>After @PostConstruct, the method InitializingBean.afterPropertiesSet() is called. </li>
<li>Now the method specified by init-method attribute of bean in XML configuration is called. </li>
<li>And then BeanPostProcessor.postProcessAfterInitialization() is called. It can also be used to apply wrapper on original bean. </li>
<li>Now the bean instance is ready to be used. Perform the task using the bean. </li>
<li>Now when the ApplicationContext shuts down such as by using registerShutdownHook() then the method annotated with @PreDestroy is called. </li>
<li>After that DisposableBean.destroy() method is called on the bean. </li>
<li>Now the method specified by destroy-method attribute of bean in XML configuration is called. </li>
<li>Before garbage collection, finalize() method of Object is called.</li>
</ol>
<p>Spring framework provides following 4 ways for controlling life cycle events of bean:</p>
<ul>
<li>InitializingBean and DisposableBean callback interfaces</li>
<li>Other Aware interfaces for specific behavior</li>
<li>Custom init() and destroy() methods in bean configuration file</li>
<li>@PostConstruct and @PreDestroy annotations</li>
</ul>
<h2 id="InitializingBean"><a href="#InitializingBean" class="headerlink" title="InitializingBean"></a>InitializingBean</h2><p>The org.springframework.beans.factory.InitializingBean interface specifies a single method −</p>
<p>void afterPropertiesSet() throws Exception;</p>
<h2 id="Destruction-callbacks"><a href="#Destruction-callbacks" class="headerlink" title="Destruction callbacks"></a>Destruction callbacks</h2><p>The org.springframework.beans.factory.DisposableBean interface specifies a single method −</p>
<p>void destroy() throws Exception;</p>
<h2 id="Custom-init-and-destroy-methods-in-bean-configuration-file"><a href="#Custom-init-and-destroy-methods-in-bean-configuration-file" class="headerlink" title="Custom init() and destroy() methods in bean configuration file"></a>Custom init() and destroy() methods in bean configuration file</h2><p>The default init and destroy methods in bean configuration file can be defined in two ways:</p>
<p>Bean local definition applicable to a single bean<br>Global definition applicable to all beans defined in beans context</p>
<p>Local definition is given as below.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demoBean"</span> <span class="attr">class</span>=<span class="string">"com.howtodoinjava.task.DemoBean"</span> </span></span><br><span class="line"><span class="tag">					<span class="attr">init-method</span>=<span class="string">"customInit"</span> </span></span><br><span class="line"><span class="tag">					<span class="attr">destroy-method</span>=<span class="string">"customDestroy"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Where as global definition is given as below. These methods will be invoked for all bean definitions given under <beans> tag. They are useful when you have a pattern of defining common method names such as init() and destroy() for all your beans consistently. This feature helps you in not mentioning the init and destroy method names for all beans independently.</beans></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">default-init-method</span>=<span class="string">"customInit"</span> <span class="attr">default-destroy-method</span>=<span class="string">"customDestroy"</span>&gt;</span>   </span><br><span class="line"></span><br><span class="line">    	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demoBean"</span> <span class="attr">class</span>=<span class="string">"com.howtodoinjava.task.DemoBean"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="PostConstruct-and-PreDestroy-annotations"><a href="#PostConstruct-and-PreDestroy-annotations" class="headerlink" title="@PostConstruct and @PreDestroy annotations"></a>@PostConstruct and @PreDestroy annotations</h2><p>Spring 2.5 onwards, you can use annotations also for specifying life cycle methods using @PostConstruct and @PreDestroy annotations.</p>
<p>@PostConstruct annotated method will be invoked after the bean has been constructed using default constructor and just before it’s instance is returned to requesting object.<br>@PreDestroy annotated method is called just before the bean is about be destroyed inside bean container.<br>A sample implementation will look like this:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.howtodoinjava.task;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.PostConstruct;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.PreDestroy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoBean</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="meta">@PostConstruct</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customInit</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Method customInit() invoked..."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@PreDestroy</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customDestroy</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Method customDestroy() invoked..."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Spring-Notes"><a href="#Spring-Notes" class="headerlink" title="Spring Notes"></a>Spring Notes</h1><h2 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> execution(* concert.Performance.perform())  and !bean(<span class="string">'woodstock'</span>)</span><br><span class="line"> <span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Audience</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Before</span>(<span class="string">"execution(** concert.Performance.perform(..))"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">silenceCellPhones</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Before performance</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Fortunately, there’s a way: the @Pointcut annotation defines a reusable pointcut within an @AspectJ aspect. The next listing shows the Audience aspect, updated to use @Pointcut.</p>
</li>
<li><p>Reuse pointuct</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Audience</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Pointcut</span>(<span class="string">"execution(** concert.Performance.perform(..))"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">performance</span><span class="params">()</span> </span>&#123;&#125; <span class="comment">//Define named pointcut</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"performance()"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">silenceCellPhones</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Silencing cell phones"</span>);</span><br><span class="line">  <span class="meta">@Before</span>(<span class="string">"performance()"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">takeSeats</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Taking seats"</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>The body of the performance() method is irrelevant and, in fact, should be empty. The method itself is just a marker, giving the @Pointcut annotation something to attach itself to.</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint; <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Audience</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">watchPerformance</span><span class="params">(ProceedingJoinPoint jp)</span> </span>&#123; <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"Silencing cell phones"</span>); System.out.println(<span class="string">"Taking seats"</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"audience"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:pointcut</span></span></span><br><span class="line"><span class="tag"><span class="attr">id</span>=<span class="string">"performance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">expression</span>=<span class="string">"execution(** concert.Performance.perform(..))"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:around</span>     <span class="attr">Declare</span> <span class="attr">around</span> <span class="attr">advice</span></span></span><br><span class="line"><span class="tag">        </span></span><br><span class="line"><span class="tag"><span class="attr">pointcut-ref</span>=<span class="string">"performance"</span> <span class="attr">method</span>=<span class="string">"watchPerformance"</span>/&gt;</span> <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>to use AspectJ’s @DeclareParents annota¬tion to magically introduce a new method into an advised bean. But AOP introduc¬tions aren’t exclusive to AspectJ. Using the <a href="aop:declare-parents" target="_blank" rel="noopener">aop:declare-parents</a> element from Spring’s aop namespace, you can do similar magic in XML.</li>
</ul>
<ul>
<li><p>Listing 1.7 Spring offers Java-based configuration as an alternative to XML.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springinaction.knights.config;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> com.springinaction.knights.BraveKnight; <span class="keyword">import</span> com.springinaction.knights.Knight; <span class="keyword">import</span> com.springinaction.knights.Quest; <span class="keyword">import</span> com.springinaction.knights.SlayDragonQuest;</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KnightConfig</span> </span>&#123;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Knight <span class="title">knight</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> BraveKnight(quest());</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Quest <span class="title">quest</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> SlayDragonQuest(System.out);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>In a Spring application, an application context loads bean definitions and wires them together. The Spring application context is fully responsible for the creation of and wiring of the objects that make up the application. Spring comes with several imple¬mentations of its application context, each primarily differing only in how it loads its configuration.</p>
</li>
<li><p>When the beans in knights.xml are declared in an XML file, an appropriate choice for application context might be ClassPathXmlApplicationContext.1</p>
</li>
<li><p>These system services are commonly referred to as cross-cut¬ting concerns because they tend to cut across multiple components in a system.</p>
</li>
<li><p>Your components are littered with code that isn’t aligned with their core func¬tionality. A method that adds an entry to an address book should only be con¬cerned with how to add the address and not with whether it’s secure or transactional.</p>
</li>
<li><p>Spring seeks to eliminate boilerplate code by encapsulating it in templates. Spring’s JdbcTemplate makes it possible to perform database operations without all the ceremony required by traditional JDBC.<br>The container is at the core of the Spring Framework. Spring’s container uses DI to manage the components that make up an application. This includes creating associa¬tions between collaborating components. As such, these objects are cleaner and easier to understand, they support reuse, and they’re easy to unit test.</p>
</li>
<li><p>There’s no single Spring container. Spring comes with several container imple¬mentations that can be categorized into two distinct types. Bean factories (defined by the org.springframework.beans.factory.BeanFactory interface) are the simplest of containers, providing basic support for DI. Application contexts (defined by the org.springframework.context.ApplicationContext interface) build on the notion of a bean factory by providing application-framework services, such as the ability to resolve textual messages from a properties file and the ability to publish application events to interested event listeners.</p>
</li>
<li><p>Although it’s possible to work with Spring using either bean factories or applica¬tion contexts, bean factories are often too low-level for most applications. Therefore, application contexts are preferred over bean factories. We’ll focus on working with application contexts and not spend any more time talking about bean factories.</p>
</li>
<li><p>As you can see, a bean factory performs several setup steps before a bean is ready to use. Let’s break down figure 1.5 in more detail:<br>1 Spring instantiates the bean.<br>2 Spring injects values and bean references into the bean’s properties.<br>3 If the bean implements BeanNameAware, Spring passes the bean’s ID to the set-BeanName() method.<br>4 If the bean implements BeanFactoryAware, Spring calls the setBeanFactory() method, passing in the bean factory itself.<br>5 If the bean implements ApplicationContextAware, Spring calls the set-ApplicationContext() method, passing in a reference to the enclosing appli¬cation context.<br>6       If the bean implements the BeanPostProcessor interface, Spring calls its post-<br>ProcessBeforeInitialization() method.<br>7       If the bean implements the InitializingBean interface, Spring calls its after-<br>PropertiesSet() method. Similarly, if the bean was declared with an init-method, then the specified initialization method is called.<br>8 If the bean implements BeanPostProcessor, Spring calls its postProcess-AfterInitialization() method.<br>9 At this point, the bean is ready to be used by the application and remains in the application context until the application context is destroyed.<br>10 If the bean implements the DisposableBean interface, Spring calls its destroy() method. Likewise, if the bean was declared with a destroy-method, the specified method is called.</p>
</li>
<li><p>Spring Boot heavily employs automatic configuration techniques that can elimi¬nate most (and in many cases, all) Spring configuration. It also provides several starter projects to help reduce the size of your Spring project build files, whether you’re using Maven or Gradle.</p>
</li>
</ul>
<p>·   Spring began to support Servlet 3.0, including the ability to declare servlets and filters in Java-based configuration instead of web.xml.<br>·   You should now have a good idea of what Spring brings to the table. Spring aims to make enterprise Java development easier and to promote loosely coupled code. Vital to this are dependency injection and aspect-oriented programming.<br>When it comes to expressing a bean wiring specification, Spring is incredibly flexible, offering three primary wiring mechanisms:<br>·   Explicit configuration in XML<br>·   Explicit configuration in Java<br>·   Implicit bean discovery and automatic wiring<br>·   in many cases, the choice is largely a matter of personal taste, and you’re welcome to choose the approach that feels best for you.<br>Spring attacks automatic wiring from two angles:<br>·   Component scanning—Spring automatically discovers beans to be created in the application context.<br>·   Autowiring—Spring automatically satisfies bean dependencies.<br>Working together, component scanning and autowiring are a powerful force and can help keep explicit configuration to a minimum.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> soundsystem;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CompactDisc</span> </span>&#123; <span class="function"><span class="keyword">void</span> <span class="title">play</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>The specifics of the CompactDisc interface aren’t important. What is important is that you’ve defined it as an interface. As an interface, it defines the contract through which a CD player can operate on the CD. And it keeps the coupling between any CD player implementation and the CD itself to a minimum.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> soundsystem;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SgtPeppers</span> <span class="keyword">implements</span> <span class="title">CompactDisc</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String title = <span class="string">"Sgt. Pepper's Lonely Hearts Club Band"</span>; <span class="keyword">private</span> String artist = <span class="string">"The Beatles"</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"Playing "</span> + title + <span class="string">" by "</span> + artist);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>that SgtPeppers is annotated with @Component. This simple annotation identifies this class as a component class and serves as a clue to Spring that a bean should be created for the class.<br>Component scanning isn’t turned on by default, however. You’ll still need to write an explicit configuration to tell Spring to seek out classes annotated with @Component and to create beans from them. The configuration class in the following listing shows the minimal configuration to make this possible.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> soundsystem;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan; <span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="meta">@Configuration</span> <span class="meta">@ComponentScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CDPlayerConfig</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>you can explicitly identify any state as the starting state by setting the start-state attri¬bute in the <flow> element:</flow></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">flow</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/webflow"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/webflow http://www.springframework.org/schema/webflow/spring-webflow-2.3.xsd"</span> <span class="attr">start-state</span>=<span class="string">"identifyCustomer"</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;/<span class="name">flow</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>Welcome to Spizza!!!<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form:form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"_flowExecutionKey"</span></span></span><br><span class="line"><span class="tag"><span class="attr">value</span>=<span class="string">"$&#123;flowExecutionKey&#125;"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"phoneNumber"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">name</span>=<span class="string">"_eventId_phoneEntered"</span></span></span><br><span class="line"><span class="tag"><span class="attr">value</span>=<span class="string">"Lookup Customer"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form:form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>The <em>eventId</em> portion of the button’s name is a clue to Spring Web Flow that what follows is an event that should be fired. When the form is submitted by clicking that button, a phoneEntered event is fired, triggering a transition to lookupCustomer.</p>
<p>  Flow execution key</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>The address is outside of our delivery area. You may</span><br><span class="line">still place the order, but you will need to pick it up</span><br><span class="line">yourself.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&lt;![CDATA[</span><br><span class="line">&lt;a href="$&#123;flowExecutionUrl&#125;&amp;_eventId=accept"&gt;</span><br><span class="line">Continue, I'll pick up the order&lt;/a&gt; |</span><br><span class="line">&lt;a href="$&#123;flowExecutionUrl&#125;&amp;_eventId=cancel"&gt;Never mind&lt;/a&gt;</span><br><span class="line">11&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Note that the customerReady end state includes an <output> element. This ele-ment is a flow’s equivalent of Java’s return statement. It passes back some data from a subflow to the calling flow. In this case, <output> returns the customer flow variable so that the identifyCustomer subflow state in the pizza flow can assign it to the order.<br>you use the <input> element to pass the Order in to the flow. Here you’re using it to accept that Order object. If you think of this subflow as being analo¬gous to a method in Java, the <input> element used here is effectively defining the subflow’s signature. This flow requires a single parameter called order.</output></output></p>
</li>
<li><p>States, transitions, and entire flows can be secured in Spring Web Flow by using the <secured> element as a child of those elements. For example, to secure access to a view state, you might use <secured> like this:</secured></secured></p>
<view-state id="restricted">
<secured attributes="ROLE_ADMIN" match="all"> </secured></view-state>
As configured here, access to the view state will be restricted to only users who are granted ROLE_ADMIN access (per the attributes attribute). The attributes attribute takes a comma-separated list of authorities that the user must have to gain access to the state, transition, or flow.









</li>
</ul>
<p>On the contrary, REST has little to do with RPC. Whereas RPC is service oriented and focused on actions and verbs, REST is resource oriented, emphasizing the things and nouns that comprise an application.</p>
<p>Put more succinctly, REST is about transferring the state of resources—in a representational form that is most appropriate for the client or server—from a server to a client (or vice versa).</p>
<p>It’s a small start, but you’ll build on this controller throughout this chapter as you learn the ins and outs of Spring’s REST programming model.</p>
<p>Representation is an important facet of REST. It’s how a client and a server communicate about a resource. Any given resource can be represented in virtually any form. If the consumer of the resource prefers JSON, then the resource can be</p>
<p>Meanwhile, a human user viewing the resource in a web browser will likely prefer seeing it in HTML (or possibly PDF, Excel, or some other human-readable form). The resource doesn’t change—only how it’s represented.</p>
<p>Understanding how ContentNegotiatingViewResolverworks involves getting to know the content-negotiation two-step:</p>
<ol>
<li><p>Determine the requested media type(s).</p>
</li>
<li><p>Find the best view for the requested media type(s).</p>
</li>
</ol>
<p>The @ResponseBodyannotation tells Spring that you want to send the returned object as a resource to the client, converted into some representational form that the client can accept. More specifically, DispatcherServletconsiders the request’s Acceptheader and looks for a message converter that can give the client the representation it wants.</p>
<p>Just as @ResponseBodytells Spring to employ a message converter when sending data to a client, the @RequestBodytells Spring to find a message converter to convert a resource representation coming from a client into an object. For example, suppose that you need a way for a client to submit a new Spittle to be saved. You can write the controller method to handle such a request like this:</p>
<p>The body of the POST request is expected to carry a resource representation for a Spittle. Because the Spittleparameter is annotated with @RequestBody, Spring will look at the Content-Typeheader of the request and try to find a message converter that can convert the request body into a Spittle.</p>
<p>For example, if the client sent the Spittle data in a JSON representation, then the Content-Type header might be set to application/json. In that case, DispatcherServletwill look for a message converter that can convert JSON into Java objects. If the Jackson 2 library is on the classpath, then MappingJackson2Http-MessageConverterwill get the job and will convert the JSON representation into a Spittle that’s passed into the saveSpittle()method. The method is also annotated with @ResponseBodyso that the returned Spittle will be converted into a resource representation to be returned to the client.</p>
<p>Notice that the @RequestMappinghas a consumesattribute set to application/json. The consumesattribute works much like the producesattribute, only with regard to the request’s Content-Typeheader. This tells Spring that this method will only handle POSTrequests to /spittles if the request’s Content-Typeheader is application/json. Otherwise, it will be up to some other method (if a suitable one exists) to handle the request.</p>
<p>The key thing to notice in listing 16.3is what’s not in the code. Neither of the handler methods are annotated with @ResponseBody. But because the controller is annotated with @RestController, the objects returned from those methods will still go through message conversion to produce a resource representation for the client.The @ExceptionHandler annotation can be applied to controller methods to handle specific exceptions. Here, it’s indicating that if a SpittleNotFoundException is thrown from any of the handler methods in the same controller, the spittleNotFound() method should be called to handle that exception.</p>
<p>@ExceptionHandler(SpittleNotFoundException.class)@ResponseStatus(HttpStatus.NOT_FOUND)public @ResponseBody Error spittleNotFound(SpittleNotFoundException e) {  long spittleId = e.getSpittleId();  return new Error(4, “Spittle [“ + spittleId + “] not found”);}</p>
<p>@ExceptionHandler(SpittleNotFoundException.class)<br>@ResponseStatus(HttpStatus.NOT_FOUND)<br>public @ResponseBody Error spittleNotFound(SpittleNotFoundException e) {<br> long spittleId = e.getSpittleId();<br> return new Error(4, “Spittle [“ + spittleId + “] not found”);<br>}</p>
<p>Because spittleNotFound() always returns an Error, the only reason to keep Response-Entity around is so you can set the status code. But by annotating spittleNotFound() with @ResponseStatus(HttpStatus.NOT_FOUND), you can achieve the same effect and get rid of ResponseEntity.</p>
<p>Again, if the controller class is annotated with @RestController, you can remove the @ResponseBody annotation and clean up the code a little more:</p>
<p>@ExceptionHandler(SpittleNotFoundException.class)<br>@ResponseStatus(HttpStatus.NOT_FOUND)<br>public Error spittleNotFound(SpittleNotFoundException e) {<br> long spittleId = e.getSpittleId();<br> return new Error(4, “Spittle [“ + spittleId + “] not found”);<br>}</p>
<p>public Spittle fetchSpittle(long id) {<br> RestTemplate rest = new RestTemplate();<br> ResponseEntity<spittle> response = rest.getForEntity(</spittle></p>
<pre><code>&quot;http://localhost:8080/spittr-api/spittles/{id}&quot;,
Spittle.class, id);</code></pre><p> if(response.getStatusCode() == HttpStatus.NOT_MODIFIED) {<br>   throw new NotModifiedException();<br> }<br> return response.getBody();<br>}</p>
<p>Just like the getForEntity() method, postForEntity() returns a Response-Entity<t> object. From that object, you can call getBody() to get the resource object (a Spitter in this case). And the getHeaders() method gives you an HttpHeaders from which you can access the various HTTP headers returned in the response. Here, you’re calling getLocation() to retrieve the Location header as a java.net.URI.</t></p>
<p>By passing in HttpMethod.GET as the HTTP verb, you’re asking exchange() to send a GET request. The third argument is for sending a resource on the request, but because this is a GET request, it can be null. The next argument indicates that you want the response converted into a Spitter object. An</p>
<p>Used this way, the exchange() method is virtually identical to the previously used getForEntity(). But unlike getForEntity()—or getForObject()—exchange() lets you set headers on the request sent. Instead of passing null to exchange(), you pass in an HttpEntity created with the request headers you want.</p>
<p>RESTful architecture uses web standards to integrate applications, keeping the interactions simple and natural. Resources in a system are identified by URLs, manipulated with HTTP methods, and represented in one or more forms suitable for the client.</p>
<p>Spring’s philosophy of avoiding checked exceptions, you don’t want to let the JMSException escape this method, so you’ll catch it instead.</p>
<p>In the catch block, you can use the convertJmsAccessException() method from Spring’s JmsUtils class to convert the checked JMSException to an unchecked JmsException. This is effectively the same thing JmsTemplate does for you in other cases.</p>
<p>A message-listener container is a special bean that watches a JMS destination, waiting for a message to arrive. Once a message arrives, the bean retrieves the message and passes it on to any message listeners that are interested.</p>
<p>&lt;jms:listener-container connection-factory=”connectionFactory”&gt;<br> &lt;jms:listener destination=”spitter.alert.queue”<br>      ref=”spittleHandler” method=”handleSpittleAlert” /&gt;<br></p>
<p>JmsInvokerServiceExporter is much like those other service exporters. In fact, note that there’s some symmetry in the names of JmsInvokerServiceExporter and HttpInvokerServiceExporter. If HttpInvokerServiceExporter exports services that communicate over HTTP, then JmsInvokerServiceExporter must export services that converse over JMS.</p>
<p>As it turns out, AMQP offers several advantages over JMS. First, AMQP defines a wire-level protocol for messaging, whereas JMS defines an API specification. JMS’s API specification ensures that all JMS implementations can be used through a common API but doesn’t mandate that messages sent by one JMS implementation can be consumed by a different JMS implementation. AMQP’s wire-level protocol, on the other hand, specifies the format that messages will take when en route between the producer and consumer. Consequently, AMQP is more interoperable than JMS—not only across different AMQP implementations, but also across languages and platforms.</p>
<p>In JMS, there are just three primary participants: the message producer, the message consumer(s), and a channel (either a queue or a topic) to carry the message between producers and consumers. These essentials of the JMS messaging model are illustrated in figures 17.3 and 17.4.</p>
<p>In JMS, the channel helps to decouple the producer from the consumer, but both are still coupled to the channel. A producer publishes messages to a specific queue or topic, and the consumer receives those message from a specific queue or topic. The channel has the double duty of relaying messages and determining how those messages will be routed; queues route using a point-to-point algorithm, and topics route in publish/subscribe fashion.</p>
<p>In contrast, AMQP producers don’t publish directly to a queue. Instead, AMQP introduces a new level of indirection between the producer and any queues that will carry the message: the exchange. This relationship is illustrated in figure 17.8.</p>
<p>Figure 17.8. In AMQP, message producers are decoupled from message queues by an exchange that handles message routing.</p>
<p>For example, to have a message routed to multiple queues with no regard for the routing key, you can configure a fanout exchange and several queues like this:</p>
<p><admin connection-factory="connectionFactory"> <queue name="spittle.alert.queue.1"> <queue name="spittle.alert.queue.2"> <queue name="spittle.alert.queue.3"> <fanout-exchange name="spittle.fanout"> <bindings> <binding queue="spittle.alert.queue.1"> <binding queue="spittle.alert.queue.2"> <binding queue="spittle.alert.queue.3"> </binding></binding></binding></bindings> </fanout-exchange></queue></queue></queue></admin></p>
<p>As its name implies, the RabbitMQ connection factory is used to create connections with RabbitMQ. If you want to send messages via RabbitMQ, you could inject the connectionFactory bean into your AlertServiceImpl class, use it to create a Connection, use that Connection to create a Channel, and use that Channel to publish a message to an exchange.</p>
<p>Yep, you could do that.</p>
<p>you can configure different defaults using the exchange and routing-key attributes on the <template> element:</template></p>
<p><template id="rabbitTemplate" connection-factory="connectionFactory" exchange="spittle.alert.exchange" routing-key="spittle.alerts"></template></p>
<p>it was tricky to convert domain objects into Messages for sending, it’s messy to convert received Messages to domain objects. Therefore, consider using RabbitTemplate’s receiveAndConvert() method instead:</p>
<p>Spittle spittle =<br>   (Spittle) rabbit.receiveAndConvert(“spittle.alert.queue”);<br>Or you can leave the queue name out of the call parameters to fall back on the template’s default queue name:</p>
<p>The first thing you’ll need in order to consume a Spittle object asynchronously in a message-driven POJO is the POJO itself. Here’s SpittleAlertHandler, which fills that role:</p>
<p>package com.habuma.spittr.alerts;<br>import com.habuma.spittr.domain.Spittle;</p>
<p>public class SpittleAlertHandler {</p>
<p> public void handleSpittleAlert(Spittle spittle) {<br>   // … implementation goes here …<br> }<br>}</p>
<listener-container connection-factory="connectionFactory">
   <listener ref="spittleListener" method="handleSpittleAlert" queue-names="spittle.alert.queue">
</listener></listener-container>
Do you see the difference? I’ll agree that it’s not obvious. The <listener-container> and <listener> elements appear to be similar to their JMS counterparts. These elements, however, come from the rabbit namespace instead of the JMS namespace.

<p>I said it wasn’t obvious.</p>
<p>Regardless of whether you handle text messages, binary messages, or both, you might also be interested in handling the establishment and closing of connections. In that case, you can override afterConnectionEstablished() and afterConnectionClosed():</p>
<p>public void afterConnectionEstablished(WebSocketSession session)<br>   throws Exception {<br> logger.info(“Connection established”);<br>}</p>
<p>@Override<br>public void afterConnectionClosed(<br>   WebSocketSession session, CloseStatus status) throws Exception {<br> logger.info(“Connection closed. Status: “ + status);<br>}</p>
<p>Fortunately, you don’t have to work with raw WebSocket connections. Just as HTTP layers a request-response model on top of TCP sockets, STOMP layers a frame-based wire format to define messaging semantics on top of WebSocket.</p>
<p>At a quick glance, STOMP message frames look very similar in structure to HTTP requests. Much like HTTP requests and responses, STOMP frames are comprised of a command, one or more headers, and a payload. For example, here’s a STOMP frame that sends data.</p>
<p>SEND<br>destination:/app/marco<br>content-length:20</p>
<p>{&quot;message&quot;:&quot;Marco!&quot;}
In this simple example, the STOMP command is SEND, indicating that something is being sent. It’s followed by two headers: one indicates the destination where the message should be sent, and the other communicates the size of the payload. Following a blank line, the frame concludes with the payload; in this case, a JSON message.</p>
<p>Taking advantage of Maven’s and Gradle’s transitive dependency resolution, the starters declare several dependencies in their own pom.xml file. When you add one of these starter dependencies to your Maven or Gradle build, the starter’s dependencies are resolved transitively.</p>
<p>Whereas Spring Boot starters cut down the size of your build’s dependency list, Spring Boot autoconfiguration cuts down on the amount of Spring configuration.</p>
<p>When Spring Boot’s web autoconfiguration detects Spring MVC in the classpath, it will automatically configure several beans to support Spring MVC, including view resolvers, resource handlers, and message converters (among others). All that’s left for you to do is write the controller classes to handle the requests.</p>
<p>Spring Boot is an exciting new addition to the Spring family of projects. Where Spring aims to make Java development simpler, Spring Boot aims to make Spring itself simpler.</p>
<p>Spring Boot employs two main tricks to eliminate boilerplate configuration in a Spring project: Spring Boot starters and automatic configuration.</p>
<p>A single Spring Boot starter dependency can replace several common dependencies in a Maven or Gradle build. For example, adding only Spring Boot’s web starter as a dependency in a project pulls in Spring’s web and Spring MVC modules as well as the Jackson 2 databind module.</p>
<p>Automatic configuration takes full advantage of Spring 4.0’s conditional configuration feature to automatically configure certain Spring beans to enable a certain feature. For example, Spring Boot can detect that Thymeleaf is in the application classpath and automatically configure the beans required to enable Thymeleaf templates as Spring MVC views.</p>
<p>In addition to the MBean info assemblers you’ve seen thus far, Spring provides another assembler known as MetadataMBeanInfoAssembler that can be configured to use annotations to appoint bean methods as managed operations and attributes. I could show you</p>
<p>JTA transaction management is resource-intensive; its exception handling is based on checked exceptions and so is not developer-friendly. Moreover, unit testing is hard with EJB CMT.</p>
<p>Most applications just need local transactions since they do not deal with multiple servers or transactional resources such as databases, JMS, and JCA; hence, they do not need a full-blown application server. For distributed transactions spanned across multiple servers over remote calls, you need JTA, necessitating an application server, as JTA needs JNDI to look up the data source. JNDI is normally available only in an application server. Use JTATransactionManager inside application servers for JTA capabilities.</p>
<p>TransactionDefinition defines the critical transaction attributes such as isolation, propagation, transaction timeout, and the read-only status of a given transaction instance.</p>
<p>Transaction attributes determine the behavior of transaction instances. They can be set programmatically as well as declaratively. Transaction attributes are:</p>
<p>Isolation level: Defines how much a transaction is isolated from (can see) other transactions running in parallel. Valid values are: None, Read committed, Read uncommitted, Repeatable reads, and Serializable. Read committed cannot see dirty reads from other transactions.</p>
<p>Propagation: Determines the transactional scope of a database operation in relation to other operations before, after, and nested inside itself. Valid values are: REQUIRED, REQUIRES_NEW, NESTED, MANDATORY, SUPPORTS, NOT_SUPPORTED, and NEVER.</p>
<p>Timeout: Maximum time period that a transaction can keep running or waiting before it completes. Once at timeout, it will roll back automatically.</p>
<p>Read-only status: You cannot save the data read in this mode.</p>
<p>These transaction attributes are not specific to Spring, but reflect standard transactional concepts. The TransactionDefinition interface specifies these attributes in the Spring Transaction Management context.<br>For multiple DataSource objects or transactional resources, you need a JtaTransactionManager with JTA capabilities, which usually delegates to a container JTA provider.</p>
<p>If you are using Hibernate and just a single DataSource (and no other transactional resource), then the best option is to use HibernateTransactionManager, which requires you to pass the session factory as a dependency.</p>
<p>Spring Transactions supports two transactional modes: proxy mode and AspectJ mode. Proxy is the default and most popular mode. In proxy mode, Spring creates an AOP proxy object, wrapping the transactional beans, and applies transactional behavior transparently around the methods using transaction aspects based on the metadata. The AOP proxy created by Spring based on transactional metadata, with the help of the configured PlatformTransactionManager, performs transactions around the transactional methods.</p>
<p>Spring offers two convenient approaches for declaratively defining the transactional behavior of your beans:</p>
<p>AOP configuration for transactions in an XML metadata file<br>Using the @Transactional annotation</p>
<!-- transactional advices -->
<p>&lt;tx:advice id=”txAdvice” transaction-manager=”transactionManager”&gt;<br> <!-- the transactional semantics... --><br> <a href="tx:attributes" target="_blank" rel="noopener">tx:attributes</a><br>   <!-- all methods starting with 'get' are read-only --><br>   &lt;tx:method name=”find*” read-only=”true” /&gt;<br>   <!-- other methods use the default transaction settings (see below) --><br>   &lt;tx:method name=”*” isolation=”DEFAULT” propagation=”REQUIRED” /&gt;<br> <br></p>
<!-- Applying the above advices to the service layer methods -->
<p><a href="aop:config" target="_blank" rel="noopener">aop:config</a><br> &lt;aop:pointcut id=”allServiceMethods”<br> expression=”execution(* com.taskify.service.<em>.</em>(..))” /&gt;<br> &lt;aop:advisor advice-ref=”txAdvice” pointcut- ref=”allServiceMethods” /&gt;<br><br>You can see that this AOP configuration instructs Spring how to weave transactional advices around the methods using pointcuts. It instructs TransactionManager to make all find methods of the entire service layer read-only, and to force other methods to have the transaction propagation: REQUIRED, which means that, if the caller of the method is already in a transactional context, this method joins the same transaction without creating a new one; otherwise, a new transaction is created. If you want to create a different transaction for this method, you should use the REQUIRES_NEW propagation.<br>Also, note that the transaction isolation level is specified as DEFAULT, which means the default isolation of the database is to be used. Most databases default to READ_COMMITTED, which means a transactional thread cannot see the data of other transactions in progress (dirty reads).</p>
<p>Note<br>@Transactional can be applied only to public methods. If you want to annotate over protected, private, or package-visible methods, consider using AspectJ, which uses compile-time aspect weaving. Spring recommends annotating @Transactional only on concrete classes as opposed to interfaces, as it will not work in most cases such as when you use proxy-target-class=”true” or mode=”aspectj”.</p>
<p>You need to first enable transaction management in your application before Spring can detect the @Transactional annotation for your bean methods. You enable transaction in your XML metadata using the following notation:</p>
<p>&lt;tx:annotation-driven transaction-manager=”transactionManager” /&gt;<br>The following is the Java configuration alternative for the preceding listing:</p>
<p>@Configuration<br>@EnableTransactionManagement<br>public class JpaConfiguration {<br>}
Spring scans the application context for bean methods annotated with @Transactional when it sees either of the preceding settings.</p>
<p>Implementing InitializingBean and DisposableBean</p>
<p>The Spring IoC container invokes the callback methods afterPropertiesSet() of org.springframework.beans.factory.InitializingBean and destroy() of org.springframework.beans.factory.DisposableBean on any Spring bean and implements them:</p>
<p>There are different bean scopes in Spring, such as singleton, prototype, request, session, and global session. We will understand each session one by one.</p>
<p>By default, all Spring beans are singleton. Once ApplicationContext is initialized, it looks at all the beans in XML and initializes only one bean per bean definition in Spring Container. On each call to the getBean() method, Spring Container returns the same instance of the bean.</p>
<p>Prototype</p>
<p>The prototype is second bean scope in Spring, which returns a brand-new instance of a bean on each call to the getBean() method. When a bean is defined as a prototype, Spring waits for getBean() to happen and only then does it initialize the prototype. </p>
<p>Spring doesn’t maintain the complete life cycle of the prototype. Here, the container instantiates and configures prototype beans and returns this bean to the client with no further record of this prototype instance.</p>
<p>Request</p>
<p>The third bean scope in Spring is request, which is available only in web applications that use Spring and create an instance of bean for every HTTP request. Here, a new bean is created per Servlet request. Spring will be aware of when a new request is happening because it ties well with the Servlet APIs, and depending on the request, Spring creates a new bean. So, if the reque</p>
<p>Session</p>
<p>The session is the fourth bean scope in Spring, which is available only in web applications that use Spring and create an instance of bean for every HTTP session. Here, a new bean is created per session. As long as there is one user accessing in a single session, each call to getBean() will return same instance of the bean. </p>
<p>Global session</p>
<p>The global session is the fifth bean scope in Spring, which works only in portlet environments that use Spring and create a bean for every new portlet session.</p>
<p>Spring’s BeanFactory manages the life cycle of beans created through the Spring IoC container. The life cycle of beans consist of callback methods, which can be categorized broadly into the following two groups:</p>
<p>Post-initialization callback methods<br>Pre-destruction callback methods</p>
<p>Initialization</p>
<p>It represents a sequence of activities that take place between the bean instantiation and the handover of its reference to the client application:</p>
<p>The bean container finds the definition of the Spring bean in the configuration file and creates an instance of the bean<br>If any properties are mentioned, populate the properties using setters<br>If the Bean class implements the BeanNameAware interface, then call the setBeanName() method<br>If the Bean class implements the BeanFactoryAware interface, then call the setBeanFactory() method<br>If the Bean class implements the ApplicationContextAware interface, then call the setApplicationContext() method<br>If there are any BeanPostProcessors objects associated with the BeanFactory interface that loaded the bean, then Spring will call the postProcessBeforeInitialization() method before the properties for the bean are injected<br>If the Bean class implements the InitializingBean interface, then call the afterPropertiesSet() method once all the bean properties defined in the configuration file are injected<br>If the bean definition in the configuration file contains the init-method attribute, then call this method after resolving the value for the attribute to a method name in the Bean class<br>The postProcessAfterInitialization() method will be called if there are any bean post processors attached to the BeanFactory interface that loads the bean</p>
<p>Destruction</p>
<p>This represents the following sequence of activities:</p>
<p>If the Bean class implements the DisposableBean interface, then call the destroy() method when the application no longer needs the bean reference<br>If the bean definition in the configuration file contains the destroy-method attribute, then call this method after resolving the value for the attribute to a method name in the Bean class.</p>
<p>The InitializingBean interface has afterPropertiesSet(), which needs to be implemented, and it will be called by Spring when this bean is initialized and all properties are set. This InitializingBean interface is a marker for the bean to know that the afterPropertiesSet() method of this bean needs to be called after initialization.</p>
<p>Using init-method in the XML configuration<br>In the case of XML-based configuration metadata, you can use the init-method attribute to specify the name of the method that has a void no-argument signature, which is to be called on the bean immediately upon instantiation.</p>
<p>In the beans.xml file, you’ll find the following code:</p>
<p>…<br><bean id="employeeServiceBean" class="org.packt.Spring.chapter2.callbacks.xml.EmployeeServiceImpl" init-method="myInit"><br></bean><br>…<br>In the EmployeeServiceImpl.java class, you’ll find the following code:</p>
</listener></listener-container>
        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017-04-06-SSH/">
                SSH SFTP
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2019-05-31</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="Secure-FTP"><a href="#Secure-FTP" class="headerlink" title="Secure FTP"></a>Secure FTP</h1><blockquote>
<p>SFTP over FTP is the equivalant of HTTPS over HTTP, the security version</p>
</blockquote>
<h2 id="SFTP-versus-FTPS"><a href="#SFTP-versus-FTPS" class="headerlink" title="SFTP versus FTPS"></a>SFTP versus FTPS</h2><ul>
<li>An increasing number of our customers are looking to move away from standard FTP for transferring data, so we are often asked which secure FTP protocol we recommend. In the next few paragraphs, we will explain what options are available and their main differences.</li>
<li>The two mainstream protocols available for Secure FTP transfers are named SFTP (FTP over SSH) and FTPS (FTP over SSL). Both SFTP and FTPS offer a high level of protection since they implement strong algorithms such as AES and Triple DES to encrypt any data transferred. Both options also support a wide variety of functionality with a broad command set for transferring and working with files. So the most notable differences between SFTP and FTPS is how connections are authenticated and managed.</li>
</ul>
<h2 id="Authentication-SFTP-vs-FTPS"><a href="#Authentication-SFTP-vs-FTPS" class="headerlink" title="Authentication: SFTP vs. FTPS"></a>Authentication: SFTP vs. FTPS</h2><ul>
<li>With SFTP (FTP over SSH), a connection can be authenticated using a couple different techniques.  For basic authentication, you (or your trading partner) may just require a user id and password to connect to the SFTP server. Its important to note that any user ids and passwords supplied over the SFTP connection will be encrypted, which is a big advantage over standard FTP.</li>
<li>SSH keys can also be used to authenticate SFTP connections in addition to, or instead of, passwords. With key-based authentication, you will first need to generate a SSH private key and public key beforehand. If you need to connect to a trading partner’s SFTP server, you would send your SSH public key to them, which they will load onto their server and associate with your account. When you connect to their SFTP server, your client software will transmit your public key to the server for authentication. If the keys match, along with any user/password supplied, then the authentication will succeed.</li>
<li>With FTPS (FTP over SSL), a connection is authenticated using a user id, password and certificate(s).  Like SFTP, the users and passwords for FTPS connections will also be encrypted. When connecting to a trading partner’s FTPS server, your FTPS client will first check if the server’s certificate is trusted. The certificate is considered trusted if either the certificate was signed off by a known certificate authority (CA), like Verisign, or if the certificate was self-signed (by your partner) and you have a copy of their public certificate in your trusted key store.</li>
<li>Your partner may also require that you supply a certificate when you connect to them.  Your certificate may be signed off by a 3rd party CA or your partner may allow you to just self-sign your certificate, as long as you send them the public portion of your certificate beforehand (which they will load in their trusted key store).</li>
</ul>
<h2 id="Implementation-SFTP-vs-FTPS"><a href="#Implementation-SFTP-vs-FTPS" class="headerlink" title="Implementation: SFTP vs. FTPS"></a>Implementation: SFTP vs. FTPS</h2><ul>
<li>In regards to how easy each of the secure FTP protocols are to implement, SFTP is the clear winner since it is very firewall friendly. SFTP only needs a single port number (default of 22) to be opened through the firewall.  This port will be used for all SFTP communications, including the initial authentication, any commands issued, as well as any data transferred.</li>
<li>On the other hand, FTPS can be very difficult to patch through a tightly secured firewall since FTPS uses multiple port numbers. The initial port number (default of 21) is used for authentication and passing any commands.  However, every time a file transfer request (get, put) or directory listing request is made, another port number needs to be opened.  You and your trading partners will therefore have to open a range of ports in your firewalls to allow for FTPS connections, which can be a security risk for your network.</li>
</ul>
<p>In summary, SFTP and FTPS are both very secure with strong authentication options.  However since SFTP is much easier to port through firewalls, and we are seeing an increasing percentage of trading partners adopting SFTP, we believe SFTP is the clear winner for your secure FTP needs.</p>
<h1 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h1><ul>
<li>There are several ways to use SSH; one is to use automatically generated public-private key pairs to simply encrypt a network connection, and then use password authentication to log on.</li>
<li>Another is to use a manually generated public-private key pair to perform the authentication, allowing users or programs to log in without having to specify a password. In this scenario, anyone can produce a matching pair of different keys (public and private). The public key is placed on all computers that must allow access to the owner of the matching private key (the owner keeps the private key secret). While authentication is based on the private key, the key itself is never transferred through the network during authentication. SSH only verifies whether the same person offering the public key also owns the matching private key. In all versions of SSH it is important to verify unknown public keys, i.e. associate the public keys with identities, before accepting them as valid. Accepting an attacker’s public key without validation will authorize an unauthorized attacker as a valid user.</li>
</ul>
<h2 id="Key-management"><a href="#Key-management" class="headerlink" title="Key management"></a>Key management</h2><ul>
<li>On Unix-like systems, the list of authorized public keys is typically stored in the home directory of the user that is allowed to log in remotely, in the file ~/.ssh/authorized_keys.</li>
</ul>
<h3 id="WinFTP"><a href="#WinFTP" class="headerlink" title="WinFTP"></a>WinFTP</h3><ul>
<li>cryptographic protocol is SSH-2</li>
<li>SSH implementation is OpenSSH_5.3</li>
<li>Server fingerprint: File transfer protocol = SFTP-3<br>Cryptographic protocol = SSH-2<br>SSH implementation = OpenSSH_5.3<br>Encryption algorithm = aes<br>Compression = No</li>
</ul>
<hr>
<p>Server host key fingerprint</p>
<h2 id="ssh-rsa-2048-86-54-d9-09-25-c0-9b-f8-17-8c-c0-52-13-0c-9c-cc"><a href="#ssh-rsa-2048-86-54-d9-09-25-c0-9b-f8-17-8c-c0-52-13-0c-9c-cc" class="headerlink" title="ssh-rsa 2048 86:54:d9:09:25:c0:9b:f8:17:8c:c0:52:13:0c:9c:cc"></a>ssh-rsa 2048 86:54:d9:09:25:c0:9b:f8:17:8c:c0:52:13:0c:9c:cc</h2><h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ul>
<li><a href="https://www.goanywhere.com/blog/2011/10/20/sftp-ftps-secure-ftp-transfers" target="_blank" rel="noopener">https://www.goanywhere.com/blog/2011/10/20/sftp-ftps-secure-ftp-transfers</a></li>
<li><a href="https://en.wikipedia.org/wiki/Secure_Shell" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Secure_Shell</a></li>
</ul>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017-03-30-WebSphere-setp-via-CLI/">
                Setup WebSphere profiles and application in command line
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2019-05-31</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="Setup-WebSphere-profiles-and-application-in-command-line"><a href="#Setup-WebSphere-profiles-and-application-in-command-line" class="headerlink" title="Setup WebSphere profiles and application in command line"></a>Setup WebSphere profiles and application in command line</h1><h2 id="Background-amp-descriptions"><a href="#Background-amp-descriptions" class="headerlink" title="Background &amp; descriptions"></a>Background &amp; descriptions</h2><ul>
<li>Beginning with V8.5, WebSphere Application Server provides two runtime profiles. Every WebSphere Application Server package includes both profile types.<ol>
<li>Full WebSphere Application Server</li>
<li>Liberty profile</li>
</ol>
</li>
</ul>
<h3 id="What’s-profile"><a href="#What’s-profile" class="headerlink" title="What’s profile?"></a>What’s profile?</h3><ul>
<li><p>Simply put, a profile contains an Application Server.<br>When an Application Server is running, the server process may read and write data to the underlying configuration files and logs. So, by using profiles, transient data is kept away from the base product. This allows us to have more than one profile using the same base binaries, and also allows us to remove certain profiles without affecting other profiles. Another reason for separating the base binaries is that we can upgrade the product with maintenance updates and fix packs without having to re-create all profiles. Sometimes you do not want a specific profile to be updated. WAS profile management has been designed for flexibility.</p>
</li>
<li><p>WAS has the ability to have multiple application server definitions using the same underlying base binaries. Each profile defines the attributes and configurations for a given application server.<br>Each standalone application server can optionally have its own administrative console application, which you use to manage the application server.<br>We will cover how to install a profile later in the chapter.</p>
</li>
<li><p>On distributed platforms, profiles are created after you install the product by using either the Profile Management Tool or the manageprofiles command.</p>
</li>
</ul>
<h2 id="WAS-Concepts"><a href="#WAS-Concepts" class="headerlink" title="WAS Concepts"></a>WAS Concepts</h2><h3 id="Nodes"><a href="#Nodes" class="headerlink" title="Nodes"></a>Nodes</h3><p>A node is an administrative grouping of application servers for configuration and operational management within one operating system instance. You can create multiple nodes inside one operating system instance, but a node cannot leave the operating system boundaries.</p>
<p>A stand-alone application server configuration has only one node. With Network Deployment, you can configure a distributed server environment that consists of multiple nodes that are managed from one central administration server.</p>
<h3 id="Node-agents"><a href="#Node-agents" class="headerlink" title="Node agents"></a>Node agents</h3><p>In distributed server configurations, each node has a node agent that works with the deployment manager to manage administration processes. A node agent is created automatically when you add (federate) a stand-alone application server node to a cell. Node agents are not included in the Base and Express configurations because a deployment manager is not needed in these architectures.</p>
<p>The node agent is an administrative server that runs on the same system as the node. It monitors the application servers on that node, routing administrative requests from the deployment manager to those application servers.</p>
<h3 id="Node-groups"><a href="#Node-groups" class="headerlink" title="Node groups"></a>Node groups</h3><p>A node group is a collection of nodes within a cell that have similar capabilities in terms of installed software, available resources, and configuration. A node group is used to define a boundary for server cluster formation so that the servers on the same node group host the same applications.<br>A DefaultNodeGroup is created automatically. The DefaultNodeGroup contains the deployment manager and any new nodes with the same platform type. A node can be a member of more than one node group.</p>
<h3 id="Cells"><a href="#Cells" class="headerlink" title="Cells"></a>Cells</h3><p>A cell is a grouping of nodes into a single administrative domain. A cell encompasses the entire management domain. In the Base and Express configurations, a cell contains one node, and that node contains one server. The left side of Figure 3-11 illustrates a system with two cells that are each accessed by their own administrative console. Each cell has a node and a stand-alone application server.<br>In a Network Deployment environment (the right side of Figure 3-11), a cell can consist of multiple nodes and node groups. These nodes and groups are all administered from a single point, the deployment manager. Figure 3-11 shows a single cell that spans two systems that are accessed by a single administrative console. The deployment manager is administering the nodes.</p>
<p>A cell configuration that contains nodes that are running on the same operating system is called a homogeneous cell.<br>It is also possible to configure a cell that consists of nodes on mixed operating systems. With this configuration, other operating systems can exist in the same WebSphere Application Server cell. </p>
<p>For example, z/OS nodes, Linux nodes, UNIX nodes, and Windows system nodes can exist in the same WebSphere Application Server cell. This configuration is called a heterogeneous cell. A heterogeneous cell requires significant planning.</p>
<h2 id="Noteworthy-points"><a href="#Noteworthy-points" class="headerlink" title="Noteworthy points"></a>Noteworthy points</h2><h3 id="Tools-utilities"><a href="#Tools-utilities" class="headerlink" title="Tools/utilities"></a>Tools/utilities</h3><ul>
<li><p>create profile</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/IBM/WebSphere85/AppServer/bin/manageprofiles.sh</span><br></pre></td></tr></table></figure>
</li>
<li><p>check server status</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/IBM/WebSphere85/AppServer/bin/serverStatus.sh -all</span><br></pre></td></tr></table></figure>
</li>
<li><p>start server </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/IBM/WebSphere85/AppServer/bin/startServer.sh SERVER_NAME</span><br></pre></td></tr></table></figure>
</li>
<li><p>start server </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/IBM/WebSphere85/AppServer/bin/stopServer.sh dmgr</span><br></pre></td></tr></table></figure>
</li>
<li><p>deploy application </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u wasadm /opt/IBM/WebSphere85/utilities/API/v1.0/AppMgmt -deploy -deployMechanism simpleDeploy -appId xxx_war -appEnvId xxx -file <span class="string">"/tmp/xxx.ear"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>stop&amp;start application </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo -u wasadm /opt/IBM/WebSphere85/utilities/API/v1.0/AppMgmt -operate -appId xxx_war -appEnvId xxx -stop</span><br><span class="line">sudo -u wasadm /opt/IBM/WebSphere85/utilities/API/v1.0/AppMgmt -operate -appId xxx_war -appEnvId xxx -start</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="To-create-profile"><a href="#To-create-profile" class="headerlink" title="To create profile"></a>To create profile</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u wasadm /opt/IBM/WebSphere85/AppServer/bin/manageprofiles.sh -create -profileName TEST_PROFILE -profilePath /opt/IBM/WebSphere85/AppServer/profiles/appprofiles/TEST_PROFILE -templatePath /opt/IBM/WebSphere85/AppServer/profileTemplates/default -serverName testSrv01 -nodeName testNode01 -hostName testserver.com -enableAdminSecurity <span class="literal">true</span> -adminUserName wasadmin -adminPassword wasadmin@12</span><br></pre></td></tr></table></figure>


<h2 id="Errors-amp-troubleshooting"><a href="#Errors-amp-troubleshooting" class="headerlink" title="Errors &amp; troubleshooting"></a>Errors &amp; troubleshooting</h2><h3 id="Server-can’t-started-after-profile-creation"><a href="#Server-can’t-started-after-profile-creation" class="headerlink" title="Server can’t started after profile creation"></a>Server can’t started after profile creation</h3><ul>
<li>You may find following errors if you try to bring up server after profile created<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo -u wasadm /opt/IBM/WebSphere85/AppServer/bin/startServer.sh TEST_PROFILE</span><br><span class="line">ADMU0116I: Tool information is being logged <span class="keyword">in</span> file</span><br><span class="line">           /opt/IBM/WebSphere85/AppServer/profiles/dmgrprofile/logs/TEST_PROFILE/startServer.log</span><br><span class="line">ADMU0128I: Starting tool with the dmgrprofile profile</span><br><span class="line">ADMU3100I: Reading configuration <span class="keyword">for</span> server: TEST_PROFILE</span><br><span class="line">ADMU0111E: Program exiting with error: java.io.FileNotFoundException:</span><br><span class="line">           /opt/IBM/WebSphere85/AppServer/profiles/dmgrprofile/config/cells/wascell/nodes/dmgrnode/servers/TEST_PROFILE/server.xml</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution:"></a>Solution:</h4><ul>
<li><p>Please use the server name, rather than the profile name , e.g. should be testSrv01, rather than TEST_PROFILE</p>
</li>
<li><p>The command should be:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u wasadm /opt/IBM/WebSphere85/AppServer/bin/startServer.sh testSrv01</span><br></pre></td></tr></table></figure>
</li>
<li><p>On the other hand, you can troubleshoot this issue by double checking the server.xml by </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ll /opt/IBM/WebSphere85/AppServer/profiles/appprofiles/TEST_PROFILE/config/cells/xxxxx/nodes/testNode01/servers/testSrv01/server.xml</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="WebServer-console-can’t-opened"><a href="#WebServer-console-can’t-opened" class="headerlink" title="WebServer console can’t opened"></a>WebServer console can’t opened</h3><ul>
<li>There are few reasones, such as:<h4 id="DNS-errors"><a href="#DNS-errors" class="headerlink" title="DNS errors"></a>DNS errors</h4></li>
<li>If the error as below:<br>This webpage is not available<br>The server at testserver.com can’t be found, because the DNS lookup failed. DNS is the network service that translates a website’s name to its Internet address.<h5 id="Solutions"><a href="#Solutions" class="headerlink" title="Solutions:"></a>Solutions:</h5>That’s maybe something wrong for DNS as stated above, so please try to either udpate hosts file in you workstation or repalce the URL by IP address, e.g.<br>replace <a href="https://testserver.com:9045/ibm/console/login.do?action=secure" target="_blank" rel="noopener">https://testserver.com:9045/ibm/console/login.do?action=secure</a> with <a href="https://123.123.112.123:9045/ibm/console/login.do?action=secure" target="_blank" rel="noopener">https://123.123.112.123:9045/ibm/console/login.do?action=secure</a></li>
</ul>
<h4 id="What’s-the-port-number-for-WAS-console"><a href="#What’s-the-port-number-for-WAS-console" class="headerlink" title="What’s the port number for WAS console"></a>What’s the port number for WAS console</h4><h5 id="You-should-get-to-know-it-after-profile-created"><a href="#You-should-get-to-know-it-after-profile-created" class="headerlink" title="You should get to know it after profile created"></a>You should get to know it after profile created</h5><p>For example, in aforesaid profile creation step, you’ll get following in output:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSTCONFSUCCESS: Success: Profile TEST_PROFILE now exists. Please consult /opt/IBM/WebSphere85/AppServer/profiles/TEST_PROFILE/logs/AboutThisProfile.txt <span class="keyword">for</span> more information about this profile.</span><br></pre></td></tr></table></figure>

<p>To check content of this file, you’ll find following snipets:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Administrative console port: 9060</span><br><span class="line">Administrative console secure port: 9043</span><br></pre></td></tr></table></figure>

<h5 id="Check-the-port-number-from-serverindex-xml"><a href="#Check-the-port-number-from-serverindex-xml" class="headerlink" title="Check the port number from serverindex.xml"></a>Check the port number from serverindex.xml</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -a2 WC_adminhost /opt/IBM/WebSphere85/AppServer/profiles/appprofiles/TEST_PROFILE/config/cells/xxxx/nodes/testNode01/serverindex.xml</span><br></pre></td></tr></table></figure>

<p>You’ll find the port number listed as below:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">endPoint</span> <span class="attr">xmi:id</span>=<span class="string">"EndPoint_1183122129645"</span> <span class="attr">host</span>=<span class="string">"testserver.com"</span> <span class="attr">port</span>=<span class="string">"9407"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">specialEndpoints</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">specialEndpoints</span> <span class="attr">xmi:id</span>=<span class="string">"NamedEndPoint_1183122129646"</span> <span class="attr">endPointName</span>=<span class="string">"WC_adminhost"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">endPoint</span> <span class="attr">xmi:id</span>=<span class="string">"EndPoint_1183122129646"</span> <span class="attr">host</span>=<span class="string">"*"</span> <span class="attr">port</span>=<span class="string">"9062"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">specialEndpoints</span>&gt;</span></span><br><span class="line">--</span><br><span class="line">      <span class="tag">&lt;<span class="name">endPoint</span> <span class="attr">xmi:id</span>=<span class="string">"EndPoint_1183122129648"</span> <span class="attr">host</span>=<span class="string">"*"</span> <span class="attr">port</span>=<span class="string">"9355"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">specialEndpoints</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">specialEndpoints</span> <span class="attr">xmi:id</span>=<span class="string">"NamedEndPoint_1183122129649"</span> <span class="attr">endPointName</span>=<span class="string">"WC_adminhost_secure"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">endPoint</span> <span class="attr">xmi:id</span>=<span class="string">"EndPoint_1183122129649"</span> <span class="attr">host</span>=<span class="string">"*"</span> <span class="attr">port</span>=<span class="string">"9045"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">specialEndpoints</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="Check-networking-amp-port-on-WAS-server"><a href="#Check-networking-amp-port-on-WAS-server" class="headerlink" title="Check networking &amp; port on WAS server"></a>Check networking &amp; port on WAS server</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@cn000tst1129 Thu Mar 30 17:07:11 /  <span class="comment">#netstat -nptlev | grep java</span></span><br><span class="line">tcp        0      0 133.14.16.2:20962           0.0.0.0:*                   LISTEN      200000000  938007     252552/java</span><br><span class="line">tcp        0      0 127.0.0.1:9635              0.0.0.0:*                   LISTEN      200000000  1048485    254902/java</span><br><span class="line">tcp        0      0 0.0.0.0:9445                0.0.0.0:*                   LISTEN      200000000  1048615    254902/java</span><br><span class="line">tcp        0      0 0.0.0.0:9062                0.0.0.0:*                   LISTEN      200000000  1048613    254902/java</span><br><span class="line">tcp        0      0 0.0.0.0:9102                0.0.0.0:*                   LISTEN      200000000  1048479    254902/java</span><br><span class="line">tcp        0      0 0.0.0.0:8882                0.0.0.0:*                   LISTEN      200000000  1048484    254902/java</span><br><span class="line">tcp        0      0 0.0.0.0:9045                0.0.0.0:*                   LISTEN      200000000  1048616    254902/java</span><br><span class="line">tcp        0      0 0.0.0.0:20950               0.0.0.0:*                   LISTEN      200000000  938036     252552/java</span><br><span class="line">tcp        0      0 0.0.0.0:20953               0.0.0.0:*                   LISTEN      200000000  937999     252552/java</span><br><span class="line">tcp        0      0 0.0.0.0:9082                0.0.0.0:*                   LISTEN      200000000  1048614    254902/java</span><br><span class="line">tcp        0      0 0.0.0.0:20954               0.0.0.0:*                   LISTEN      200000000  938118     252552/java</span><br><span class="line">tcp        0      0 0.0.0.0:2811                0.0.0.0:*                   LISTEN      200000000  1048482    254902/java</span><br><span class="line">tcp        0      0 0.0.0.0:20957               0.0.0.0:*                   LISTEN      200000000  937992     252552/java</span><br><span class="line">tcp        0      0 0.0.0.0:9407                0.0.0.0:*                   LISTEN      200000000  1048481    254902/java</span><br><span class="line">tcp        0      0 0.0.0.0:20959               0.0.0.0:*                   LISTEN      200000000  938088     252552/java</span><br><span class="line">tcp        0      0 0.0.0.0:9408                0.0.0.0:*                   LISTEN      200000000  1048480    254902/java</span><br><span class="line">tcp        0      0 127.0.0.1:20960             0.0.0.0:*                   LISTEN      200000000  938089     252552/java</span><br><span class="line">tcp        0      0 133.14.16.2:20961           0.0.0.0:*                   LISTEN      200000000  938047     252552/java</span><br></pre></td></tr></table></figure>


        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017-06-24-JDK-sources/">
                JDK source
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2019-05-31</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="interface-RandomAccess"><a href="#interface-RandomAccess" class="headerlink" title="interface RandomAccess"></a>interface RandomAccess</h1><p>Marker interface used by List implementations to indicate that they support fast (generally constant time) random access. The primary purpose of this interface is to allow generic algorithms to alter their behavior to provide good performance when applied to either random or sequential access lists.</p>
<p> Such a List implementation should generally implement this interface. As a rule of thumb, a List implementation should implement this interface if, for typical instances of the class, this loop:</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>, n=list.size(); i &lt; n; i++)</span><br><span class="line">           list.get(i);</span><br><span class="line">   </span><br><span class="line"><span class="comment">// runs faster than this loop:</span></span><br><span class="line">       <span class="keyword">for</span> (Iterator i=list.iterator(); i.hasNext(); )</span><br><span class="line">           i.next();</span><br></pre></td></tr></table></figure>


        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017-11-27-TypeScript/">
                TypeScript noteworthy notes
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2019-05-31</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="Async-Await-keywords"><a href="#Async-Await-keywords" class="headerlink" title="Async Await keywords"></a>Async Await keywords</h1><p>Async Await Support in TypeScript<br>Async - Await has been supported by TypeScript since version 1.7. Asynchronous functions are prefixed with the async keyword; await suspends the execution until an asynchronous function return promise is fulfilled and unwraps the value from the Promise returned. It was only supported for target es6 transpiling directly to ES6 generators.</p>
<h1 id="Troubleshotting"><a href="#Troubleshotting" class="headerlink" title="Troubleshotting"></a>Troubleshotting</h1><h2 id="Unexpected-token-…"><a href="#Unexpected-token-…" class="headerlink" title="Unexpected token …"></a>Unexpected token …</h2><p>That’s because your node version is lower (e.g. node v4.x), which don’t support spread operator. You’d firstly check your node version </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure>

<p>If above result say node is v4.x, then you should run following commands to upgrade your node. Normally you can leverage Node Package Manager <code>n</code> as below:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo npm install -g n</span><br><span class="line">sudo n stable</span><br></pre></td></tr></table></figure>


        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017-11-29-OpenShift/">
                Openshift tips
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2019-05-31</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="Commands-bible"><a href="#Commands-bible" class="headerlink" title="Commands bible"></a>Commands bible</h1><h2 id="install-cli-in-Mac"><a href="#install-cli-in-Mac" class="headerlink" title="install cli in Mac"></a>install cli in Mac</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install openshift-cli</span><br></pre></td></tr></table></figure>

<h2 id="Frequently-used-commands"><a href="#Frequently-used-commands" class="headerlink" title="Frequently used commands"></a>Frequently used commands</h2><h3 id="Start-mini-shift"><a href="#Start-mini-shift" class="headerlink" title="Start mini shift"></a>Start mini shift</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">minishift start</span><br></pre></td></tr></table></figure>

<h3 id="OC-commands"><a href="#OC-commands" class="headerlink" title="OC commands"></a>OC commands</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oc config view</span><br></pre></td></tr></table></figure>

<h4 id="Start-a-new-application"><a href="#Start-a-new-application" class="headerlink" title="Start a new application"></a>Start a new application</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oc new-app https://github.com/openshift/nodejs-ex -l name=toddapp</span><br></pre></td></tr></table></figure>

<h4 id="To-switch-project"><a href="#To-switch-project" class="headerlink" title="To switch project"></a>To switch project</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oc project</span><br></pre></td></tr></table></figure>

<h4 id="Show-a-high-level-overview-of-the-current-project"><a href="#Show-a-high-level-overview-of-the-current-project" class="headerlink" title="Show a high level overview of the current project"></a>Show a high level overview of the current project</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">oc status</span><br><span class="line"><span class="comment"># Export the overview of the current project in an svg file.</span></span><br><span class="line">  oc status -o dot | dot -T svg -o project.svg</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># See an overview of the current project including details for any identified issues.</span></span><br><span class="line">  oc status -v</span><br></pre></td></tr></table></figure>

<p>This command will show services, deployment configs, build configurations, and active deployments.<br>If you have any misconfigured components information about them will be shown. For more information<br>about individual items, use the describe command (e.g. oc describe buildConfig, oc describe<br>deploymentConfig, oc describe service). </p>
<p>You can specify an output format of “-o dot” to have this command output the generated status graph<br>in DOT format that is suitable for use by the “dot” command.</p>
<h2 id="OpenShift-command-line-tool"><a href="#OpenShift-command-line-tool" class="headerlink" title="OpenShift command-line tool"></a>OpenShift command-line tool</h2><p>The OpenShift command-line tool oc is the primary way most users interact with OpenShift. The command-line tool talks via a REST API exposed by the OpenShift cluster. </p>
<h2 id="Pod"><a href="#Pod" class="headerlink" title="Pod"></a>Pod</h2><p>The most basic unit in OpenShift are pods. A pod is one or more containers guaranteed to be running on the same host. The containers within a pod share a unique IP address. They can communicate with each other via the “localhost” and also all share any volumes (persistent storage). The containers themselves are started from an image, which in our case is a Docker image.    </p>
<p>OpenShift Origin leverages the Kubernetes concept of a pod, which is one or more containers deployed together on one host, and the smallest compute unit that can be defined, deployed, and managed.</p>
<p>Pods are the rough equivalent of a machine instance (physical or virtual) to a container. Each pod is allocated its own internal IP address, therefore owning its entire port space, and containers within pods can share their local storage and networking.</p>
<p>Pods have a lifecycle; they are defined, then they are assigned to run on a node, then they run until their container(s) exit or they are removed for some other reason. Pods, depending on policy and exit code, may be removed after exiting, or may be retained in order to enable access to the logs of their containers.</p>
<p>Pods have a lifecycle; they are defined, then they are assigned to run on a node, then they run until their container(s) exit or they are removed for some other reason. Pods, depending on policy and exit code, may be removed after exiting, or may be retained in order to enable access to the logs of their containers.</p>
<p>OpenShift Origin treats pods as largely immutable; changes cannot be made to a pod definition while it is running. OpenShift Origin implements changes by terminating an existing pod and recreating it with modified configuration, base image(s), or both. Pods are also treated as expendable, and do not maintain state when recreated. Therefore pods should usually be managed by higher-level controllers, rather than directly by users.</p>
<h2 id="Scale-up"><a href="#Scale-up" class="headerlink" title="Scale up"></a>Scale up</h2><p>When scaled up, an application will have more than one copy of itself, and each copy will have its own local state. Each copy corresponds to a different instance of a pod with the pods being managed by the replication controller. As each pod has a unique IP, we need an easy way to address the set of all pods as a whole. This is where a service comes into play. The service gets its own IP and a DNS name. When making a connection to a service, OpenShift will automatically route the connection to one of the pods associated with that service.</p>
<p>caling from the Web Console<br>Scaling up the number of instances of your application running can be done from the Overview page for your application in the OpenShift web console (the page with those tell-tale up and down arrows we saw previously). Jump to that page and click the up arrow key twice to increase the replica count to 3<br>If your application is a web application that adheres to the 12-factor methodology, or what might also be called a cloud native application, then it would generally be safe to scale up.</p>
<p>Applications that can’t usually be able to be scaled up include traditional relational databases backed by persistent storage. Databases cannot be scaled in the traditional way as only the primary instance of the database should have the ability to update data. Scaling can still be performed, but usually only on read-only instances of the database.</p>
<h2 id="Kubernetes-and-Openshift"><a href="#Kubernetes-and-Openshift" class="headerlink" title="Kubernetes and Openshift"></a>Kubernetes and Openshift</h2><p>The basic concepts of Kubernetes and discuss how OpenShift builds on them. In general, you can view Kubernetes as being aimed at Ops teams, providing them with a tool for running containers at scale in production. OpenShift adds to this by also supporting the work of a Dev team and others by making the job of the Ops team easier, which helps to bridge the gap between Dev and Ops and thus enable the latest DevOps philosophy.OpenShift provides a number of different ways to interact with an OpenShift cluster. The OpenShift command-line tool oc is the primary way most users interact with OpenShift. The command-line tool talks via a REST API exposed by the OpenShift cluster.<br>If you want to avoid using the command line tool, or you want to automate your interactions with the OpenShift cluster, you can always use the REST API directly.</p>
<p>You may be wondering: “Is a namespace the same thing as an application?” OpenShift has no formal concept of an application, thereby allowing an application to be flexible depending on a user’s needs.</p>
<p>You can dedicate one to everything related to just one application. Or, so long as you label all the resources making up an application so you know what goes with what, you can also use the namespace to hold more than one.</p>
<h1 id="Secrets"><a href="#Secrets" class="headerlink" title="Secrets"></a>Secrets</h1><p>This topic discusses important properties of secrets and provides an overview on how developers can use them.</p>
<p>The Secret object type provides a mechanism to hold sensitive information such as passwords, OpenShift Origin client configuration files, dockercfg files, private source repository credentials, and so on. Secrets decouple sensitive content from the pods. You can mount secrets into containers using a volume plug-in or the system can use secrets to perform actions on behalf of a pod.</p>
<h2 id="Route"><a href="#Route" class="headerlink" title="Route"></a>Route</h2><p>Although a service has a DNS name, it is still only accessible within the OpenShift cluster and is not accessible externally. To make a service externally accessible, a route needs to be created. Creating a route automatically sets up haproxy or a hardware-based router, with an externally addressable DNS name, exposing the service and load-balancing inbound traffic across the pods.</p>
<h2 id="image"><a href="#image" class="headerlink" title="image"></a>image</h2><p>The output of the build process is an image, which is stored in an integrated Docker registry ready for distribution out to nodes when the application is deployed. The image stream is how the image and its versions are tracked by OpenShift. If you already have an existing Docker image on an external registry such as Docker Hub, it can also be referenced by an image stream instead of building it locally.</p>
<p>use the handy online cheat sheet available by running the oc types command. It gives you a quick summary of the different conceptual types and definitions used in OpenShift like those we covered here:</p>
<h2 id="Vagrant"><a href="#Vagrant" class="headerlink" title="Vagrant"></a>Vagrant</h2><p>Vagrant is a software tool that allows users to create and configure lightweight, reproducible, and portable development environments. It works in conjunction with virtualization (both VMs and IaaS) to automate all the steps necessary to get your dev environment going</p>
<p>One of the advantages of creating and deploying applications from the web console is that a route is automatically created for you. When deploying new containers while using the oc tool, you will need to expose the service manually</p>
<h2 id="Volumes"><a href="#Volumes" class="headerlink" title="Volumes"></a>Volumes</h2><p>One of the great features of the OpenShift platform is the ability to provide persistent volumes for your running pods. This ensures that data in your database doesn’t suddenly disappear if the container is restarted. Another important aspect of persistent volumes is the ability to run both stateful and stateless applications on the platform. This is sometimes referred to as mode 1 and mode 2 applications as well as legacy and 12-factor applications.</p>
<h2 id="webhooks"><a href="#webhooks" class="headerlink" title="webhooks"></a>webhooks</h2><p>Automatic Deployments Using Webhooks<br>A webhook (also called a web callback or HTTP push API) is a way an application can provide other applications with real-time information or notifications.</p>
<p>We can configure the GitHub code hosting service to trigger a webhook each time we push a set of changes to your project code repository. Using this tool, we can notify OpenShift when you have made code changes and thus initiate rebuild and redeployment of our application.</p>
<h2 id="Deployment-Strategies"><a href="#Deployment-Strategies" class="headerlink" title="Deployment Strategies"></a>Deployment Strategies</h2><p>A deployment strategy defines the process by which a new version of your application is started and the existing instances shut down. By default OpenShift uses a rolling deployment strategy that enables you to perform an update with no apparent down time.</p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017-09-04-Google-Analytics/">
                google analysis
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2019-05-31</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="How-Page-Value-is-calculated"><a href="#How-Page-Value-is-calculated" class="headerlink" title="How Page Value is calculated"></a>How Page Value is calculated</h1><h2 id="At-a-glance"><a href="#At-a-glance" class="headerlink" title="At a glance"></a>At a glance</h2><p>Page Value is the average value for a page that a user visited before landing on the goal page or completing an Ecommerce transaction (or both). This value is intended to give you an idea of which page in your site contributed more to your site’s revenue. If the page wasn’t involved in an ecommerce transaction for your website in any way, then the Page Value for that page will be $0 since the page was never visited in a session where a transaction occurred.</p>
<p>Below is the equation you can follow to calculate Page Value. Please note that the unique pageview statistic represents the number of individual users who have loaded a given page per session. Each user is counted only once per session, no matter how many pages are opened by the same user.</p>
<p>Ecommerce Revenue + Total Goal Value<br>Number of Unique Pageviews for Given Page</p>
<h2 id="In-depth"><a href="#In-depth" class="headerlink" title="In depth"></a>In depth</h2><p>The first example above illustrates how Page Value works. Let’s say you want to know the Page Value for Page B, and you know the following factors:</p>
<p>Goal page D: $10 (Remember, you assign the value of the Goal page when you first create a goal in the Analytics Settings page)<br>Receipt Page E: $100 (This page is where the user makes an ecommerce transaction of $100)<br>Unique pageview for Page B: One</p>
<p>You would then set up your Page Value equation like this:</p>
<p>Ecommerce Revenue ($100) + Total Goal Value ($10)<br>Number of Unique Pageviews for Page B (1)</p>
<p>Page Value for Page B is $110 since a user visits Page B only once before the goal page during this session.</p>
<p>Now let’s explore how Page Value for Page B is affected when we combine the data from two different sessions. You can see that Page B is viewed only once during Session 1, but during Session 2 it gets two pageviews (we’re assuming the two pageviews are from the same user). The total Ecommerce revenue stays the same during both sessions. Although there were two unique pageviews, there was still only one Ecommerce transaction total for both sessions.</p>
<p>Goal page D: $10<br>Receipt Page E: $100<br>Unique pageview for Page B: Two</p>
<p>Your Page Value calculation should be adjusted to look like this:</p>
<p>Ecommerce Revenue ($100) + Total Goal Value ($10 x 2 sessions)<br>Number of Unique Pageviews for Page B (2)</p>
<p>Page Value for Page B across two sessions is then $60, or $120 divided by two sessions.</p>
<h1 id="Code-snippet-about-setting-up-GA-in-your-site"><a href="#Code-snippet-about-setting-up-GA-in-your-site" class="headerlink" title="Code snippet about setting up GA in your site"></a>Code snippet about setting up GA in your site</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">window</span>.ga=<span class="built_in">window</span>.ga||<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;(ga.q=ga.q||[]).push(<span class="built_in">arguments</span>)&#125;;ga.l=+<span class="keyword">new</span> <span class="built_in">Date</span>;</span></span><br><span class="line"><span class="javascript">                ga(<span class="string">'create'</span>, <span class="string">'UA-xxxx-1'</span>, <span class="string">'auto'</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">                        <span class="keyword">var</span> hostName = <span class="built_in">window</span>.location.host;</span></span><br><span class="line"><span class="javascript">                                <span class="keyword">var</span> ga_script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span></span><br><span class="line"><span class="javascript">                                        ga_script.setAttribute(<span class="string">'async'</span>,<span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">                                                <span class="keyword">if</span> ([<span class="string">'localhost:9000'</span>,<span class="string">'test'</span>,<span class="string">'uat'</span>].some(<span class="function"><span class="keyword">function</span>(<span class="params">hostItem</span>)</span>&#123;<span class="keyword">return</span> hostName.indexOf(hostItem)&gt;<span class="number">-1</span>&#125;)) &#123;</span></span><br><span class="line"><span class="javascript">                                                                <span class="comment">// non-production</span></span></span><br><span class="line"><span class="javascript">                                                                            ga_script.setAttribute(<span class="string">'src'</span>,<span class="string">'https://www.google-analytics.com/analytics_debug.js'</span>);</span></span><br><span class="line"><span class="javascript">                                                                                        <span class="built_in">window</span>.ga_debug = &#123;<span class="attr">trace</span>: <span class="literal">true</span>&#125;;</span></span><br><span class="line"><span class="javascript">                                                                                                &#125;<span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">                                                                                                                ga_script.setAttribute(<span class="string">'src'</span>,<span class="string">'https://www.google-analytics.com/analytics.js'</span>);</span></span><br><span class="line">                                                                                                                        &#125;</span><br><span class="line"><span class="javascript">                                                                                                                                <span class="built_in">document</span>.head.appendChild(ga_script);</span></span><br><span class="line"><span class="javascript">                                                                                                                                        ga(<span class="string">'send'</span>, <span class="string">'pageview'</span>);</span></span><br><span class="line">                                                                                                                                            <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<pre><code><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$rootScope.$on(<span class="string">'$stateChangeSuccess'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                    $<span class="built_in">window</span>.ga(<span class="string">'send'</span>, <span class="string">'pageview'</span>, $location.path());</span><br><span class="line">                                    $<span class="built_in">window</span>.scrollTo(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                                                &#125;);</span><br></pre></td></tr></table></figure>

Alternative async tracking snippet
While the JavaScript tracking snippet described above ensures the script will be loaded and executed asynchronously on all browsers, it has the disadvantage of not allowing modern browsers to preload the script.
The alternative async tracking snippet below adds support for preloading, which will provide a small performance boost on modern browsers, but can degrade to synchronous loading and execution on IE 9 and older mobile browsers that do not recognize the async script attribute. Only use this tracking snippet if your visitors primarily use modern
browsers to access your site.

&lt;!-- Google Analytics --&gt;
&lt;script&gt;
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga(&apos;create&apos;, &apos;UA-XXXXX-Y&apos;, &apos;auto&apos;);
ga(&apos;send&apos;, &apos;pageview&apos;);
&lt;/script&gt;
&lt;script async src=&apos;https://www.google-analytics.com/analytics.js&apos;&gt;&lt;/script&gt;
&lt;!-- End Google Analytics --&gt;

From &lt;https://developers.google.com/analytics/devguides/collection/analyticsjs/&gt; 
What data does the tracking snippet capture?
When you add either of these tracking snippets to your website, you send a pageview for each page your users visit. Google Analytics processes this data and can infer a great deal of information including:
• The total time a user spends on your site.
• The time a user spends on each page and in what order those pages were visited.
• What internal links were clicked (based on the URL of the next pageview).
In addition, the IP address, user agent string, and initial page inspection analytics.js does when creating a new tracker is used to determine things like the following:
• The geographic location of the user.
• What browser and operating system are being used.
• Screen size and whether Flash or Java is installed.
• The referring site.

From &lt;https://developers.google.com/analytics/devguides/collection/analyticsjs/#alternative_async_tracking_snippet&gt; 


How analytics.js Works

From &lt;https://developers.google.com/analytics/devguides/collection/analyticsjs/how-analyticsjs-works&gt; 

The ga command queue
The JavaScript tracking snippet defines a global ga function known as the &quot;command queue&quot;. It&apos;s called the command queue because rather than executing the commands it receives immediately, it adds them to a queue that delays execution until the analytics.js library is fully loaded.
In JavaScript, functions are also objects, which means they can contain properties. The tracking snippet defines a q property on the ga function object as an empty array. Prior to the analytics.js library being loaded, calling the ga() function appends the list of arguments passed to the ga()function to the end of the q array.
For example, if you were to run the tracking snippet and then immediately log the contents of ga.qto the console, you&apos;d see an array, two items in length, containing the two sets of arguments already passed to the ga() function:

console.log(ga.q);

// Outputs the following:
// [
//   [&apos;create&apos;, &apos;UA-XXXXX-Y&apos;, &apos;auto&apos;],
//   [&apos;send&apos;, &apos;pageview&apos;]
// ]
Once the analytics.js library is loaded, it inspects the contents of the ga.q array and executes each command in order. After that, the ga() function is redefined, so all subsequent calls execute immediately.
This pattern allows developers to use the ga() command queue without having to worry about whether or not the analytics.js library has finished loading. It provides a simple, synchronous-looking interface that abstracts away most of the complexities of asynchronous code.

From &lt;https://developers.google.com/analytics/devguides/collection/analyticsjs/how-analyticsjs-works&gt; 

Adding commands to the queue
All calls to the ga() command queue share a common signature. The first parameter, the &quot;command&quot;, is a string that identifies a particular analytics.js method. Any additional parameters are the arguments that get passed to that method.
The method a particular command refers to can be a global method, like create, a method on the ga object, or it can be an instance method on a tracker object, like send. If the ga() command queue receives a command it doesn&apos;t recognize, it simply ignores it, making calls to the ga()function very safe, as they will almost never result in an error.
For a comprehensive list of all commands that can be executed via the command queue, see the ga() command queue reference.

From &lt;https://developers.google.com/analytics/devguides/collection/analyticsjs/how-analyticsjs-works&gt; 

Command parameters
Most analytics.js commands (and their corresponding methods) accept parameters in a number of different formats. This is done as a convenience to make it easier to pass commonly used fields to certain methods.
As an example, consider the two commands in the JavaScript tracking snippet:

ga(&apos;create&apos;, &apos;UA-XXXXX-Y&apos;, &apos;auto&apos;);
ga(&apos;send&apos;, &apos;pageview&apos;);
In the first command, create accepts the fields trackingId, cookieDomain, and name to optionally be specified as the second, third, and fourth parameters, respectively. The sendcommand accepts an optional hitType second parameter.
All commands accept a final fieldsObject parameter that can be used to specify any fields as well. For example, the above two commands in the tracking snippet could be rewritten as:

ga(&apos;create&apos;, {
      trackingId: &apos;UA-XXXXX-Y&apos;,
        cookieDomain: &apos;auto&apos;
});
ga(&apos;send&apos;, {
      hitType: &apos;pageview&apos;
});
See the ga() command queue reference for a comprehensive list of the optional parameters allowed for each of the commands.

From &lt;https://developers.google.com/analytics/devguides/collection/analyticsjs/how-analyticsjs-works&gt; 


Creating Trackers
• Contents
• The create method
• Naming trackers
• Specifying fields at creation time
• Working with multiple trackers
• Running commands for a specific tracker
• Next steps
Tracker objects (also known as &quot;trackers&quot;) are objects that can collect and store data and then send that data to Google Analytics.
When creating a new tracker, you must specify a tracking ID (which is the same as the property ID that corresponds to one of your Google Analytics properties) as well as a cookie domain, which specifies how cookies are stored. (The recommended value &apos;auto&apos; specifies automatic cookie domain configuration.)
If a cookie does not exist for the specified domain, a client ID is generated and stored in the cookie, and the user is identified as new. If a cookie exists containing a client ID value, that client ID is set on the tracker, and the user is identified as returning.
Upon creation, tracker objects also gather information about the current browsing context such as the page title and URL, and information about the device such as screen resolution, viewport size, and document encoding. When it&apos;s time to send data to Google Analytics, all of the information currently stored on the tracker gets sent.

From &lt;https://developers.google.com/analytics/devguides/collection/analyticsjs/creating-trackers&gt; 

Running commands for a specific tracker
To run analytics.js commands for a specific tracker, you prefix the command name with the tracker name, followed by a dot. When you don&apos;t specify a tracker name, the command is run on the default tracker.
To send pageviews for the above two trackers, you&apos;d run the following two commands:

ga(&apos;send&apos;, &apos;pageview&apos;);
ga(&apos;clientTracker.send&apos;, &apos;pageview&apos;);
Future guides will go into more detail on the syntax for running specific commands. You can also refer to the command queue reference to see the full command syntax for all analytics.js commands.

From &lt;https://developers.google.com/analytics/devguides/collection/analyticsjs/creating-trackers&gt; 

Getting trackers via ga Object methods
If you&apos;re not using a default tracker, or if you have more than one tracker on the page, you can access those trackers via one of the ga object methods.
Once the analytics.js library is fully loaded, it adds additional methods to the ga object itself. Two of those methods, getByName and getAll, are used to access tracker objects.
Note: ga object methods are only available when analytics.js has fully loaded, so you should only reference them inside a ready callback.
getByName
If you know the name of the tracker you want to access, you can do so using the getByNamemethod:

ga(&apos;create&apos;, &apos;UA-XXXXX-Y&apos;, &apos;auto&apos;, &apos;myTracker&apos;);

ga(function() {
      // Logs the &quot;myTracker&quot; tracker object to the console.
        console.log(ga.getByName(&apos;myTracker&apos;));
});

From &lt;https://developers.google.com/analytics/devguides/collection/analyticsjs/accessing-trackers&gt; 

The last line of the JavaScript tracking snippet adds a send command to the ga() command queue to send a pageview to Google Analytics:

ga(&apos;create&apos;, &apos;UA-XXXXX-Y&apos;, &apos;auto&apos;);
ga(&apos;send&apos;, &apos;pageview&apos;);
The object that is doing the sending is the tracker that was scheduled for creation in the previous line of code, and the data that gets sent is the data stored on that tracker.
This guide describes the various ways to send data to Google Analytics and explains how to control what data gets sent.

From &lt;https://developers.google.com/analytics/devguides/collection/analyticsjs/sending-hits&gt; 

Hits, hit types, and the Measurement Protocol
When a tracker sends data to Google Analytics it&apos;s called sending a hit, and every hit must have a hit type. The JavaScript tracking snippet sends a hit of type pageview; other hit types include screenview, event, transaction, item, social, exception, and timing. This guide outlines the concepts and methods common to all hit types. Individual guides
for each hit type can be found under the section Tracking common user interactions in the left-side navigation.
    The hit is an HTTP request, consisting of field and value pairs encoded as a query string, and sent to the Measurement Protocol.

    From &lt;https://developers.google.com/analytics/devguides/collection/analyticsjs/sending-hits&gt; 

    The simplest way to use the send command, that works for all hit types, is to pass all fields using the fieldsObjectparameter. For example:

    ga(&apos;send&apos;, {
          hitType: &apos;event&apos;,
            eventCategory: &apos;Video&apos;,
              eventAction: &apos;play&apos;,
                eventLabel: &apos;cats.mp4&apos;
    });
    For convenience, certain hit types allow commonly used fields to be passed directly as arguments to the sendcommand. For example, the above send command for the &quot;event&quot; hit type could be rewritten as:

    ga(&apos;send&apos;, &apos;event&apos;, &apos;Video&apos;, &apos;play&apos;, &apos;cats.mp4&apos;);
    For a complete list of what fields can be passed as arguments for the various hit types, see the &quot;parameters&quot; section of the send method reference.


    From &lt;https://developers.google.com/analytics/devguides/collection/analyticsjs/sending-hits&gt; </code></pre>
        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017-12-02-Container/">
                Container
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2019-05-31</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <p>The Docker project was responsible for popularizing container development in Linux systems. The original project defined a command and service (both named docker) and a format in which containers are structured. This chapter provides a hands-on approach to using the docker command and service to begin working with containers in Red Hat Enterprise Linux 7 and RHEL Atomic Host by getting and using container images and working with running containers. </p>
<p> Containers provide a means of packaging applications in lightweight, portable entities. Running applications within containers offers the following advantages:</p>
<ul>
<li><strong>Smaller than Virtual Machines</strong>: Because container images include only the content needed to run an application, saving and sharing is much more efficient with containers than it is with virtual machines (which include entire operating systems)</li>
<li><strong>Improved performance</strong>: Likewise, since you are not running an entirely separate operating system, a container will typically run faster than an application that carries with it the overhead of a whole new virtual machine.</li>
<li><strong>Secure</strong>: Because a container typically has its own network interfaces, file system, and memory, the application running in that container can be isolated and secured from other activities on a host computer.</li>
<li><strong>Flexible</strong>: With an application’s run time requirements included with the application in the container, a container is capable of being run in multiple environments. </li>
</ul>
<p>RHEL Atomic Host is a light-weight Linux operating system distribution that was designed specifically for running containers. It contains two different versions of the docker service, as well as some services that can be used to orchestrate and manage Docker containers, such as Kubernetes. Only one version of the docker service can be running at a time. </p>
<h1 id="Images"><a href="#Images" class="headerlink" title="Images"></a>Images</h1><p>Containers in OpenShift Origin are based on Docker-formatted container images. An image is a binary that includes all of the requirements for running a single container, as well as metadata describing its needs and capabilities.</p>
<p>You can think of it as a packaging technology. Containers only have access to resources defined in the image unless you give the container additional access when creating it. By deploying the same image in multiple containers across multiple hosts and load balancing between them, OpenShift Origin can provide redundancy and horizontal scaling for a service packaged into an image.</p>
<h2 id="Container-Registries"><a href="#Container-Registries" class="headerlink" title="Container Registries"></a>Container Registries</h2><p>A container registry is a service for storing and retrieving Docker-formatted container images. A registry contains a collection of one or more image repositories. Each image repository contains one or more tagged images. Docker provides its own registry, the Docker Hub, and you can also use private or third-party registries. Red Hat provides a registry at registry.access.redhat.com for subscribers. OpenShift Origin can also supply its own internal registry for managing custom container images.</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul>
<li><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux_atomic_host/7/single/getting_started_with_containers/index#introduction_to_linux_containers" target="_blank" rel="noopener">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux_atomic_host/7/single/getting_started_with_containers/index#introduction_to_linux_containers</a></li>
</ul>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2017-02-01-Concurrent-In-Java-col-2/">
                Java Concurrent Column 2
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2019-05-31</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="This-is-the-second-half-about-Java-Concurrent-of-my-blog"><a href="#This-is-the-second-half-about-Java-Concurrent-of-my-blog" class="headerlink" title="This is the second half about Java Concurrent of my blog"></a>This is the second half about Java Concurrent of my blog</h1><h2 id="non-blocking-synchronization"><a href="#non-blocking-synchronization" class="headerlink" title="non-blocking synchronization"></a>non-blocking synchronization</h2><ul>
<li>Much of the recent research on concurrent algorithms has focused on nonblock- ing algorithms, which use low-level atomic machine instructions such as compare- and-swap instead of locks to ensure data integrity under concurrent access. Non- blocking algorithms are used extensively in operating systems and JVMs for thread and process scheduling, garbage collection, and to implement locks and other concurrent data structures.</li>
<li>Nonblocking algorithms are considerably more complicated to design and im- plement than lock-based alternatives, but they can <strong>offer significant scalability and liveness advantages</strong>. They coordinate at a finer level of granularity and can greatly reduce scheduling overhead because they don’t block when multiple threads contend for the same data. Further, they are <code>immune to deadlock and other liveness problems</code>. In lock-based algorithms, other threads cannot make progress if a thread goes to sleep or spins while holding a lock, whereas <code>nonblocking algorithms are impervious to individual thread failures</code>. As of Java 5.0, it is possible to build efficient <strong>nonblocking algorithms in Java using the atomic variable classes such as AtomicInteger and AtomicReference</strong>.</li>
<li>Atomic variables can also be used as <strong>“better volatile variables”</strong> even if you are not developing nonblocking algorithms. <code>Atomic variables offer the same memory semantics as volatile variables</code>, but with additional support for atomic updates— making them ideal for counters, sequence generators, and statistics gathering while offering better scalability than lock-based alternatives.</li>
<li>Coordinating access to shared state using a consistent locking protocol ensures that whichever thread holds the lock guarding a set of variables has exclusive access to those variables, and that any changes made to those variables are visible to other threads that subsequently acquire the lock.</li>
<li><code>Volatile variables are a lighter-weight synchronization mechanism</code> than locking <code>because they do not involve context switches or thread scheduling</code>. However, volatile variables have some limitations compared to locking: while they provide similar visibility guarantees, they <code>cannot be used to construct atomic compound actions</code>. This means that volatile variables cannot be used when one variable de- pends on another, or when the new value of a variable depends on its old value. This limits when volatile variables are appropriate, since they cannot be used to reliably implement common tools such as counters or mutexes.</li>
<li>This can be a serious problem <strong>if the blocked thread is a high-priority thread but the thread holding the lock is a lower-priority thread—a performance hazard known as priority inversion</strong>. Even though the higher-priority thread should have precedence, it must wait until the lock is released, and this effectively down- grades its priority to that of the lower-priority thread. If a thread holding a lock is permanently blocked (due to an infinite loop, deadlock, livelock, or other liveness failure), any threads waiting for that lock can never make progress.</li>
</ul>
<h1 id="hardware"><a href="#hardware" class="headerlink" title="hardware"></a>hardware</h1><ul>
<li><code>Exclusive locking is a pessimistic technique</code>—it assumes the worst (if you don’t lock your door, gremlins will come in and rearrange your stuff) and doesn’t proceed until you can guarantee, by acquiring the appropriate locks, that other threads will not interfere.</li>
<li>For fine-grained operations, there is an alternate approach that is often more efficient—<code>the optimistic approach</code>, whereby you proceed with an update, hopeful that you can complete it without interference. <code>This approach relies on collision detection to determine if there has been interference from other parties during the update</code>, in which case the operation fails and can be retried (or not). The optimistic approach is like the old saying, <code>“It is easier to obtain forgiveness than permission”</code>, where “easier” here means “more efficient”.</li>
<li>Processors designed for multiprocessor operation provide special instructions for managing concurrent access to shared variables. Early processors had atomic <strong>test-and-set, fetch-and-increment, or swap</strong> instructions sufficient for implementing mutexes that could in turn be used to implement more sophisticated concurrent objects. Today, nearly every modern processor has some form of atomic read- modify-write instruction, such as <strong>compare-and-swap or load-linked/store-conditional</strong>. Operating systems and JVMs use these instructions to implement locks and con- current data structures, but until Java 5.0 they had not been available directly to Java classes.</li>
</ul>
<h1 id="Compare-and-swap"><a href="#Compare-and-swap" class="headerlink" title="Compare and swap"></a>Compare and swap</h1><ul>
<li>The approach taken by most processor architectures, including IA32 and Sparc, is to implement a <strong>compare-and-swap (CAS)</strong> instruction. (Other processors, such as PowerPC, implement the same functionality with a pair of instructions: load- linked and store-conditional.) <code>CAS has three operands—a memory location V on which to operate, the expected old value A, and the new value B. CAS atomically updates V to the new value B, but only if the value in V matches the expected old value A; otherwise it does nothing</code>. In either case, it returns the value currently in V. (The <code>variant called compare-and-set instead returns whether the operation succeeded</code>.) <strong>CAS means “I think V should have the value A; if it does, put B there, otherwise don’t change it but tell me I was wrong.” CAS is an optimistic technique</strong>—<code>it proceeds with the update in the hope of success</code>, and can detect failure if another thread has updated the variable since it was last examined. SimulatedCAS in Listing 15.1 illustrates the semantics (but not the implementation or performance) of CAS.</li>
<li><code>When multiple threads attempt to update the same variable simultaneously using CAS, one wins and updates the variable’s value, and the rest lose</code>. But the losers are not punished by suspension, as they could be if they failed to acquire a lock; instead, they are told that they didn’t win the race this time but can try again. Because a thread that loses a CAS is not blocked, it can decide whether it wants to try again, take some other recovery action, or do nothing.3 This flexibility eliminates many of the liveness hazards associated with locking (though in unusual cases can introduce the risk of livelock—see Section 10.3.3).</li>
<li>CAS addresses the problem of <strong>implementing atomic read-modify-write sequences without locking</strong>, <code>because it can detect interference from other threads</code>.</li>
</ul>
<h2 id="counter-implemented-by-CAS"><a href="#counter-implemented-by-CAS" class="headerlink" title="counter implemented by CAS"></a>counter implemented by CAS</h2><ul>
<li>At first glance, the CAS-based counter looks as if it should perform worse than a lock-based counter; it has more operations and a more complicated control flow, and depends on the seemingly complicated CAS operation. But in reality, CAS-based counters significantly outperform lock-based counters if there is even a small amount of contention, and often even if there is no contention. The fast path for uncontended lock acquisition typically requires at least one CAS plus other lock-related housekeeping, so more work is going on in the best case for a lock-based counter than in the normal case for the CAS-based counter. Since the CAS succeeds most of the time (assuming low to moderate contention), the hardware will correctly predict the branch implicit in the while loop, minimizing the overhead of the more complicated control logic.</li>
<li>The language syntax for locking may be compact, but the work done by the JVM and OS to manage locks is not. Locking entails traversing a relatively com- plicated code path in the JVM and may entail OS-level locking, thread suspension, and context switches. In the best case, locking requires at least one CAS, so using locks moves the CAS out of sight but doesn’t save any actual execution cost. On the other hand, executing a CAS from within the program involves no JVM code, system calls, or scheduling activity. What looks like a longer code path at the ap- plication level is in fact a much shorter code path when JVM and OS activity are taken into account. <code>The primary disadvantage of CAS is that it forces the caller to deal with contention (by retrying, backing off, or giving up), whereas locks deal with contention automatically by blocking until the lock is available</code>.</li>
<li>Competitive forces will likely result in continued CAS performance improvement over the next sev- eral years. A good rule of thumb is that the <strong>cost of the “fast path” for uncontended lock acquisition and release on most processors is approximately twice the cost of a CAS</strong>.</li>
</ul>
<h2 id="CAS-support-in-JVM"><a href="#CAS-support-in-JVM" class="headerlink" title="CAS support in JVM"></a>CAS support in JVM</h2><ul>
<li>So, how does Java code convince the processor to execute a CAS on its behalf? Prior to Java 5.0, there was no way to do this short of writing native code. <code>In Java 5.0, low-level support was added to expose CAS operations on int, long, and object references</code>, and the <code>JVM compiles these into the most efficient means provided by the underlying hardware</code>. On platforms supporting CAS, the run- time inlines them into the appropriate machine instruction(s); <code>in the worst case, if a CAS-like instruction is not available the JVM uses a spin lock</code>. This low-level JVM support is used by the atomic variable classes (AtomicXxx in java.util.con- current.atomic) to provide an efficient CAS operation on numeric and reference types; these atomic variable classes are used, directly or indirectly, to implement most of the classes in java.util.concurrent.</li>
</ul>
<h1 id="Other-liveness-hazards"><a href="#Other-liveness-hazards" class="headerlink" title="Other liveness hazards"></a>Other liveness hazards</h1><ul>
<li>While deadlock is the most widely encountered liveness hazard, there are sev- eral other liveness hazards you may encounter in concurrent programs including starvation, missed signals, and livelock.</li>
</ul>
<h2 id="Starvation"><a href="#Starvation" class="headerlink" title="Starvation"></a>Starvation</h2><ul>
<li>Starvation occurs when a thread is perpetually denied access to resources it needs in order to make progress; the most commonly starved resource is CPU cycles. Starvation in Java applications can be caused by inappropriate use of thread prior- ities. It can also be caused by executing nonterminating constructs (infinite loops or resource waits that do not terminate) with a lock held, since other threads that need that lock will never be able to acquire it.</li>
<li>The thread priorities defined in the Thread API are merely scheduling hints. The Thread API defines ten priority levels that the JVM can map to operating system scheduling priorities as it sees fit. This mapping is platform-specific, so two Java priorities can map to the same OS priority on one system and different OS priorities on another.</li>
<li><strong>Avoid the temptation to use thread priorities, since they increase platform dependence and can cause liveness problems</strong>. Most concurrent applica- tions can use the default priority for all threads.</li>
</ul>
<h2 id="Poor-responsiveness"><a href="#Poor-responsiveness" class="headerlink" title="Poor responsiveness"></a>Poor responsiveness</h2><ul>
<li>One step removed from starvation is poor responsiveness, which is not uncom- mon in GUI applications using background threads.</li>
<li>If the work done by other threads are truly background tasks, lowering their priority can make the foreground tasks more responsive.</li>
</ul>
<h2 id="Livelock"><a href="#Livelock" class="headerlink" title="Livelock"></a>Livelock</h2><ul>
<li><strong>Livelock is a form of liveness failure</strong> in which a thread, while <strong>not blocked</strong>, still <strong>cannot make progress</strong> because it keeps retrying an operation that <strong>will always fail</strong>. </li>
<li>Livelock often occurs in transactional messaging applications, where the messaging infrastructure rolls back a transaction if a message cannot be processed successfully, and puts it back at the head of the queue. If a bug in the message handler for a particular type of message causes it to fail, <strong>every time the message is dequeued and passed to the buggy handler, the transaction is rolled back</strong>. Since the message is now back at the head of the queue, the <strong>handler is called over and over with the same result</strong>. (This is sometimes called the <strong>poison message</strong> problem.) The <strong>message handling thread is not blocked, but it will never make progress either</strong>. This form of livelock often comes from <strong>overeager error-recovery code that mistakenly treats an unrecoverable error as a recoverable one</strong>.</li>
<li>This is similar to what happens when <strong>two overly polite people</strong> are walking in opposite directions in a hallway: each steps out of the other’s way, and now they are again in each other’s way. So they both step aside again, and again, and again. . .</li>
</ul>
<h3 id="Solutions"><a href="#Solutions" class="headerlink" title="Solutions"></a>Solutions</h3><ul>
<li>The solution for this variety of livelock is <strong>to introduce some randomness into the retry mechanism</strong>. For example, when two stations in an ethernet network try to send a packet on the shared carrier at the same time, the packets collide. The stations detect the collision, and each tries to send their packet again later. If they each retry exactly one second later, they collide over and over, and neither packet ever goes out, even if there is plenty of available bandwidth. To avoid this, we make each wait an amount of time that includes a random component. (The ethernet protocol also includes exponential backoff after repeated collisions, reducing both congestion and the risk of repeated failure with multiple colliding stations.) Retrying with random waits and backoffs can be equally effective for avoiding livelock in concurrent applications.</li>
</ul>
<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><ul>
<li>Liveness failures are a serious problem because there is no way to recover from them short of aborting the application. The most common form of liveness failure is lock-ordering deadlock. Avoiding lock ordering deadlock starts at design time: ensure that when threads acquire multiple locks, they do so in a consistent order. The best way to do this is by using open calls throughout your program. This greatly reduces the number of places where multiple locks are held at once, and makes it more obvious where those places are.<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1></li>
</ul>
<h1 id="Performance"><a href="#Performance" class="headerlink" title="Performance"></a>Performance</h1><ul>
<li>One of the primary reasons to use threads is to improve performance.</li>
<li>First make your program right, then make it fast—and then only if your performance requirements and measurements tell you it needs to be faster. In designing a con- current application, squeezing out the last bit of performance is often the least of your concerns.</li>
<li>When the performance of an activity is limited by availability of a par- ticular resource, we say it is bound by that resource: CPU-bound, database-bound, etc.</li>
<li>using multiple threads always introduces some performance costs compared to the single-threaded approach. These include the overhead associated with coordinating between threads (locking, signaling, and memory synchronization), increased context switching,thread creation and teardown, and scheduling overhead. When threading is employed effectively, these costs are more than made up for by greater throughput, responsiveness, or capacity. On the other hand, a poorly designed concurrent application can perform even worse than a comparable sequential one.</li>
<li>we want to keep the CPUs busy with <strong>useful</strong> work</li>
</ul>
<h2 id="Scalability"><a href="#Scalability" class="headerlink" title="Scalability"></a>Scalability</h2><ul>
<li>Scalability describes the ability to improve throughput or capacity when additional computing resources (such as additional CPUs, memory, stor- age, or I/O bandwidth) are added.</li>
<li>Nearly all engineering decisions involve some form of tradeoff. </li>
<li>This is one of the reasons why most optimizations are premature: <strong>they are often undertaken before a clear set of requirements is available</strong>.</li>
<li>Avoid premature optimization. <strong>First make it right, then make it fast</strong>—if it is not already fast enough.</li>
<li>Measure, don’t guess.</li>
</ul>
<h3 id="Amdahl’s-law"><a href="#Amdahl’s-law" class="headerlink" title="Amdahl’s law"></a>Amdahl’s law</h3><ul>
<li>the theoretical speedup is always limited by the part of the task that cannot benefit from the improvement.</li>
<li>If F is the fraction of the calculation that must be executed serially, then Amdahl’s law says that on a machine with N processors, we can achieve a speedup of at most:<br>Speedup ≤ 1 / (F + (1 − F)/N)</li>
<li>As N approaches infinity, the maximum speedup converges to 1/F, meaning that <strong>a program in which fifty percent of the processing must be executed serially can be sped up only by a factor of two</strong>, regardless of how many processors are available, and a program in which ten percent must be executed serially can be sped up by at most a factor of ten. </li>
<li>Amdahl’s law also quantifies the efficiency cost of serialization. With ten processors, a program with 10% serialization can achieve at most a speedup of 5.3 (at 53% utilization), and with 100 processors it can achieve at most a speedup of 9.2 (at 9% utilization). It takes a lot of inefficiently utilized CPUs to never get to that factor of ten.</li>
<li>It is clear that as processor counts increase, even a small percentage of serialized execution limits how much throughput can be increased with additional computing resources.</li>
<li>All concurrent applications have some sources of serialization; if you think yours does not, look again.</li>
<li>Amdahl’s law tells us that the scalability of an application is driven by the proportion of code that must be executed serially. Since the primary source of serialization in Java programs is the exclusive resource lock, scalability can often be improved by spending less time holding locks, either by reducing lock granu- larity, reducing the duration for which locks are held, or replacing exclusive locks with nonexclusive or nonblocking alternatives.</li>
</ul>
<h1 id="Costs-introduced-by-threads"><a href="#Costs-introduced-by-threads" class="headerlink" title="Costs introduced by threads"></a>Costs introduced by threads</h1><h2 id="Context-switching"><a href="#Context-switching" class="headerlink" title="Context switching"></a>Context switching</h2><ul>
<li>Context switches are not free; thread scheduling requires manipulating shared data structures in the OS and JVM. The OS and JVM use the same CPUs your pro- gram does; more CPU time spent in JVM and OS code means less is available for your program.</li>
<li>When a new thread is switched in, the data it needs is unlikely to be in the local processor cache, so a context switch causes a flurry of cache misses, and thus threads run a little more slowly when they are first scheduled.</li>
<li>The actual cost of context switching varies across platforms, but a good rule of thumb is that a <strong>context switch costs the equivalent of 5,000 to 10,000 clock cycles</strong>, or several microseconds on most current processors.</li>
</ul>
<h2 id="memory-synchronization"><a href="#memory-synchronization" class="headerlink" title="memory synchronization"></a>memory synchronization</h2><ul>
<li>The performance cost of synchronization comes from several sources. The visibility guarantees provided by synchronized and volatile may entail using <strong>special instructions called memory barriers</strong> that can flush or invalidate caches, flush hard- ware write buffers, and stall execution pipelines. <strong>Memory barriers</strong> may also have indirect performance consequences because they <strong>inhibit other compiler optimizations</strong>; most operations cannot be reordered with memory barriers.</li>
<li>When assessing the performance impact of synchronization, it is <strong>important to distinguish between contended and uncontended synchronization</strong>. The synchronized mechanism is optimized for the uncontended case (<strong>volatile is always uncontended</strong>), and at this writing, the performance cost of <strong>a “fast-path” uncontended synchronization ranges from 20 to 250 clock cycles</strong> for most systems. While this is certainly not zero, the effect of needed, uncontended synchronization is rarely significant in overall application performance, and the alternative involves compromising safety and potentially signing yourself (or your succes- sor) up for some very painful bug hunting later.</li>
<li>Modern <strong>JVMs can reduce the cost of incidental synchronization</strong> by optimizing away locking that can be proven never to contend. If a lock object is accessible only to the current thread, the JVM is permitted to optimize away a lock acquisi- tion because there is no way another thread could synchronize on the same lock. For example, the lock acquisition in following Listing can always be eliminated by the JVM.</li>
</ul>
<p>Following synchronization has no effect</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> (<span class="keyword">new</span> Object()) &#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>More sophisticated JVMs can use <strong>escape analysis</strong> to identify when a local object reference is never published to the heap and is therefore thread-local. As below sample:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getStoogeNames</span><span class="params">()</span> </span>&#123;</span><br><span class="line">List&lt;String&gt; stooges = <span class="keyword">new</span> Vector&lt;String&gt;(); stooges.add(<span class="string">"Moe"</span>);</span><br><span class="line">stooges.add(<span class="string">"Larry"</span>);</span><br><span class="line">stooges.add(<span class="string">"Curly"</span>);</span><br><span class="line"><span class="keyword">return</span> stooges.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>the only reference to the List is the local variable stooges, and <strong>stack-confined variables are automatically thread-local</strong>. A naive execution of getStoogeNames would acquire and release the lock on the Vector four times, once for each call to add or toString. However, a smart runtime compiler can inline these calls and then see <strong>that stooges and its internal state never escape</strong>, and therefore that <strong>all four lock acquisitions can be eliminated</strong>.</p>
</li>
<li><p>Even without escape analysis, compilers can also perform <strong>lock coarsening</strong>, the <strong>merging of adjacent synchronized blocks using the same lock</strong>. For getStooge- Names, a JVM that performs lock coarsening might combine the three calls to add and the call to toString into a single lock acquisition and release, using heuristics on the relative cost of synchronization versus the instructions inside the synch- ronized block.5 Not only does this reduce the synchronization overhead, but it also gives the optimizer a much larger block to work with, likely enabling other optimizations.</p>
</li>
</ul>
<blockquote>
<p>Don’t worry excessively about the cost of uncontended synchronization. The basic mechanism is already quite fast, and JVMs can perform addi- tional optimizations that further reduce or eliminate the cost. Instead, focus optimization efforts on areas where lock contention actually occurs.</p>
</blockquote>
<ul>
<li>Synchronization by one thread can also affect the performance of other threads. Synchronization creates traffic on the shared memory bus; this bus has a limited bandwidth and is shared across all processors. If threads must compete for synchronization bandwidth, all threads using synchronization will suffer.</li>
</ul>
<h2 id="Blocking"><a href="#Blocking" class="headerlink" title="Blocking"></a>Blocking</h2><ul>
<li><strong>Uncontended synchronization</strong> can be handled <strong>entirely within the JVM</strong> (Bacon et al., 1998); <strong>contended synchronization may require OS activity</strong>, which adds to the cost. When locking is contended, the losing thread(s) must block. The JVM can implement blocking either via spin-waiting (repeatedly trying to acquire the lock until it succeeds) or by suspending the blocked thread through the operating system. Which is more efficient depends on the relationship between context switch overhead and the time until the lock becomes available; spin-waiting is preferable for short waits and suspension is preferable for long waits. Some JVMs choose between the two adaptively based on profiling data of past wait times, but most just suspend threads waiting for a lock.</li>
</ul>
<h2 id="Reducing-lock-contention"><a href="#Reducing-lock-contention" class="headerlink" title="Reducing lock contention"></a>Reducing lock contention</h2><ul>
<li>We’ve seen that <strong>serialization hurts scalability</strong> and that <strong>context switches hurt performance</strong>. <strong>Contended locking causes both</strong>, so <strong>reducing lock contention can improve both performance and scalability</strong>.
Access to resources guarded by an exclusive lock is serialized—only one thread at a time may access it. Of course, we use locks for good reasons, such as preventing data corruption, but this safety comes at a price. Persistent contention for a lock limits scalability.</li>
<li>The principal threat to scalability in concurrent applications is the exclu- sive resource lock.</li>
<li>Two factors influence the likelihood of contention for a lock: how often that lock is requested and how long it is held once acquired.7 If the product of these factors is sufficiently small, then most attempts to acquire the lock will be uncon- tended, and lock contention will not pose a significant scalability impediment.</li>
</ul>
<h3 id="There-are-three-ways-to-reduce-lock-contention"><a href="#There-are-three-ways-to-reduce-lock-contention" class="headerlink" title="There are three ways to reduce lock contention:"></a>There are three ways to reduce lock contention:</h3><ul>
<li>Reduce the duration for which locks are held;</li>
<li>Reduce the frequency with which locks are requested; or</li>
<li>Replace exclusive locks with coordination mechanisms that permit<br>greater concurrency.</li>
</ul>
<h2 id="Narrowing-lock-scope"><a href="#Narrowing-lock-scope" class="headerlink" title="Narrowing lock scope"></a>Narrowing lock scope</h2><ul>
<li><strong>An effective way to reduce the likelihood of contention is to hold locks as briefly as possible</strong>. This can be done by moving code that doesn’t require the lock out of synchronized blocks, especially for expensive operations and potentially block- ing operations such as I/O.</li>
<li>It is easy to see how holding a “hot” lock for too long can limit scalability</li>
<li>Reducing the scope of the lock in userLocationMatches substantially reduces the number of instructions that are executed with the lock held. <strong>By Amdahl’s law, this removes an impediment to scalability because the amount of serialized code is reduced</strong>.</li>
<li>Because AttributeStore has only one state variable, attributes, we can im- prove it further by the technique of <strong>delegating thread safety</strong> (Section 4.3). By replacing attributes with a thread-safe Map (a Hashtable, synchronizedMap, or Con- currentHashMap), AttributeStore can delegate all its thread safety obligations to the underlying thread-safe collection.</li>
</ul>
<h2 id="Reducing-lock-granularity"><a href="#Reducing-lock-granularity" class="headerlink" title="Reducing lock granularity"></a>Reducing lock granularity</h2><ul>
<li>The other way to reduce the fraction of time that a lock is held (and therefore the likelihood that it will be contended) is to <strong>have threads ask for it less often</strong>. This can be accomplished <strong>by lock splitting and lock striping</strong>, which involve <strong>using separate locks to guard multiple independent state variables previously guarded by a single lock</strong>. These techniques reduce the granularity at which locking occurs, potentially allowing greater scalability—but using more locks also increases the risk of deadlock.</li>
<li>If a lock guards more than one <strong>independent</strong> state variable, you may be able to improve scalability by splitting it into multiple locks that each guard different variables. This results in each lock being requested less often.</li>
<li>After splitting the lock, each new finer-grained lock will see less locking traffic than the original coarser lock would have.</li>
</ul>
<h2 id="Lock-stripping"><a href="#Lock-stripping" class="headerlink" title="Lock stripping"></a>Lock stripping</h2><ul>
<li>Splitting a heavily contended lock into two is likely to result in two heavily contended locks. </li>
<li>Lock splitting can sometimes be extended to partition locking on a variable- sized set of independent objects, in which case it is called lock striping. For exam- ple, the implementation of ConcurrentHashMap uses an array of 16 locks, each of which guards 1/16 of the hash buckets; bucket N is guarded by lock N mod 16.</li>
<li>One of the downsides of lock striping is that locking the collection for ex- clusive access is more difficult and costly than with a single lock. Usually <strong>an operation can be performed by acquiring at most one lock</strong>, but <strong>occasionally you need to lock the entire collection</strong>, as when ConcurrentHashMap needs <strong>to expand the map and rehash the values</strong> into a larger set of buckets. This is typically done by acquiring all of the locks in the stripe set</li>
<li>common optimizations such as caching frequently computed values can introduce “hot fields” that limit scalability.</li>
<li>A common optimization is to update a separate counter as entries are added or removed; this slightly increases the cost of a put or remove operation to keep the counter up-to-date, but reduces the cost of the size operation from O(n) to O(1).</li>
<li>In this case, the counter is called a <strong>hot field</strong> because every mutative operation needs to access it.</li>
<li>ConcurrentHashMap avoids this problem by having size enumerate the stripes and add up the number of elements in each stripe, instead of maintaining a global count. To avoid enumerating every element, ConcurrentHashMap maintains a separate count field for each stripe, also guarded by the stripe lock.</li>
</ul>
<h2 id="Alternative-to-exclusive-lock"><a href="#Alternative-to-exclusive-lock" class="headerlink" title="Alternative to exclusive lock"></a>Alternative to exclusive lock</h2><ul>
<li>A third technique for mitigating the effect of lock contention <strong>is to forego the use of exclusive locks</strong> in favor of a more concurrency-friendly means of managing shared state. These include <strong>using the concurrent collections, read-write locks, immutable objects and atomic variables</strong>.</li>
</ul>
<h3 id="ReadWriteLock"><a href="#ReadWriteLock" class="headerlink" title="ReadWriteLock"></a>ReadWriteLock</h3><ul>
<li>enforces a <strong>multiple-reader, single-writer</strong> locking discipline: more than one reader can access the shared resource concurrently so long as none of them wants to modify it, but writers must acquire the lock excusively. For read-mostly data structures, ReadWriteLock can offer greater concurrency than exclusive locking; <strong>for read-only data structures, immutability can eliminate the need for locking entirely</strong>.</li>
<li>Atomic variables (see Chapter 15) offer a means of reducing the cost of updat- ing “hot fields” such as statistics counters, sequence generators, or the reference</li>
<li>If size is called frequently compared to mutative operations, striped data structures can optimize for this by caching the collection size in a volatile whenever size is called and invalidating the cache (setting it to -1) whenever the collection is modified. If the cached value is nonnegative on entry to size, it is accurate and can be returned; otherwise it is recomputed.</li>
<li>The atomic variable classes pro- vide very fine-grained (and therefore more scalable) atomic operations on integers or object references, and are implemented using low-level concurrency primitives (such as compare-and-swap) provided by most modern processors. If your class has a small number of hot fields that do not participate in invariants with other variables, replacing them with atomic variables may improve scalability.</li>
</ul>
<h1 id="Comparing-Map"><a href="#Comparing-Map" class="headerlink" title="Comparing Map"></a>Comparing Map</h1><ul>
<li>The single-threaded performance of ConcurrentHashMap is slightly better than that of a synchronized HashMap, but it is in concurrent use that it really shines. The implementation of ConcurrentHashMap assumes the most common operation is retrieving a value that already exists, and is therefore optimized to <strong>provide highest performance and concurrency for successful get operations</strong>.</li>
<li>The major scalability impediment for the synchronized Map implementations is that there is a single lock for the entire map, so only one thread can access the map at a time. On the other hand, ConcurrentHashMap does no locking for most successful read operations, and <strong>uses lock striping for write operations</strong> and those few read operations that do require locking. As a result, multiple threads can access the Map concurrently without blocking.</li>
<li>The numbers for the synchronized collections are not as encouraging. Perfor- mance for the one-thread case is comparable to ConcurrentHashMap, but once the load transitions from mostly uncontended to mostly contended—which happens here at two threads—the synchronized collections suffer badly. This is common behavior for code whose scalability is limited by lock contention. So long as contention is low, time per operation is dominated by the time to actually do the work and throughput may improve as threads are added. Once contention becomes significant, time per operation is dominated by context switch and scheduling delays, and adding more threads has little effect on throughput.</li>
</ul>
<h1 id="Building-a-asynchronous-log"><a href="#Building-a-asynchronous-log" class="headerlink" title="Building a asynchronous log"></a>Building a asynchronous log</h1><ul>
<li>Building a logger that moves the I/O to another thread may improve performance, but it also introduces a number of design complications, such as interruption (what happens if a thread blocked in a logging operation is interrupted?), service guarantees (does the logger guarantee that a success- fully queued log message will be logged prior to service shutdown?), saturation policy (what happens when the producers log messages faster than the logger thread can handle them?), and service lifecycle (how do we shut down the logger, and how do we communicate the service state to producers?).</li>
</ul>
<h1 id="Reducing-context-switching"><a href="#Reducing-context-switching" class="headerlink" title="Reducing context switching"></a>Reducing context switching</h1><ul>
<li>The “get in, get out” principle of Section 11.4.1 tells us that <strong>we should hold locks as briefly as possible</strong>, because <strong>the longer a lock is held, the more likely that lock will be contended</strong>. If a thread blocks waiting for I/O while holding a lock, another thread is more likely to want the lock while the first thread is holding it. Concurrent systems perform much better when most lock acquisitions are uncontended, because contended lock acquisition means more context switches. A coding style that encourages more context switches thus yields lower overall throughput.</li>
</ul>
<h1 id="Testing-concurrency"><a href="#Testing-concurrency" class="headerlink" title="Testing concurrency"></a>Testing concurrency</h1><ul>
<li>we defined safety as “nothing bad ever happens” and liveness as “something good eventually happens”.</li>
<li>when interrupted, it throws InterruptedException. This is one of the few cases in which it is appropriate to subclass Thread explicitly instead of using a Runnable in a pool: in order to test proper termination with join.</li>
<li>The result of <strong>Thread.getState should not be used</strong> for concurrency control, and is of limited usefulness for testing—its primary utility is as a source of debugging information.</li>
<li>a common error in implementing semaphore-controlled buffers is to forget that the code actually doing the insertion and extraction requires mutual exclu- sion (using synchronized or ReentrantLock). A sample run of PutTakeTest with a version of BoundedBuffer that omits making doInsert and doExtract synch- ronized fails fairly quickly. </li>
<li><strong>Tests should be run on multiprocessor systems to increase the diversity of potential interleavings. However, having more than a few CPUs does not necessarily make tests more effective. To maximize the chance of detecting timing-sensitive data races, there should be more active threads than CPUs, so that at any given time some threads are running and some are switched out, thus reducing the predicatability of interactions between threads</strong>.</li>
<li>Tests like PutTakeTest tend to be good at finding safety violations. For exam- ple, a common error in implementing semaphore-controlled buffers is to forget that the code actually doing the insertion and extraction requires mutual exclu- sion (using synchronized or ReentrantLock). A sample run of PutTakeTest with a version of BoundedBuffer that omits making doInsert and doExtract synch- ronized fails fairly quickly. Running PutTakeTest with a few dozen threads iterating a few million times on buffers of various capacity on various systems increases our confidence about the lack of data corruption in put and take.</li>
<li>The source code <strong>PutTakeTest.java</strong> demonstreated aforesaid logic.</li>
</ul>
<h2 id="Test-resource-management"><a href="#Test-resource-management" class="headerlink" title="Test resource management"></a>Test resource management</h2><ul>
<li><strong>The tests so far have been concerned with a class’s adherence to its specifica- tion—that it does what it is supposed to do. A secondary aspect to test is that it does not do things it is not supposed to do</strong>, such as leak resources. Any object that holds or manages other objects should not continue to maintain references to those objects longer than necessary. Such storage leaks prevent garbage collectors from reclaiming memory (or threads, file handles, sockets, database connections, or other limited resources) and can lead to resource exhaustion and application failure.</li>
</ul>

        </div>
    

</div>
            
        </section>
    </div>
</div>



    <div class="row">
        <div class="col-sm-12">
            <div class="wrap-pagination">
                <a class href="/page/8/">
                    <i class="fa fa-chevron-left" aria-hidden="true"></i>
                </a>
                <a class href="/page/10/">
                    <i class="fa fa-chevron-right" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>




</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>About</h2>
                <p>
                    This theme was developed by <a href="https://github.com/klugjo">Jonathan Klughertz</a>. The source code is available on Github. Create Websites. Make Magic.
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2018-06-12-KDB/">KDB</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2019-02-26-TLS-SSL-HTTPS/">SSL certificates</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2016-09-01-Mac-Tips/">Mac tips</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2018-11-01-seconds/">Seconds</a>
            </li>
            
        </ul>
    </div>



            
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a href="https://github.com/klugjo/hexo-theme-alpha-dust">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://twitter.com/?lang=en">
                            <span class="footer-icon-container">
                                <i class="fa fa-twitter"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://www.facebook.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-facebook"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://www.instagram.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-instagram"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://dribbble.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-dribbble"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://plus.google.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-google-plus"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://www.behance.net/">
                            <span class="footer-icon-container">
                                <i class="fa fa-behance"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://500px.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-500px"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:test@example.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="\#">
                            <span class="footer-icon-container">
                                <i class="fa fa-rss"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    @Untitled. All right reserved | Design & Hexo <a href="http://www.codeblocq.com/">Jonathan Klughertz</a>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->
<script src="/js/main.js"></script>

<!-- Disqus Comments -->



</body>

</html>