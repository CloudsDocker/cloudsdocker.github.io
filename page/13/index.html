<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>Clouds &amp; Docker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Contact me via phray.zhang@gmail.com or wechat at helloworld_2000">
<meta property="og:type" content="website">
<meta property="og:title" content="Clouds &amp; Docker">
<meta property="og:url" content="http://www.todzhang.com/page/13/index.html">
<meta property="og:site_name" content="Clouds &amp; Docker">
<meta property="og:description" content="Contact me via phray.zhang@gmail.com or wechat at helloworld_2000">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Clouds &amp; Docker">
<meta name="twitter:description" content="Contact me via phray.zhang@gmail.com or wechat at helloworld_2000">
  
    <link rel="alternate" href="/atom.xml" title="Clouds &amp; Docker" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Clouds &amp; Docker</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://www.todzhang.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-2018-07-10-QuickFixJ" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018-07-10-QuickFixJ/" class="article-date">
  <time datetime="2019-05-31T13:03:27.000Z" itemprop="datePublished">2019-05-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018-07-10-QuickFixJ/">QuickFixJ</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Settings"><a href="#Settings" class="headerlink" title="Settings"></a>Settings</h1><p>A settings file is set up with two types of heading, a [DEFAULT] and a [SESSION] heading. [SESSION] tells QuickFIX/J that a new Session is being defined. [DEFAULT] is a place that you can define settings which will be inherited by sessions that do not explicitly define them. If you do not provide a setting that QuickFIX/J needs, it will throw a ConfigError telling you what setting is missing or improperly formatted.</p>
<h1 id="SSL-cipher"><a href="#SSL-cipher" class="headerlink" title="SSL cipher"></a>SSL cipher</h1><p>An SSL cipher specification in cipher-spec is composed of 4 major attributes plus a few extra minor ones.</p>
<p>Key Exchange Algorithm:<br>RSA or Diffie-Hellman variants.</p>
<p>Authentication Algorithm:<br>RSA, Diffie-Hellman, DSS or none.</p>
<p>Cipher/Encryption Algorithm:<br>DES, Triple-DES, RC4, RC2, IDEA or none.</p>
<p>MAC Digest Algorithm:<br>MD5, SHA or SHA1.</p>
<h2 id="InOut-exchange"><a href="#InOut-exchange" class="headerlink" title="InOut exchange"></a>InOut exchange</h2><p>Although the <code>FIX protocol is event-driven and asynchronous</code>, there are specific pairs of messages<br>that represent a request-reply message exchange. To use an InOut exchange pattern, there should<br>be a single request message and single reply message to the request. Examples include an<br>OrderStatusRequest message and UserRequest.</p>
<p>#FIX Sequence Number Management<br>If an application exception is thrown during synchronous exchange processing, this will cause QuickFIX/J to not increment incoming FIX message sequence numbers and will cause a resend of the counterparty message. This FIX protocol behavior is primarily intended to handle transport errors rather than application errors. There are risks associated with using this mechanism to handle application errors. The primary risk is that the message will repeatedly cause application errors each time it is re-received. A better solution is to persist the incoming message (database, JMS queue) immediately before processing it. This also allows the application to process messages asynchronously without losing messages when errors occur.</p>
<p>Although it is possible to send messages to a FIX session before it is logged on (the messages will be sent at logon time), it is usually a better practice to wait until the session is logged on. This eliminates the required sequence number resynchronization steps at logon. Waiting for session logon can be done by setting up a route that processes the SessionLogon event category and signals the application to start sending messages.</p>
<h1 id="Source-code"><a href="#Source-code" class="headerlink" title="Source code"></a>Source code</h1><h2 id="QuickFixJComponent-class"><a href="#QuickFixJComponent-class" class="headerlink" title="QuickFixJComponent.class"></a>QuickFixJComponent.class</h2><p>if (configuration != null) {<br>                        settings = configuration.createSessionSettings();<br>                    } else {<br>                        settings = QuickfixjEngine.loadSettings(remaining);<br>                    }</p>
<h2 id="MessageStore"><a href="#MessageStore" class="headerlink" title="MessageStore"></a>MessageStore</h2><p>This interface Used by a Session to store and retrieve messages for resend purposes.</p>
<ul>
<li>boolean set(int sequence, String message) throws IOException;</li>
<li>void get(int startSequence, int endSequence, Collection<string> messages) throws IOException;</string></li>
</ul>
<p>Implementations such as MemoryStore.java, it use one HashMap&lt;Integer, String&gt; to keep messages (string)</p>
<h2 id="Parse-body"><a href="#Parse-body" class="headerlink" title="Parse body"></a>Parse body</h2><p>private void parseBody(DataDictionary dd, boolean doValidation) throws InvalidMessage {<br>        for(StringField field = this.extractField(dd, this); field != null; field = this.extractField(dd, this)) {<br>            if (isTrailerField(field.getField())) {<br>                this.pushBack(field);<br>                return;<br>            }</p>
<h2 id="validate-check-sum"><a href="#validate-check-sum" class="headerlink" title="validate check sum"></a>validate check sum</h2><p>in message.class</p>
<p>private void validateCheckSum(String messageData) throws InvalidMessage {<br>        try {<br>            int checksum = this.trailer.getInt(10);<br>            if (checksum != MessageUtils.checksum(messageData)) {<br>                throw new InvalidMessage(“Expected CheckSum=” + MessageUtils.checksum(messageData) + “, Received CheckSum=” + checksum + “ in “ + messageData);<br>            }<br>}</p>
<p>the first checksum is 131</p>
<p>in MessageUtils.checksum<br>public static int checksum</p>
<p>int end = isEntireMessage ? data.lastIndexOf(“\u000110=”) : -1;<br>            int len = end &gt; -1 ? end + 1 : data.length();</p>
<pre><code>for(int i = 0; i &lt; len; ++i) {
    sum += data.charAt(i);
}

return sum &amp; 255;</code></pre><p>the checksum from above messageUtil is 87<br>?? how to get and set this.trailer.10=131 ?</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.todzhang.com/2018-07-10-QuickFixJ/" data-id="cjxaajrs2006lbhq1pontvnzw" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="page-2018-07-11-Camel" class="article article-type-page" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018-07-11-Camel/" class="article-date">
  <time datetime="2019-05-31T13:03:27.000Z" itemprop="datePublished">2019-05-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018-07-11-Camel/">Apache Camel</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Camel’s-message-model"><a href="#Camel’s-message-model" class="headerlink" title="Camel’s message model"></a>Camel’s message model</h1><p>In Camel, there are two abstractions for modeling messages, both of which we’ll cover in this section.</p>
<ul>
<li>org.apache.camel.Message—The fundamental entity containing the data being carried and routed in Camel</li>
<li>org.apache.camel.Exchange—The Camel abstraction for an exchange of mes- sages. This exchange of messages has an “in” message and as a reply, an “out” message</li>
</ul>
<h2 id="Message"><a href="#Message" class="headerlink" title="Message"></a>Message</h2><p>Messages are the entities used by systems to communicate with each other when using messaging channels. Messages flow in one direction from a sender to a receiver,  Messages have a body (a payload), headers, and optional attachments,</p>
<p>Messages are uniquely identified with an identifier of type java.lang.String. The identifier’s uniqueness is enforced and guaranteed by the message creator, it’s protocol depen- dent, and it doesn’t have a guaranteed format.<br>For protocols that don’t define a unique message identification scheme, Camel uses its own UID generator.<br>HEADERS AND ATTACHMENTS<br>Headers are values associated with the message, such as sender identifiers, hints about content encoding, authentication infor- mation, and so on. Headers are name-value pairs; the name is a unique, case-insensitive string, and the value is of type java. lang.Object. This means that Camel imposes no constraints on the type of the headers. Headers are stored as a map within the message. A message can also have optional attachments, which are typically used for the web service and email components.</p>
<h2 id="Exchange"><a href="#Exchange" class="headerlink" title="Exchange"></a>Exchange</h2><p>An exchange in Camel is the message’s container during routing. An exchange also provides support for the various types of interactions between systems, also known as message exchange patterns (MEPs). MEPs are used to differentiate between one-way and request-response messaging styles. The Camel exchange holds a pattern property that can be either</p>
<ul>
<li>InOnly—A one-way message (also known as an Event message). For example, JMS messaging is often one-way messaging.</li>
<li>InOut—A request-response message. For example, HTTP-based transports are often request reply, where a client requests to retrieve a web page, waiting for the reply from the server.</li>
</ul>
<h1 id="Start-Camel-application"><a href="#Start-Camel-application" class="headerlink" title="Start Camel application"></a>Start Camel application</h1><p>Camel doesn’t start magically by itself. Often it’s the server (container) that Camel is running inside that invokes the start method on CamelContext, starting up Camel. This is also what you saw in chapter 1, where you used Camel inside a standalone Java application. A standalone Java application isn’t the only deployment choice—you can also run Camel inside a container such as Spring or OSGi.<br>Regardless of which container you use, the same principle applies. The container must prepare and create an instance of CamelContext up front, before Camel can be started.</p>
<h2 id="Spring-container"><a href="#Spring-container" class="headerlink" title="Spring container"></a>Spring container</h2><p>Camel provides the CamelNamespaceHandler.<br>When using Camel in the Spring XML file, you would define the <camelcontext> tag as follows:<br><camelcontext xmlns="http://camel.apache.org/schema/spring"></camelcontext></camelcontext></p>
<p>The <a href="http://camel.apache.org/schema/spring" target="_blank" rel="noopener">http://camel.apache.org/schema/spring</a> namespace is the Camel custom namespace. To let Spring know about this custom namespace, it must be identified in the META-INF/spring.handlers, where you map the namespace to the class implementation:<br>http://camel.apache.org/schema/spring=<br>     org.apache.camel.spring.handler.CamelNamespaceHandler</p>
<p>The CamelNamespaceHandler is then responsible for parsing the XML and dele- gating to other factories for further pro- cessing. One of these factories is the Camel- ContextFactoryBean, which is responsible for creating the CamelContext that essen- tially is your Camel application.<br>When Spring is finished initializing, it signals to third-party frameworks that they can start by broadcasting the Context- RefreshedEvent event.</p>
<h1 id="Startup"><a href="#Startup" class="headerlink" title="Startup"></a>Startup</h1><p>At this point, CamelContext is ready to be started. What happens next is the same regardless of which container or deploy- ment option you’re using with Camel. </p>
<p>CamelContext is started by invoking its start method. The first step is to determines whether or not autostartup is enabled for Camel. If it’s disabled, the entire startup process is skipped. By default, Camel is set to autostart, which involves the following four steps.</p>
<p>1 Start internal services—Prepares and starts internal services used by Camel, such as the type-converter mechanism.<br>2 Compute starting order—Computes the order in which the routes should be started. By default, Camel will start up all the routes in the order they are defined in the Spring XML files or the RouteBuilder classes. We’ll cover how to configure the order of routes in section 13.1.3.<br>3 Prepare routes—Prepares the routes before they’re started.<br>4 Start routes—Starts the routes by starting the consumers, which essentially opens<br>the gates to Camel and lets the messages start to flow in.</p>
<p>After step 4, Camel writes a message to the log indicating that it has been started and that the startup process is complete.</p>
<h1 id="Concept"><a href="#Concept" class="headerlink" title="Concept"></a>Concept</h1><h2 id="ENDPOINT"><a href="#ENDPOINT" class="headerlink" title="ENDPOINT"></a>ENDPOINT</h2><p>An endpoint is the Camel abstraction that models the end of a channel through which a system can send or receive messages.</p>
<p>In Camel, you configure endpoints using URIs, such as </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file:data/inbox?delay=5000</span><br></pre></td></tr></table></figure>

<p> and you also refer to endpoints this way. At runtime, Camel will look up an endpoint based on the URI notation. </p>
<p>The scheme  denotes which Camel component handles that type of endpoint. In this case,<br>the scheme of file selects the FileComponent.<br>The FileComponent then works as a factory creat-<br>ing the FileEndpoint based on the remaining parts of the URI.<br>The context path data/ inbox tells the FileComponent that the starting folder is data/inbox.<br>The option, delay=5000 indicates that files should be polled at a 5 second interval.</p>
<p>There’s more to an endpoint than meets the eye. </p>
<h2 id="JMS"><a href="#JMS" class="headerlink" title="JMS"></a>JMS</h2><p>Queues are strictly point-to-point, where each message has only one consumer. Topics operate on a publish/subscribe scheme; a single message may be delivered to many consumers if they have subscribed to the topic.</p>
<p>JMS also provides a ConnectionFactory that clients (like Camel) can use to cre- ate a connection with a JMS provider. JMS providers are usually referred to as brokers because they manage the communication between a message producer and a mes- sage consumer.</p>
<h3 id="HOW-TO-CONFIGURE-CAMEL-TO-USE-A-JMS-PROVIDER"><a href="#HOW-TO-CONFIGURE-CAMEL-TO-USE-A-JMS-PROVIDER" class="headerlink" title="HOW TO CONFIGURE CAMEL TO USE A JMS PROVIDER"></a>HOW TO CONFIGURE CAMEL TO USE A JMS PROVIDER</h3><p>To connect Camel to a specific JMS provider, you need to configure Camel’s JMS com- ponent with an appropriate ConnectionFactory.<br>Apache ActiveMQ is one of the most popular open source JMS providers, and it’s the primary JMS broker that the Camel team uses to test the JMS component. </p>
<h3 id="JSM-destinations"><a href="#JSM-destinations" class="headerlink" title="JSM destinations"></a>JSM destinations</h3><p>There are two types of JMS destinations: queues and topics. The queue is a point-to-point channel, where each message has only one recipient. A topic delivers a copy of the message to all clients who have subscribed to receive it.</p>
<h3 id="ActiveMQ"><a href="#ActiveMQ" class="headerlink" title="ActiveMQ"></a>ActiveMQ</h3><p>o in the case of Apache ActiveMQ, you can create an ActiveMQConnectionFactory<br>that points to the location of the running ActiveMQ broker:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ConnectionFactory connectionFactory =</span><br><span class="line">  <span class="keyword">new</span> ActiveMQConnectionFactory(<span class="string">"vm://localhost"</span>);</span><br></pre></td></tr></table></figure>

<p>The vm://localhost URI means that you should connect to an embedded broker named “localhost” running inside the current JVM. The vm transport connector in ActiveMQ creates a broker on demand if one isn’t running already, so it’s very handy for quickly testing JMS applications; for production scenarios, it’s recommended that you connect to a broker that’s already running. </p>
<p>Next, when you create your CamelContext, you can add the JMS component as follows:<br>CamelContext context = new DefaultCamelContext();<br>context.addComponent(“jms”,<br>    JmsComponent.jmsComponentAutoAcknowledge(connectionFactory));<br>The JMS component and the ActiveMQ-specific connection factory aren’t part of the camel-core module. In order to use these, you’ll need to add some dependencies to your Maven-based project. For the plain JMS component, all you have to add is this:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.camel<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>camel-jms<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">The connection factory comes directly from ActiveMQ, so you’ll need the following dependency:</span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.activemq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activemq-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="USING-URIS-TO-SPECIFY-THE-DESTINATION"><a href="#USING-URIS-TO-SPECIFY-THE-DESTINATION" class="headerlink" title="USING URIS TO SPECIFY THE DESTINATION"></a>USING URIS TO SPECIFY THE DESTINATION</h3><p>Once the JMS component is configured, you can start sending and receiving JMS mes- sages at your leisure. Because you’re using URIs, this is a real breeze to configure.<br>Let’s say you want to send a JMS message to the queue named incomingOrders. The URI in this case would be</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jms:queue:incomingOrders</span><br></pre></td></tr></table></figure>

<p>This is pretty self-explanatory. The “jms” prefix indicates that you’re using the JMS component you configured before. By specifying “queue”, the JMS component knows to send to a queue named incomingOrders. You could even have omitted the queue<br>qualifier, because the default behavior is to send to a queue rather than a topic.</p>
<p>NOTE Some endpoints can have an intimidating list of endpoint URI proper- ties. For instance, the JMS component has about 60 options, many of which are only used in specific JMS scenarios. Camel always tries to provide built-in defaults that fit most cases, and you can always find out what the default values are by browsing to the component’s page in the online Camel documentation. </p>
<p>Using Camel’s Java DSL, you can send a message to the incomingOrders queue by using the to keyword like this:<br>…to(“jms:queue:incomingOrders”)<br>This can be read as sending to the JMS queue named incomingOrders.</p>
<h2 id="FINDING-ROUTE-BUILDERS"><a href="#FINDING-ROUTE-BUILDERS" class="headerlink" title="FINDING ROUTE BUILDERS"></a>FINDING ROUTE BUILDERS</h2><p>Using the Spring CamelContext as a runtime and the Java DSL for route development is a great way of using Camel. In fact, it’s the most frequent usage of Camel.<br>You saw before that you can explicitly tell the Spring CamelContext what route builders to load. You can do this by using the routerBuilder element:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">camelContext</span> <span class="attr">xmlns</span>=<span class="string">"http://camel.apache.org/schema/spring"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">routeBuilder</span> <span class="attr">ref</span>=<span class="string">"ftpToJmsRoute"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">camelContext</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Being this explicit results in a clean and concise definition of what is being loaded into Camel.<br>Sometimes, though, you may need to be a bit more dynamic. This is where the packageScan and contextScan elements come in:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">camelContext</span> <span class="attr">xmlns</span>=<span class="string">"http://camel.apache.org/schema/spring"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packageScan</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span>&gt;</span>camelinaction.routes<span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">packageScan</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">camelContext</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>This packageScan element will load all RouteBuilder classes found in the camelinac- tion.routes package, including all subpackages.<br>You can even be a bit more picky about what route builders are included:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">camelContext</span> <span class="attr">xmlns</span>=<span class="string">"http://camel.apache.org/schema/spring"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packageScan</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span>&gt;</span>camelinaction.routes<span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">excludes</span>&gt;</span>**.*Test*<span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">includes</span>&gt;</span>**.*<span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">packageScan</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">camelContext</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>In this case, you’re loading all route builders in the camelinaction.routes package, except for ones with “Test” in the class name. The matching syntax is similar to what is used in Apache Ant’s file pattern matchers.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.todzhang.com/2018-07-11-Camel/" data-id="cjxaajrs3006obhq1x1kaleqw" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Apache/">Apache</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Camel/">Camel</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2018-07-13-Camel" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018-07-13-Camel/" class="article-date">
  <time datetime="2019-05-31T13:03:27.000Z" itemprop="datePublished">2019-05-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018-07-13-Camel/">Camel</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Endpoints"><a href="#Endpoints" class="headerlink" title="Endpoints"></a>Endpoints</h1><p>Camel supports the Message Endpoint pattern using the Endpoint interface. Endpoints are usually created by a Component and Endpoints are usually referred to in the DSL via their URIs.</p>
<p>From an Endpoint you can use the following methods</p>
<p>createProducer() will create a Producer for sending message exchanges to the endpoint<br>createConsumer() implements the Event Driven Consumer pattern for consuming message exchanges from the endpoint via a Processor when creating a Consumer<br>createPollingConsumer() implements the Polling Consumer pattern for consuming message exchanges from the endpoint via a PollingConsumer</p>
<h1 id="implementation"><a href="#implementation" class="headerlink" title="implementation"></a>implementation</h1><p>When using the DSL to create Routes you typically refer to Message Endpoints by their URIs rather than directly using the Endpoint interface. Its then a responsibility of the CamelContext to create and activate the necessary Endpoint instances using the available Component implementations.</p>
<h1 id="connector"><a href="#connector" class="headerlink" title="connector"></a>connector</h1><p>Sub interface including Initiator.<br>abstract class SessionConnector implements Connector</p>
<h1 id="session"><a href="#session" class="headerlink" title="session"></a>session</h1><p>class Session.java</p>
<h1 id="FieldMaps"><a href="#FieldMaps" class="headerlink" title="FieldMaps"></a>FieldMaps</h1><p>Which leverage TreeMap&lt;Integer, Field&lt;?&gt;&gt; fields;</p>
<h2 id="Field"><a href="#Field" class="headerlink" title="Field"></a>Field</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Field</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Serializable</span> </span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">   <span class="title">public</span> <span class="title">Field</span>(<span class="title">int</span> <span class="title">field</span>, <span class="title">T</span> <span class="title">object</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.tag = field;</span><br><span class="line">        <span class="keyword">this</span>.object = object;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.todzhang.com/2018-07-13-Camel/" data-id="cjxaajrs4006qbhq1203lmhbe" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2018-07-16-FileUtils_Camel" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018-07-16-FileUtils_Camel/" class="article-date">
  <time datetime="2019-05-31T13:03:27.000Z" itemprop="datePublished">2019-05-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018-07-16-FileUtils_Camel/">File Util in Apache Camel</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="FileUtil-class"><a href="#FileUtil-class" class="headerlink" title="FileUtil.class"></a>FileUtil.class</h1><h2 id="compactPath-String-path"><a href="#compactPath-String-path" class="headerlink" title="compactPath(String path)"></a>compactPath(String path)</h2><p>To normalize path and join with provided separator</p>
<p>if path is null, return null<br>if path.indexOf(47) == -1 &amp;&amp; path.indexOf(92) ==-1 (means /, ) return path</p>
<h3 id="normalizePath"><a href="#normalizePath" class="headerlink" title="normalizePath"></a>normalizePath</h3><p>check whether it is windows<br>String osName = System.getProperty(“os.name”).toLowerCase(Locale.ENGLISH);<br>        return osName.contains(“windows”);<br>for windows, replace / with \, for linux, replace \ with /</p>
<p>split path by separator (\ or /) to get an array</p>
<p>traverse array and check whether current is “..”, if so , call stack.pop<br>otherwise, stach.push(part)</p>
<p>Then iterate stack and then combine them by a StringBuilder via provided addtional parameter separator</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.todzhang.com/2018-07-16-FileUtils_Camel/" data-id="cjxaajrs5006sbhq1iwnponwg" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2018-07-28-Scala" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018-07-28-Scala/" class="article-date">
  <time datetime="2019-05-31T13:03:27.000Z" itemprop="datePublished">2019-05-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018-07-28-Scala/">Scala</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Scala-String"><a href="#Scala-String" class="headerlink" title="Scala String"></a>Scala String</h1><p>Scala offers the magic of implicit conver‐ sions, String instances also have access to all the methods of the StringOps class, so you can do many other things with them, such as treating a String instance as a sequence of characters. As a result, you can iterate over every character in the string using the foreach method:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; <span class="string">"hello"</span>.foreach(println) h</span><br><span class="line">e</span><br><span class="line">l</span><br><span class="line">l o</span><br><span class="line"><span class="comment">//You can treat a String as a sequence of characters in a for loop:</span></span><br><span class="line">scala&gt; <span class="keyword">for</span> (c &lt;- <span class="string">"hello"</span>) println(c)</span><br><span class="line"></span><br><span class="line">scala&gt; val result = <span class="string">"hello world"</span>.filter(_ != <span class="string">'l'</span>) result: String = heo word</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.todzhang.com/2018-07-28-Scala/" data-id="cjxaajrs5006ubhq16nseyn7c" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2018-07-23-akka-scala" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018-07-23-akka-scala/" class="article-date">
  <time datetime="2019-05-31T13:03:27.000Z" itemprop="datePublished">2019-05-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018-07-23-akka-scala/">akka framework of scala</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="philosophy"><a href="#philosophy" class="headerlink" title="philosophy"></a>philosophy</h1><p>The actor model adopts the philosophy that everything is an actor. This is similar to the everything is an object philosophy used by some object-oriented programming languages.</p>
<p>Decoupling the sender from communications sent was a fundamental advance of the Actor model enabling asynchronous communication and control structures as patterns of passing messages.</p>
<p>Recipients of messages are identified by address, sometimes called “mailing address”. Thus an actor can only communicate with actors whose addresses it has.</p>
<h1 id="Route"><a href="#Route" class="headerlink" title="Route"></a>Route</h1><p>Routes effectively are simply highly specialised functions that take a RequestContext and eventually complete it, which could (and often should) happen asynchronously.</p>
<p>Directives create Routes.</p>
<p>The Route is the central concept of Akka HTTP’s Routing DSL. All the structures you build with the DSL, no matter whether they consists of a single line or span several hundred lines, are type turning a RequestContext into a Future[RouteResult].</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">type</span> <span class="title">Route</span> </span>= <span class="type">RequestContext</span> =&gt; <span class="type">Future</span>[<span class="type">RouteResult</span>]</span><br></pre></td></tr></table></figure>

<p>Generally when a route receives a request (or rather a RequestContext for it) it can do one of these things:</p>
<ul>
<li>Complete the request by returning the value of requestContext.complete(…)</li>
<li>Reject the request by returning the value of requestContext.reject(…) (see Rejections)</li>
<li>Fail the request by returning the value of requestContext.fail(…) or by just throwing an exception (see Exception Handling)</li>
<li>Do any kind of asynchronous processing and instantly return a Future[RouteResult] to be eventually completed later</li>
</ul>
<h2 id="The-Routing-Tree"><a href="#The-Routing-Tree" class="headerlink" title="The Routing Tree"></a>The Routing Tree</h2><p>Essentially, when you combine directives and custom routes via nesting and the ~ operator, you build a routing structure that forms a tree. When a request comes in it is injected into this tree at the root and flows down through all the branches in a depth-first manner until either some node completes it or it is fully rejected.</p>
<p>In RouteDirective.scala</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Completes the request using the given arguments.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @group route</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">complete</span></span>(m: ? <span class="type">ToResponseMarshallable</span>): <span class="type">StandardRoute</span> =</span><br><span class="line">    <span class="type">StandardRoute</span>(_.complete(m))</span><br></pre></td></tr></table></figure>

<h2 id="RouteResult"><a href="#RouteResult" class="headerlink" title="RouteResult"></a>RouteResult</h2><p>RouteResult is a simple abstract data type (ADT) that models the possible non-error results of a Route. It is defined as such:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sealed</span> <span class="class"><span class="keyword">trait</span> <span class="title">RouteResult</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">object</span> <span class="title">RouteResult</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Complete</span>(<span class="params">response: <span class="type">HttpResponse</span></span>) <span class="keyword">extends</span> <span class="title">RouteResult</span></span></span><br><span class="line"><span class="class">  <span class="title">final</span> <span class="title">case</span> <span class="title">class</span> <span class="title">Rejected</span>(<span class="params">rejections: immutable.<span class="type">Seq</span>[<span class="type">Rejection</span>]</span>) <span class="keyword">extends</span> <span class="title">RouteResult</span></span></span><br><span class="line"><span class="class">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Routing-DSL"><a href="#Routing-DSL" class="headerlink" title="Routing DSL"></a>Routing DSL</h2><p>In addition to the Core Server API Akka HTTP provides a very flexible ,Routing DSL, for elegantly defining RESTful web services.</p>
<p>Http().bindAndHandle(routes ~ abcRoute, host, port)</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns a Route that chains two Routes. If the first Route rejects the request the second route is given a</span></span><br><span class="line"><span class="comment">     * chance to act upon the request.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">~</span></span>(other: <span class="type">Route</span>): <span class="type">Route</span> = &#123; ctx ?</span><br><span class="line">      <span class="keyword">import</span> ctx.executionContext</span><br><span class="line">      route(ctx).fast.flatMap &#123;</span><br><span class="line">        <span class="keyword">case</span> x: <span class="type">RouteResult</span>.<span class="type">Complete</span> ? <span class="type">FastFuture</span>.successful(x)</span><br><span class="line">        <span class="keyword">case</span> <span class="type">RouteResult</span>.<span class="type">Rejected</span>(outerRejections) ?</span><br><span class="line">          other(ctx).fast.map &#123;</span><br><span class="line">            <span class="keyword">case</span> x: <span class="type">RouteResult</span>.<span class="type">Complete</span>               ? x</span><br><span class="line">            <span class="keyword">case</span> <span class="type">RouteResult</span>.<span class="type">Rejected</span>(innerRejections) ? <span class="type">RouteResult</span>.<span class="type">Rejected</span>(outerRejections ++ innerRejections)</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="Path-matching"><a href="#Path-matching" class="headerlink" title="Path matching"></a>Path matching</h3><blockquote>
<p>Note<br>The path matching DSL describes what paths to accept after URL decoding. This is why the path-separating slashes have special status and cannot simply be specified as part of a string! The string ¡°foo/bar¡± would match the raw URI path ¡°foo%2Fbar¡±, which is most likely not what you want!</p>
</blockquote>
<h1 id="Sink"><a href="#Sink" class="headerlink" title="Sink"></a>Sink</h1><p>A Sink is a set of stream processing steps that has one open input. Can be used as a Subscriber</p>
<h1 id="supervision"><a href="#supervision" class="headerlink" title="supervision"></a>supervision</h1><h2 id="What-Supervision-Means"><a href="#What-Supervision-Means" class="headerlink" title="What Supervision Means"></a>What Supervision Means</h2><p>As described in Actor Systems supervision describes a dependency relationship between actors: the supervisor delegates tasks to subordinates and therefore must respond to their failures. When a subordinate detects a failure (i.e. throws an exception), it suspends itself and all its subordinates and sends a message to its supervisor, signaling failure. Depending on the nature of the work to be supervised and the nature of the failure, the supervisor has a choice of the following four options:</p>
<ul>
<li>Resume the subordinate, keeping its accumulated internal state</li>
<li>Restart the subordinate, clearing out its accumulated internal state</li>
<li>Stop the subordinate permanently</li>
<li>Escalate the failure, thereby failing itself</li>
</ul>
<h2 id="sealed-class"><a href="#sealed-class" class="headerlink" title="sealed class"></a>sealed class</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">object Supervision &#123;</span><br><span class="line">  sealed trait Directive</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>A sealed class may not be directly inherited, except if the inheriting template is defined in the same source file as the inherited class. However, subclasses of a sealed class can inherited anywhere.</p>
<h2 id="implicit"><a href="#implicit" class="headerlink" title="implicit"></a>implicit</h2><p>A method can have an implicit parameter list, marked by the implicit keyword at the start of the parameter list. If the parameters in that parameter list are not passed as usual, Scala will look if it can get an implicit value of the correct type, and if it can, pass it automatically.</p>
<p>The places Scala will look for these parameters fall into two categories:</p>
<p>Scala will first look for implicit definitions and implicit parameters that can be accessed directly (without a prefix) at the point the method with the implicit parameter block is called.<br>Then it looks for members marked implicit in all the companion objects associated with the implicit candidate type.</p>
<h2 id="KillSwitch"><a href="#KillSwitch" class="headerlink" title="KillSwitch"></a>KillSwitch</h2><p>A KillSwitch allows completion of Graphs from the outside by completing Graphs of FlowShape linked to the switch. Depending on whether the KillSwitch is a UniqueKillSwitch or a SharedKillSwitch one or multiple streams might be linked with the switch.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">KillSwitch</span> </span>&#123;</span><br><span class="line"><span class="comment">//After calling KillSwitch.shutdown() the linked Graphs of FlowShape are completed normally.</span></span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">shutdown</span></span>(): <span class="type">Unit</span></span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">abort</span></span>(ex:<span class="type">Throwable</span>): <span class="type">Unit</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h2><p>A Source is a set of stream processing steps that has one open output. It can comprise any number of internal sources and transformations that are wired together, or it can be an atomic source, e.g. from a collection or a file. Materialization turns a Source into a Reactive Streams Publisher (at least conceptually).</p>
<h3 id="connect-to-Sink"><a href="#connect-to-Sink" class="headerlink" title="connect to Sink"></a>connect to Sink</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Connect this [[akka.stream.scaladsl.Source]] to a [[akka.stream.scaladsl.Sink]],</span></span><br><span class="line"><span class="comment">   * concatenating the processing steps of both.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">to</span></span>[<span class="type">Mat2</span>](sink: <span class="type">Graph</span>[<span class="type">SinkShape</span>[<span class="type">Out</span>], <span class="type">Mat2</span>]): <span class="type">RunnableGraph</span>[<span class="type">Mat</span>] = toMat(sink)(<span class="type">Keep</span>.left)</span><br></pre></td></tr></table></figure>

<h1 id="Future"><a href="#Future" class="headerlink" title="Future"></a>Future</h1><p>trait Future[+T]<br> extends Awaitable[T]<br>A Future represents a value which may or may not <em>currently</em> be available, but will be available at some point, or an exception if that value could not be made available. Asynchronous computations that yield futures are created with the Future.apply call and are computed using a supplied ExecutionContext, which can be backed by a Thread pool.</p>
<p>   import ExecutionContext.Implicits.global<br>   val s = “Hello”<br>   val f: Future[String] = Future {<br>     s + “ future!”<br>   }<br>   f foreach {<br>     msg =&gt; println(msg)<br>   }</p>
<h2 id="Future-introduction"><a href="#Future-introduction" class="headerlink" title="Future introduction"></a>Future introduction</h2><p>Futures provide a way to reason about performing many operations in parallel¨C in an efficient and non-blocking way. A Future is a placeholder object for a value that may not yet exist. Generally, the value of the Future is supplied concurrently and can subsequently be used. Composing concurrent tasks in this way tends to result in faster, asynchronous, non-blocking parallel code.</p>
<p>By default, futures and promises are non-blocking, making use of callbacks instead of typical blocking operations. To simplify the use of callbacks both syntactically and conceptually, Scala provides combinators such as flatMap, foreach, and filter used to compose futures in a non-blocking way. Blocking is still possible - for cases where it is absolutely necessary, futures can be blocked on (although this is discouraged).</p>
<h1 id="Scala-scope-protection"><a href="#Scala-scope-protection" class="headerlink" title="Scala scope protection:"></a>Scala scope protection:</h1><p>private[C] means that access is private “up to” C, where C is the corresponding package, class or singleton object.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span>[http] <span class="function"><span class="keyword">def</span> <span class="title">build</span> </span>= &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The modi?er can be quali?ed with an identi?er C (e.g. private[C]) that must denote a class or package enclosing the de?nition. Members labeled with such a modi?er are accessible respectively only from code inside the package C or only from code inside the class C and its companion module (¡ì5.4). Such members are also inherited only from templates inside C.</p>
<h1 id="Scala-flexible-import"><a href="#Scala-flexible-import" class="headerlink" title="Scala flexible import"></a>Scala flexible import</h1><p>you can import several classes the Scala way:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.&#123;<span class="type">File</span>, <span class="type">IOException</span>, <span class="type">FileNotFoundException</span>&#125;</span><br></pre></td></tr></table></figure>

<p>Use the following syntax to import everything from the java.io package:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io._</span><br></pre></td></tr></table></figure>

<p>The _ character in this example is similar to the * wildcard character in Java.</p>
<p>If the _ character feels unusual at first, it helps to know that it¡¯s used consistently throughout the Scala language as a wildcard character, and that consistency is very nice.</p>
<h2 id="Directives"><a href="#Directives" class="headerlink" title="Directives"></a>Directives</h2><p>A ¡°Directive¡± is a small building block used for creating arbitrarily complex route structures. Akka HTTP already pre-defines a large number of directives and you can easily construct your own:</p>
<h1 id="Regular-Expression"><a href="#Regular-Expression" class="headerlink" title="Regular Expression"></a>Regular Expression</h1><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> pattern = <span class="string">"Scala"</span>.r</span><br><span class="line">      <span class="keyword">val</span> str = <span class="string">"Scala is Scalable and cool"</span></span><br><span class="line">      </span><br><span class="line">      println(pattern findFirstIn str)</span><br></pre></td></tr></table></figure>

<p>We create a String and call the r( ) method on it. Scala implicitly converts the String to a RichString and invokes that method to get an instance of Regex. To find a first match of the regular expression, simply call the findFirstIn() method. If instead of finding only the first occurrence we would like to find all occurrences of the matching word, we can use the findAllIn( ) method and in case there are multiple Scala words available in the target string, this will return a collection of all matching words.</p>
<h2 id="PathMatcher"><a href="#PathMatcher" class="headerlink" title="PathMatcher"></a>PathMatcher</h2><ul>
<li>Segment: PathMatcher1[String]<br>Matches if the unmatched path starts with a path segment (i.e. not a slash). If so the path segment is extracted as a String instance.</li>
</ul>
<h1 id="Option"><a href="#Option" class="headerlink" title="Option"></a>Option</h1><p>In short, if you have a value of type A that may be absent, Scala uses an instance of Option[A] as its container. An Intance of Option is either an instance of case class Some when it is present or case object None when it is not. Since both Some and None are children of Option, your function signature should declare that the returned value is an Option of some type, e.g. Option[A]</p>
<h2 id="Sample"><a href="#Sample" class="headerlink" title="Sample"></a>Sample</h2><p>It is very easy to create an Option in Scala, i.e. you can use a present/absent value directly.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> optionalInt: <span class="type">Option</span>[<span class="type">Int</span>] = <span class="type">Some</span>(<span class="number">1</span>)</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="comment">// val optionalInt: Option[Int] = None</span></span><br></pre></td></tr></table></figure>

<h3 id="To-validate-user-login"><a href="#To-validate-user-login" class="headerlink" title="To validate user login"></a>To validate user login</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">auth</span></span>(user:<span class="type">String</span>, pwd:<span class="type">String</span>): <span class="type">AuthResult</span> =</span><br><span class="line">	(user, pwd) <span class="keyword">match</span> &#123;</span><br><span class="line">	<span class="keyword">case</span> (u, _) <span class="keyword">if</span> <span class="type">Option</span>(u).exists(_.trim.isEmpty) =&gt; <span class="type">ErrorLogin</span></span><br><span class="line">	<span class="keyword">case</span> (_, p) <span class="keyword">if</span> <span class="type">Option</span>(p).exists(_.trim.isEmpty) =&gt; <span class="type">ErrorPwd</span></span><br><span class="line">	<span class="keyword">case</span> (u, p) =&gt; doAuth(u,p)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="isDefined"><a href="#isDefined" class="headerlink" title="isDefined"></a>isDefined</h2><p>you add a checker for the None value using the isDefined method and specify logic to handle each scenario accordingly.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">addTwoWithDefault</span></span>(a: <span class="type">Option</span>[<span class="type">Int</span>]): <span class="type">Int</span> = &#123;</span><br><span class="line">  <span class="keyword">if</span>(a.isDefined) a.get + <span class="number">2</span> <span class="keyword">else</span> <span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="getOrElse"><a href="#getOrElse" class="headerlink" title="getOrElse"></a>getOrElse</h2><p>In many cases, you have a fallback or default value for your absent values, e.g. zero in the above example. With Option, you can easily provide a default value via the getOrElse method.</p>
<p>def addTwoWithDefault(a: Option[Int]): Int = a.getOrElse(0) + 2</p>
<h2 id="flatten"><a href="#flatten" class="headerlink" title="flatten"></a>flatten</h2><p>Assume that we have a List of Option[Int].</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> l: <span class="type">List</span>[<span class="type">Option</span>[<span class="type">Int</span>]] = <span class="type">List</span>(<span class="type">Some</span>(<span class="number">3</span>), <span class="type">Some</span>(<span class="number">1</span>), <span class="type">None</span>, <span class="type">Some</span>(<span class="number">5</span>), <span class="type">Some</span>(<span class="number">8</span>), <span class="type">None</span>)</span><br></pre></td></tr></table></figure>

<p>A common scenario is that we need to filter out the absent values and return a List of Int. A straightfoward approach is to combine filter with .isDefined.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">l.filter(_.isDefined).map(_.get) </span><br><span class="line"><span class="comment">// res1: List[Int] = List(3, 1, 5, 8)</span></span><br></pre></td></tr></table></figure>

<p>However, Scala actually provides an elegent built-in function to achieve the same goal, which is often more preferred.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">l.flatten</span><br><span class="line"><span class="comment">// res1: List[Int] = List(3, 1, 5, 8)</span></span><br></pre></td></tr></table></figure>

<h1 id="underscore"><a href="#underscore" class="headerlink" title="underscore"></a>underscore</h1><p>In Scala, pattern matching is somewhat similar to java switch statement. But it is more powerful.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">matchTest</span></span>(x: <span class="type">Int</span>): <span class="type">String</span> = x <span class="keyword">match</span> &#123;</span><br><span class="line">   <span class="keyword">case</span> <span class="number">1</span> =&gt; <span class="string">"one"</span></span><br><span class="line">   <span class="keyword">case</span> <span class="number">2</span> =&gt; <span class="string">"two"</span></span><br><span class="line">   <span class="keyword">case</span> _ =&gt; <span class="string">"anything other than one and two"</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>_ acts like a wildcard. It will match anything. Scala allows nested patterns, so we can nest the _ also.Lets see another example that uses _ in nested pattern.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">expr <span class="keyword">match</span> &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="type">List</span>(<span class="number">1</span>,_,_) =&gt; <span class="string">" a list with three element and the first element is 1"</span></span><br><span class="line">  <span class="keyword">case</span> <span class="type">List</span>(_*)  =&gt; <span class="string">" a list with zero or more elements "</span></span><br><span class="line">  <span class="keyword">case</span> <span class="type">Map</span>[_,_] =&gt; <span class="string">" matches a map with any key type and any value type "</span></span><br><span class="line">  <span class="keyword">case</span> _ =&gt;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h2 id="Anonymous-Functions"><a href="#Anonymous-Functions" class="headerlink" title="Anonymous Functions"></a>Anonymous Functions</h2><p>Scala represents anonymous functions with a elegant syntax. The _ acts as a placeholder for parameters in the anonymous function. The _ should be used only once, But we can use two or more underscores to refer different parameters.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>).foreach(print(_))</span><br><span class="line"><span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>).foreach( a =&gt; print(a))</span><br><span class="line"><span class="comment">// Here the _ refers to the parameter. The first one is a short form of the second one. Lets look at another example which take two parameters.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> sum = <span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>).reduceLeft(_+_)</span><br><span class="line"><span class="keyword">val</span> sum = <span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>).reduceLeft((a, b) =&gt; a + b)</span><br></pre></td></tr></table></figure>

<h2 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h2><p>Scala is a functional language. So we can treat function as a normal variable. If you try to assign a function to a new variable, the function will be invoked and the result will be assigned to the variable. This confusion occurs due to the optional braces for method invocation. We should use _ after the function name to assign it to another variable.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>).foreach(print(_))</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">fun</span> </span>= &#123;</span><br><span class="line">    <span class="comment">// some code</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">val</span> funLike = fun _</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>).foreach(print(_))</span><br></pre></td></tr></table></figure>

<h1 id="Either-Left-Right"><a href="#Either-Left-Right" class="headerlink" title="Either, Left, Right"></a>Either, Left, Right</h1><p>Using Either, Left, and Right<br>Prior to Scala 2.10, an approach similar to Try was available with the Either, Left, and Right classes. With these classes, Either is analogous to Try, Right is similar to Success, and Left is similar to Failure.</p>
<p>The following method demonstrates how to implement the Either approach:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">divideXByY</span></span>(x: <span class="type">Int</span>, y: <span class="type">Int</span>): <span class="type">Either</span>[<span class="type">String</span>, <span class="type">Int</span>] = &#123;</span><br><span class="line">    <span class="keyword">if</span> (y == <span class="number">0</span>) <span class="type">Left</span>(<span class="string">"Dude, can't divide by 0"</span>)</span><br><span class="line">    <span class="keyword">else</span> <span class="type">Right</span>(x / y)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>As shown, your method should be declared to return an Either, and the method body should return a Right on success and a Left on failure. The Right type is the type your method returns when it runs successfully (an Int in this case), and the Left type is typically a String, because that¡¯s how the error message is returned.</p>
<p>As with Option and Try, a method returning an Either can be called in a variety of ways, including getOrElse or a match expression:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> x = divideXByY(<span class="number">1</span>, <span class="number">1</span>).right.getOrElse(<span class="number">0</span>)   <span class="comment">// returns 1</span></span><br><span class="line"><span class="keyword">val</span> x = divideXByY(<span class="number">1</span>, <span class="number">0</span>).right.getOrElse(<span class="number">0</span>)   <span class="comment">// returns 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// prints "Answer: Dude, can't divide by 0"</span></span><br><span class="line">divideXByY(<span class="number">1</span>, <span class="number">0</span>) <span class="keyword">match</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">Left</span>(s) =&gt; println(<span class="string">"Answer: "</span> + s)</span><br><span class="line">    <span class="keyword">case</span> <span class="type">Right</span>(i) =&gt; println(<span class="string">"Answer: "</span> + i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can also access the error message by testing the result with isLeft, and then accessing the left value, but this isn¡¯t really the Scala way:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; <span class="keyword">val</span> x = divideXByY(<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">x: <span class="type">Either</span>[<span class="type">String</span>,<span class="type">Int</span>] = <span class="type">Left</span>(<span class="type">Dude</span>, can<span class="symbol">'t</span> divide by <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">scala&gt; x.isLeft</span><br><span class="line">res0: <span class="type">Boolean</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">scala&gt; x.left</span><br><span class="line">res1: scala.util.<span class="type">Either</span>.<span class="type">LeftProjection</span>[<span class="type">String</span>,<span class="type">Int</span>] =</span><br><span class="line">      <span class="type">LeftProjection</span>(<span class="type">Left</span>(<span class="type">Dude</span>, can<span class="symbol">'t</span> divide by <span class="number">0</span>))</span><br></pre></td></tr></table></figure>

<p>Although the Either classes offered a potential solution prior to Scala 2.10, I now use the Try classes in all of my code instead of Either.</p>
<h3 id="classOf"><a href="#classOf" class="headerlink" title="classOf"></a>classOf</h3><p>Retrieve the runtime representation of a class type. classOf[T] is equivalent to the class literal T.class in Java.</p>
<h2 id="Operators"><a href="#Operators" class="headerlink" title="Operators"></a>Operators</h2><p>// Keywords<br>&lt;-  // Used on for-comprehensions, to separate pattern from generator<br>=&gt;  // Used for function types, function literals and import renaming</p>
<h1 id="Akka-framework"><a href="#Akka-framework" class="headerlink" title="Akka framework"></a>Akka framework</h1><p>Akka is a toolkit and runtime for building highly concurrent, distributed, and fault-tolerant event-driven applications on the JVM. </p>
<p>Actors are the unit of execution in Akka. The Actor model is an abstraction that makes it easier to write correct concurrent, parallel and distributed systems.</p>
<p>This will get your feet wet, and hopefully inspire you to dive deeper into the wonderful sea of Akka!</p>
<p>The Akka team refers to their creation as a toolkit rather than a framework. Frameworks tend to be a mechanism for providing a discrete element of a stack (e.g. the ui, or the web services layer). Akka provides a set of tools to render any part of the stack, and to provide the interconnects between them. </p>
<p>He two ways (shared mutable state/message passing (Akka)) to solve the problem of selling tickets.</p>
<p>Actors do not share state, can only communicate through immutable messages and do not talk to each other directly but through actor references, similar to the addresses we talked about. This approach satisfies the three things we wanted to change. So why is this simpler than the shared mutable state approach?</p>
<ul>
<li>We don’t need to manage locks. We don’t have to think about how to protect the shared data. Inside an actor we’re safe.</li>
<li>We are more protected from deadlocks caused by out of order access by multiple threads, that cause the system to wait forever, or other problems like race conditions and thread starvation. Use of Akka precludes most of these problems, relieving us of the burden.</li>
<li>Performance tuning a shared mutable state solution is hard work and error prone and verification through tests is nearly impossible.</li>
</ul>
<h2 id="Benefits-of-using-the-Actor-Model"><a href="#Benefits-of-using-the-Actor-Model" class="headerlink" title="Benefits of using the Actor Model"></a>Benefits of using the Actor Model</h2><p>The following characteristics of Akka allow you to solve difficult concurrency and scalability challenges in an intuitive way:</p>
<ul>
<li>Event-driven model — Actors perform work in response to messages. Communication between Actors is asynchronous, allowing Actors to send messages and continue their own work without blocking to wait for a reply.</li>
<li>Strong isolation principles — Unlike regular objects in Java, an Actor does not have a public API in terms of methods that you can invoke. Instead, its public API is defined through messages that the actor handles. This prevents any sharing of state between Actors; the only way to observe another actor’s state is by sending it a message asking for it.</li>
<li>Location transparency — The system constructs Actors from a factory and returns references to the instances. Because location doesn’t matter, Actor instances can start, stop, move, and restart to scale up and down as well as recover from unexpected failures.</li>
<li>Lightweight — Each instance consumes only a few hundred bytes, which realistically allows millions of concurrent Actors to exist in a single application.</li>
</ul>
<h3 id="Message"><a href="#Message" class="headerlink" title="Message"></a>Message</h3><p>two special channels. The first is the Dead Letter channel, which contain message that couldn’t be delivered. This is sometimes also called a dead message queue. This channel can help when debugging, why some messages aren’t processed or to monitor where there are problems.</p>
<h3 id="EventStream"><a href="#EventStream" class="headerlink" title="EventStream"></a>EventStream</h3><p>the benefit of decoupling the receivers and the sender and the dynamic nature of the publish-subscribe channel, but because the EventStream is available for all actors is also a nice solution for messages which can be send from all over the system and needs to be collected at one or more Actors. A good example is logging. Logging can be done throughout the system and needs to be collected at one point and be written to a log file. Internally the ActorLogging is using the EventStream to collect the log lines from all over the system.</p>
<h3 id="Dead-Letter-Message"><a href="#Dead-Letter-Message" class="headerlink" title="Dead Letter Message"></a>Dead Letter Message</h3><p>Akka is using the EventStream to implement the dead letter queue. This way only the actors which are interested in the failed messages are receiving them. When a message is queued in a mailbox of an actor that Terminates or is send after the Termination, the message is send to the EventStream of the ActorSystem. The message is wrapped into a DeadLetter object. This Object contains the original message, the sender of the message and the intended receiver. This way the Dead letter queue is integrated in the EventStream. To get these dead letter messages you only need to subscribe your actor to the EventStream with the DeadLetter class as the Classifier.</p>
<p>Messages send to a Terminated Actor can’t be processed anymore and the ActorRef of this actor should not be used anymore. When there are messages send to a terminated Actor, these message will be send to the DeadLetter queue.</p>
<p>Another use of the DeadLetter queue is when the processing fails. This is a Actor specific decision. An actor can decide that a received message couldn’t be processed and that it doesn’t know what to do with it. In this situation the messages can be send to the dead letter queue. </p>
<h2 id="Design-recommendations"><a href="#Design-recommendations" class="headerlink" title="Design recommendations"></a>Design recommendations</h2><p>When defining Actors and their messages, keep these recommendations in mind:</p>
<ul>
<li>Since messages are the Actor’s public API, it is a good practice to define messages with good names and rich semantic and domain specific meaning, even if they just wrap your data type. This will make it easier to use, understand and debug actor-based systems.</li>
<li>Messages should be immutable, since they are shared between different threads.</li>
<li>It is a good practice to put an actor’s associated messages as static classes in the class of the Actor. This makes it easier to understand what type of messages the actor expects and handles.</li>
<li>It is also a common pattern to use a static props method in the class of the Actor that describes how to construct the Actor.</li>
</ul>
<h3 id="Props"><a href="#Props" class="headerlink" title="Props"></a>Props</h3><p>The static props method creates and returns a Props instance. Props is a configuration class to specify options for the creation of actors, think of it as an immutable and thus freely shareable recipe for creating an actor that can include associated deployment information. This example simply passes the parameters that the Actor requires when being constructed. We will see the props method in action later in this tutorial.</p>
<h2 id="configuration"><a href="#configuration" class="headerlink" title="configuration"></a>configuration</h2><p>When using the default, the library will try to find the configuration file. Since the library supports a number of different configuration formats, it looks for different files, in the following order:<br>application.properties<br>This file should contain the configuration properties in the java property file format.<br>application.json<br>This file should contain the configuration properties in the json style</p>
<p>application.conf<br>This file should contain the configuration properties in the HOCON format. This is a format based on json but easier to read..<br>It is possible to use all the different files at the same time. For the example below, in listing 7.2 we use the last file:<br>MyAppl {<br>    version = 10<br>    description = “My application”<br>    database {<br>        connect=”jdbc:mysql://localhost/mydata”<br>        user=”me”<br>        }<br>}
Nesting is done by simply grouping with {}s</p>
<h3 id="substitution"><a href="#substitution" class="headerlink" title="substitution"></a>substitution</h3><p> hostname=”localhost”<br>hostname=${?HOST_NAME}<br>MyAppl {<br>    version = 10<br>    description = “My<br>    application”<br>    database {<br>        connect=”jdbc:mysql://${hostname}/mydata”<br>user=”me” }<br>}</p>
<p>define the variable first, if system environment do exist, override it, otherwise use default<br>? means get a variable from system envrionment</p>
<h3 id="Default-fallback-properies"><a href="#Default-fallback-properies" class="headerlink" title="Default/fallback properies"></a>Default/fallback properies</h3><p>Default properties are configured in the file reference.conf and placed in the root of the jar file; the idea is that every library contains its own defaults. The configuration library will find all the reference.conf files and integrate these settings into the configuration fall-back structure. </p>
<h3 id="Order-of-properties"><a href="#Order-of-properties" class="headerlink" title="Order of properties"></a>Order of properties</h3><p>System properties-&gt;application.conf-&gt;applicaiton.json-&gt;application.properties-&gt;reference.conf</p>
<h2 id="The-power-of-location-transparency"><a href="#The-power-of-location-transparency" class="headerlink" title="The power of location transparency"></a>The power of location transparency</h2><p>In Akka you can’t create an instance of an Actor using the new keyword. Instead, you create Actor instances using a factory. The factory does not return an actor instance, but a reference, akka.actor.ActorRef, that points to the actor instance. This level of indirection adds a lot of power and flexibility in a distributed system.</p>
<p>In Akka location doesn’t matter. Location transparency means that the ActorRef can, while retaining the same semantics, represent an instance of the running actor in-process or on a remote machine. If needed, the runtime can optimize the system by changing an Actor’s location or the entire application topology while it is running. This enables the “let it crash” model of failure management in which the system can heal itself by crashing faulty Actors and restarting healthy ones.</p>
<h2 id="The-Akka-ActorSystem"><a href="#The-Akka-ActorSystem" class="headerlink" title="The Akka ActorSystem"></a>The Akka ActorSystem</h2><p>The akka.actor.ActorSystem factory is, to some extent, similar to Spring’s BeanFactory. It acts as a container for Actors and manages their life-cycles. The actorOf factory method creates Actors and takes two parameters, a configuration object called Props and a name.</p>
<h3 id="Asynchronous-communication"><a href="#Asynchronous-communication" class="headerlink" title="Asynchronous communication"></a>Asynchronous communication</h3><p>Actors are reactive and message driven. An Actor doesn’t do anything until it receives a message. Actors communicate using asynchronous messages. This ensures that the sender does not stick around waiting for their message to be processed by the recipient. Instead, the sender puts the message in the recipient’s mailbox and is free to do other work. The Actor’s mailbox is essentially a message queue with ordering semantics. The order of multiple messages sent from the same Actor is preserved, but can be interleaved with messages sent by another Actor.</p>
<p>You might be wondering what the Actor is doing when it is not processing messages, i.e. doing actual work? It is in a suspended state in which it does not consume any resources apart from memory. Again, showing the lightweight, efficient nature of Actors.</p>
<h3 id="Sending-messages-to-an-Actor"><a href="#Sending-messages-to-an-Actor" class="headerlink" title="Sending messages to an Actor"></a>Sending messages to an Actor</h3><p>To put a message into an Actor’s mailbox, use the tell method on the ActorRef. For example, the main class of Hello World sends messages to the Greeter Actor like this:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">howdyGreeter.tell(<span class="keyword">new</span> WhoToGreet(<span class="string">"Akka"</span>), ActorRef.noSender());</span><br><span class="line">howdyGreeter.tell(<span class="keyword">new</span> Greet(), ActorRef.noSender());</span><br></pre></td></tr></table></figure>

<p>The test class is using akka.test.javadsl.TestKit, which is a module for integration testing of actors and actor systems. This class only uses a fraction of the functionality provided by TestKit.</p>
<h2 id="Akka-under-the-hood"><a href="#Akka-under-the-hood" class="headerlink" title="Akka under the hood"></a>Akka under the hood</h2><p>So are there no concurrency primitives like locks used at all in Akka? Well, of course there are, it’s just that you don’t have to deal with them directly . Everything still eventually runs on threads and low level concurrency primitives. Akka uses the java.util.concurrent library to coordinate message processing and takes great care to minimize the number of locks used to an absolute bare minimum. It uses lock free and wait free algorithms where possible, for example compare-and-swap (CAS) techniques, which are beyond the scope of this book. And because nothing can be shared between actors, the shared locks that you would normally have between objects are not present at all. </p>
<p>There are other benefits that stem from the message passing approach that Akka uses, which we will discuss in the next sections. We have touched on them briefly already:</p>
<ol>
<li>Even in this first, simple example, the message passing approach is clearly more fault tolerant, averting catastrophic failure if one component (no matter how key) fails.</li>
<li>The shared mutable state is always in one place in the example (in one JVM if it is kept entirely in memory). If you need to scale beyond this constraint, you will have to (re)distribute the data somehow. Since the message passing style uses addresses, looking ahead, you can see that if local and remote addresses were interchangeable, scaling out would be possible without code changes of any kind.</li>
</ol>
<p>This scenario is one example of a fault tolerance strategy that Akka provides, which is called the Restart strategy. Other strategies that can be used are Resume, Stop and Escalate. </p>
<h2 id="Scale-up-and-Scale-out"><a href="#Scale-up-and-Scale-out" class="headerlink" title="Scale up and Scale out"></a>Scale up and Scale out</h2><p>In our Ticketing example, scaling up would mean getting more TicketingAgents running on our one server, scaling out would be bringing up TicketingAgents on a number of machines.</p>
<h2 id="Locking"><a href="#Locking" class="headerlink" title="Locking"></a>Locking</h2><p>locks result in contention, which will mean the number of threads doing work at any one time is often less than the total number, as some will have to wait on each other to finish. Sharing as little as possible means locking as little as possible, which is the goal of the message passing approach.</p>
<p>Every thread has a stack to store runtime data. The size of the stack differs per operating system, for instance on the linux x64 platform it is normally 256kB. The stack size is one of the factors that limits the number of threads that run at the same time on a server. Around 4096 threads can fit in 1GB of memory on the linux x64 platform.</p>
<h2 id="Dispatcher"><a href="#Dispatcher" class="headerlink" title="Dispatcher"></a>Dispatcher</h2><p>Actors run on an abstraction which is called a dispatcher. The dispatcher takes care of which threading model is used and processes the mailboxes.</p>
<p>Actors are lightweight because they run on top of dispatchers, the actors are not necessarily directly proportional to the number of threads. Akka Actors take a lot less space than threads, around 2.7 million actors can fit in 1GB of memory. A big difference compared to 4096 threads, which means that you can create different types of actors more freely than you would when using threads directly. There are different types of dispatchers to choose from which can be tuned to specific needs.</p>
<p>We identified that we had to make the following changes to get to a message passing style:</p>
<ol>
<li>No mutable shared data structure. </li>
<li>Immutable message passing.</li>
<li>Asynchronous message sending.</li>
</ol>
<p>Akka implements actors and which components compare to the concepts we’ve talked about so far: actors, addresses and mailboxes.</p>
<h2 id="Actor-Path"><a href="#Actor-Path" class="headerlink" title="Actor Path"></a>Actor Path</h2><p>So how do you get an actor reference to an actor in the hierarchy? This is where ActorPaths come in. You could compare the hierarchy of actors to a URL path structure. Every actor has a name. This name needs to be unique per level in the hierarchy, two sibling actors cannot have the same name (if you do not provide a name Akka generates one for you, but it is a good idea to name all your actors). All actor references can be located directly by an actor path, absolute or relative, and it has to follow the URI generic syntax. An actor path is built just like a URI, starting with a scheme followed by a scheme-specific part,</p>
<h2 id="Core-Actor-Operations"><a href="#Core-Actor-Operations" class="headerlink" title="Core Actor Operations"></a>Core Actor Operations</h2><p>Another way to look at an actor is to describe the operations that it supports. An Akka actor has four core operations :</p>
<ol>
<li>CREATE: An actor can create another actor. In Akka, actors are part of an actor system, which defines the root of the actor hierarchy and creates top-level actors. Every actor can create child actors. The topology of the actors is dynamic, it depends on which actors create other actors and which addresses are used to communicate with them.</li>
<li>SEND: An actor can send a message to another actor. Messages are sent asynchronously, using an address to send to an Actor associated with a given Mailbox.</li>
<li>BECOME: The behavior of an actor can be dynamically changed. Messages are received one at a time and an actor can designate that it wants to handle next messages in a different way, basically swapping its behavior, which we will look at in later chapters.</li>
<li>SUPERVISE: An actor supervises and monitors its children in the actor hierarchy and manages the failures that happen. As we will see in chapter 3, this provides a clean separation between message processing and error handling.</li>
</ol>
<h2 id="Akka-concurrency"><a href="#Akka-concurrency" class="headerlink" title="Akka concurrency"></a>Akka concurrency</h2><p>Message passing enables an easier road to real concurrency<br> With that concurrent approach, we will be able to scale up and out<br>We can scale both the request and the processing elements of our application<br>Messages also unlock greater fault tolerance capabilities<br>Supervision provides a means of modeling for both concurrency and fault tolerance<br>Akka infuses our code with these powers in a lightweight, unobtrusive manner</p>
<h3 id="Build-Akka"><a href="#Build-Akka" class="headerlink" title="Build Akka"></a>Build Akka</h3><p>using TypeSafe’s Simple Build Tool (SBT) to create a single jar file that can be used to run the app</p>
<p>If you have not worked with the SBT DSL before it is important to note that you need to put en empty line between lines in the file (this is the price we pay for not telling Scala where each expression ends).</p>
<h3 id="tell-vs-ask"><a href="#tell-vs-ask" class="headerlink" title="tell vs ask"></a>tell vs ask</h3><p>Messages are sent to an Actor through one of the following methods.</p>
<p>! means “fire-and-forget”, e.g. send a message asynchronously and return immediately. Also known as tell.</p>
<p>? sends a message asynchronously and returns a Future representing a possible reply. Also known as ask.</p>
<p>So below line is equivalent to tell</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReceiveActor</span> <span class="keyword">extends</span> <span class="title">Actor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">receive</span> </span>= &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"Hello"</span> =&gt; sender ! <span class="string">"And Hello to you!"</span> <span class="comment">// same as sender.tell("And Hello to you!")</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Sample-of-actor"><a href="#Sample-of-actor" class="headerlink" title="Sample of actor"></a>Sample of actor</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.goticks</span><br><span class="line"><span class="keyword">import</span> akka.actor.&#123;<span class="type">PoisonPill</span>, <span class="type">Actor</span>&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TicketSeller</span> <span class="keyword">extends</span> <span class="title">Actor</span> </span>&#123;</span><br><span class="line">  <span class="keyword">import</span> <span class="type">TicketProtocol</span>._</span><br><span class="line">  <span class="keyword">var</span> tickets = <span class="type">Vector</span>[<span class="type">Ticket</span>]()</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">receive</span> </span>= &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">GetEvents</span> =&gt; sender ! tickets.size</span><br><span class="line">    <span class="keyword">case</span> <span class="type">Tickets</span>(newTickets) =&gt;</span><br><span class="line">      tickets = tickets ++ newTickets</span><br><span class="line">    <span class="keyword">case</span> <span class="type">BuyTicket</span> =&gt;</span><br><span class="line">      <span class="keyword">if</span> (tickets.isEmpty) &#123;</span><br><span class="line">        sender ! <span class="type">SoldOut</span></span><br><span class="line">        self ! <span class="type">PoisonPill</span></span><br><span class="line">&#125;</span><br><span class="line">      tickets.headOption.foreach &#123; ticket =&gt;</span><br><span class="line">        tickets = tickets.tail</span><br><span class="line">        sender ! ticket</span><br><span class="line">&#125; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="type">Event</span>(name, nrOfTickets) =&gt;</span><br><span class="line">  <span class="keyword">if</span>(context.child(name).isEmpty) &#123;</span><br><span class="line"><span class="type">If</span> <span class="type">TicketSellers</span> have not been</span><br><span class="line">   <span class="keyword">val</span> ticketSeller = context.actorOf(<span class="type">Props</span>[<span class="type">TicketSeller</span>], name)</span><br><span class="line">  <span class="keyword">val</span> tickets = <span class="type">Tickets</span>((<span class="number">1</span> to nrOfTickets).map&#123;</span><br><span class="line">    nr=&gt; <span class="type">Ticket</span>(name, nr)).toList</span><br><span class="line">&#125;</span><br><span class="line">  ticketSeller ! tickets</span><br><span class="line">&#125;</span><br><span class="line">sender ! <span class="type">EventCreated</span></span><br></pre></td></tr></table></figure>

<p>The BoxOffice creates TicketSellers for each event. Notice that it uses it’s context instead of the actor system to create the actor; Actors created with the context of another Actor are its children and subject to the parent Actor’s supervision</p>
<h2 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h2><p>Right now it always fails since it is not implemented yet, as is expected in Red-Green-Refactor style, where you first make sure the test fails (Red), then implement the code to make it pass (Green), after which you might refactor the code to make it nicer.</p>
<h2 id="source-code"><a href="#source-code" class="headerlink" title="source code"></a>source code</h2><h3 id="UntypedActor"><a href="#UntypedActor" class="headerlink" title="UntypedActor"></a>UntypedActor</h3><p>This class is the Java cousin to the akka.actor.Actor Scala interface. Subclass this abstract class to create a MDB-style untyped actor.</p>
<p>An actor has a well-defined (non-cyclic) life-cycle.</p>
<pre><code>RUNNING (created and started actor) - can receive messages
SHUTDOWN (when &apos;stop&apos; or &apos;exit&apos; is invoked) - can&apos;t do anything</code></pre><p>The Actor’s own akka.actor.ActorRef is available as getSelf(), the current message’s sender as getSender() and the akka.actor.UntypedActorContext as getContext(). The only abstract method is onReceive() which is invoked for each processed message unless dynamically overridden using getContext().become().</p>
<p>Annotations<br>    @Deprecated @deprecated<br>Deprecated</p>
<pre><code>(Since version 2.5.0) Use AbstractActor instead of UntypedActor.</code></pre><h3 id="loggingAdaptor"><a href="#loggingAdaptor" class="headerlink" title="loggingAdaptor"></a>loggingAdaptor</h3><p>trait LoggingAdapter extends AnyRef</p>
<p>Logging wrapper to make nicer and optimize: provide template versions which evaluate .toString only if the log level is actually enabled. Typically used by obtaining an implementation from the Logging object:</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.todzhang.com/2018-07-23-akka-scala/" data-id="cjxaajrs6006xbhq1vpiw724n" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2018-08-08-Cucumber" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018-08-08-Cucumber/" class="article-date">
  <time datetime="2019-05-31T13:03:27.000Z" itemprop="datePublished">2019-05-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018-08-08-Cucumber/">Cucumber</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Acceptance-testing-vs-unit-test"><a href="#Acceptance-testing-vs-unit-test" class="headerlink" title="Acceptance testing vs unit test"></a>Acceptance testing vs unit test</h1><p>It’s sometimes said that unit tests ensure you build the thing right, whereas acceptance tests ensure you build the right thing.</p>
<h1 id="Cucumber"><a href="#Cucumber" class="headerlink" title="Cucumber."></a>Cucumber.</h1><p>The acceptance testing tool.</p>
<h1 id="Source-of-Truth"><a href="#Source-of-Truth" class="headerlink" title="Source of Truth"></a>Source of Truth</h1><p>For many teams, the Cucumber feature files become the definitive source of truth as to what the system does.</p>
<h1 id="Scenarios"><a href="#Scenarios" class="headerlink" title="Scenarios"></a>Scenarios</h1><p>Scenarios are written before production code. They start their life as an executable specification. As the production code emerges, Scenarios take on a role as living documentation and automated tests.</p>
<p>Each Cucumber test is called a scenario, and each scenario contains steps that tell Cucumber what to do. </p>
<h1 id="Gherkin"><a href="#Gherkin" class="headerlink" title="Gherkin"></a>Gherkin</h1><p>The keywords Feature, Scenario, Given, When, and Then are the structure, and everything else is documentation.<br>The structure is called Gherkin.</p>
<p>Cucumber features are all about communicating with business users in their language, and it’s important that we don’t force them to sound like robots.</p>
<h1 id="Structure"><a href="#Structure" class="headerlink" title="Structure"></a>Structure</h1><p>We start with features, which contain our scenarios and steps. The steps of our scenarios call step definitions that provide the link between the Gherkin fea- tures and the application being built.</p>
<p>This principle, deliberately doing the minimum useful work the tests will let us get away with, might seem lazy, but in fact it’s a discipline. It ensures that we make our tests thorough: if the test doesn’t drive us to write the right thing, then we need a better test.</p>
<h1 id="Step-Definitions"><a href="#Step-Definitions" class="headerlink" title="Step Definitions"></a>Step Definitions</h1><p>Step definitions are the glue that binds your Cucumber tests to the application you’re testing. </p>
<p>A scenario that’s been executed can end up in any of the following states:</p>
<ul>
<li>Failed</li>
<li>Pending</li>
<li>Undefined </li>
<li>Skipped</li>
<li>Passed<br>These states are designed to help indicate the progress that you make as you develop your tests.</li>
</ul>
<h3 id="Pending-Steps"><a href="#Pending-Steps" class="headerlink" title="Pending Steps"></a>Pending Steps</h3><p>When Cucumber discovers a step definition that’s halfway through being implemented, it marks the step as pending (yellow). Again, the scenario will be stopped, and the rest of the steps will be skipped or marked as undefined.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Steps</span> </span>&#123;</span><br><span class="line"><span class="meta">@Given</span>(<span class="string">"^I have deposited \\$(\\d+) in my account$"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> iHaveDeposited$InMyAccount(<span class="keyword">int</span> amount) <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    <span class="comment">// Write code here that turns the phrase above into concrete actions</span></span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> PendingException(); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Step-definition-recap"><a href="#Step-definition-recap" class="headerlink" title="Step definition recap"></a>Step definition recap</h2><p>The pending status is a bit like those under construction signs you used to see all over the Internet in the 1990s. You can use it as a temporary signpost to your teammates that you’re in the middle of working on something.</p>
<p>Because regular expressions can contain wildcards, this means you have the flexibility to make the Gherkin steps nice and readable, while keeping your Java step definition code clean and free of duplication.<br>• Step definitions provide a mapping from the Gherkin scenarios’ plain- language descriptions of user actions into Java code, which simulates those actions.<br>• Step definitions are registered with Cucumber by using @Given, @When, @Then, or one of the aliases for your spoken language.<br>• Step definitions use regular expressions to declare the steps that they can handle. Because regular expressions can contain wildcards, one step definition can handle several different steps.<br>• A step definition communicates its result to Cucumber by raising, or not raising, an exception.</p>
<h1 id="recap"><a href="#recap" class="headerlink" title="recap"></a>recap</h1><ul>
<li>Readability should be your number-one goal when writing Gherkin fea- tures. Always try to sit together with a stakeholder when you write your scenarios, or at the very least pass them over for feedback once you’ve written them. Keep fine-tuning the language in your scenarios to make them more readable.</li>
<li>Use a Background to factor out repeated steps from a feature and to help tell a story.</li>
<li>Repetitive scenarios can be collapsed into a Scenario Outline.</li>
<li>Steps can be extended with multiline strings or data tables.</li>
<li>You can organize features into subfolders, like chapters in a book.</li>
<li>Tags allow you to mark up scenarios and features so you select particular sets to run or report on.</li>
</ul>
<h1 id="Sample"><a href="#Sample" class="headerlink" title="Sample"></a>Sample</h1><h2 id="compile-and-run-via-CLI"><a href="#compile-and-run-via-CLI" class="headerlink" title="compile and run via CLI"></a>compile and run via CLI</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">javac -cp <span class="string">"jars/*"</span> step_definitions/CheckoutSteps.java</span><br><span class="line">java -cp <span class="string">"jars/*:."</span> cucumber.api.cli.Main -p pretty --snippets camelcase \</span><br><span class="line">                          -g step_definitions features</span><br></pre></td></tr></table></figure>

<p>Line 1 compiles the CheckoutSteps class that we’ve just created. Then line 2 invokes Cucumber. There are two slight additions to Cucumber’s invocation:</p>
<ol>
<li>We’ve added the current directory “.” to the classpath.</li>
<li>We’ve added the -g step_definitions command-line argument to tell Cucumber where to look for the step definitions that it will need to “glue” the steps in the feature file to the checkout application (which we haven’t written yet).</li>
</ol>
<h2 id="feature-file"><a href="#feature-file" class="headerlink" title="feature file"></a>feature file</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Feature: Is it Friday yet?</span><br><span class="line">  Everybody wants to know when it&apos;s Friday</span><br><span class="line"></span><br><span class="line">  Scenario: Sunday isn&apos;t Friday</span><br><span class="line">    Given today is Sunday</span><br><span class="line">    When I ask whether it&apos;s Friday yet</span><br><span class="line">    Then I should be told &quot;Nope&quot;</span><br></pre></td></tr></table></figure>

<p>The first line of this file starts with the keyword Feature: followed by a name. It’s a good idea to use a name similar to the file name.</p>
<p>The second line is a brief description of the feature. Cucumber does not execute this line, it’s just documentation.</p>
<p>The fourth line, Scenario: Sunday is not Friday is a Scenario, which is a concrete example illustrating how the software should behave.</p>
<p>The last three lines starting with Given, When and Then are the steps of our scenario. This is what Cucumber will execute.</p>
<p>Notice how we go from Scenario to Scenario Outline when we start using Examples.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Feature: Is it Friday yet?</span><br><span class="line">  Everybody wants to know when it&apos;s Friday</span><br><span class="line"></span><br><span class="line">  Scenario Outline: Today is or is not Friday</span><br><span class="line">    Given today is &lt;day&gt;</span><br><span class="line">    When I ask whether it&apos;s Friday yet</span><br><span class="line">    Then I should be told &lt;answer&gt;</span><br><span class="line"></span><br><span class="line">  Examples:</span><br><span class="line">    | day | answer |</span><br><span class="line">    | &quot;Friday&quot; | &quot;TGIF&quot; |</span><br><span class="line">    | &quot;Sunday&quot; | &quot;Nope&quot; |</span><br><span class="line">    | &quot;anything else!&quot; | &quot;Nope&quot; |</span><br></pre></td></tr></table></figure>

<p>Scenario Outline: Withdraw fixed amount<br>Given I have <balance> in my account<br>When I choose to withdraw the fixed amount of <withdrawal> Then I should receive <received> cash<br>And the balance of my account should be <remaining><br>Examples:<br>      | Balance | Withdrawal | Received | Remaining |<br>| $500<br>| $500<br>| $500<br>|$50 |$50 |$450 | | $100 | $100 | $400 | | $200 | $200 | $300 |<br>We indicate placeholders within the scenario outline using angle brackets (&lt;..&gt;) where we want real values to be substituted. The scenario outline itself is useless without an Examples table, which lists rows of values to be substituted for each placeholder.</remaining></received></withdrawal></balance></p>
<h2 id="Doc-Strings"><a href="#Doc-Strings" class="headerlink" title="Doc Strings"></a>Doc Strings</h2><p>Doc strings allow you to specify a larger piece of text than you could fit on a single line. For example, if you need to describe the precise content of an email message, you could do it like this:<br>Scenario: Ban Unscrupulous Users<br>When I behave unscrupulously<br>Then I should receive an email containing:<br>“””<br>    Dear Sir,<br>    Your account privileges have been revoked due to your unscrupulous behavior.<br>Sincerely,<br>The Management “””<br>And my account should be locked<br>Just like a data table, the entire string between the “”” triple quotes is attached to the step above it. The indentation of the opening “”” is not important, although common practice is to indent two spaces from the enclosing step, as we’ve shown. The indentation inside the triple quotes, however, is signifi- cant: imagine the left margin running down from the start of the first “””. If you want to include indentation within your string, you need to indent it within this margin.</p>
<h3 id="TGIF"><a href="#TGIF" class="headerlink" title="TGIF"></a>TGIF</h3><p>Thanks God It’s Friday</p>
<h2 id="Data-table"><a href="#Data-table" class="headerlink" title="Data table"></a>Data table</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Given these Users:</span><br><span class="line">| name | date of birth | </span><br><span class="line">| Michael Jackson | August 29, 1958 | </span><br><span class="line">| Elvis | January 8, 1935 | </span><br><span class="line">| John Lennon | October 9, 1940 |</span><br></pre></td></tr></table></figure>

<p>That’s much clearer. The table starts on the line immediately following the step, and its cells are separated using the pipe character: |. You can line up the pipes using whitespace to make the table look tidy, although Cucumber doesn’t mind whether you do; it will strip out the values in each cell, ignoring the surrounding whitespace.</p>
<p>public class BoardSteps {<br>@Given(“^a board like this:$”)<br>public void aBoardLikeThis(DataTable arg1) throws Throwable {<br>        // Write code here that turns the phrase above into concrete actions<br>        // For automatic transformation, change DataTable to one of<br>        // List<yourtype>, List&lt;List<e>&gt;, List&lt;Map&lt;K,V&gt;&gt; or Map&lt;K,V&gt;.<br>        // E,K,V must be a scalar (String, Integer, Date, enum etc)<br>throw new PendingException(); }</e></yourtype></p>
<h1 id="BDD"><a href="#BDD" class="headerlink" title="BDD"></a>BDD</h1><p>The two main practices in the BDD approach are discovery workshops, which bridge the communication gap between business and IT, and executable specifications.</p>
<h1 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h1><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Background</span>:</span><br><span class="line"><span class="keyword">Given</span> I have been issued a new card</span><br><span class="line"><span class="keyword">And</span> I insert the card, entering the correct PIN <span class="keyword">And</span> I choose <span class="string">"Change PIN"</span> from the menu</span><br><span class="line"><span class="keyword">Scenario</span>: Change PIN successfully</span><br><span class="line"><span class="keyword">When</span> I change the PIN to 9876</span><br><span class="line"><span class="keyword">Then</span> the system should remember my PIN is now 9876</span><br><span class="line"><span class="keyword">Scenario</span>: Try to change PIN to the same as before</span><br><span class="line"><span class="keyword">When</span> I try to change the PIN to the original PIN number <span class="keyword">Then</span> I should see a warning message</span><br><span class="line"><span class="keyword">And</span> the system should not have changed my PIN</span><br></pre></td></tr></table></figure>

<p>Our refactoring hasn’t changed the behavior of the tests at all: at runtime, the steps in the background are executed at the beginning of each scenario, just as they were before. What we have done is made each individual scenario much easier to read.</p>
<p>Using a Background element isn’t always necessary, but it’s often useful to improve the readability of your features by removing repetitive steps from individual scenarios. </p>
<h2 id="A-good-‘background’"><a href="#A-good-‘background’" class="headerlink" title="A good ‘background’"></a>A good ‘background’</h2><ul>
<li>Make your Background section vivid. Use colorful names and try to tell a story, because your readers can keep track of stories much better than they can keep track of dull names like User A, User B, Site 1, and so on. If it’s worth mentioning at all, make it really stand out.</li>
<li>Keep your scenarios short, and don’t have too many. If the Background is more than three or four steps long, think about using higher-level steps or splitting the feature file in two. You can use a background as a good indicator of when a feature is getting too long: if the new scenarios you want to add don’t fit with the existing background, consider splitting the feature.</li>
<li>Avoid putting technical details such as clearing queues, starting back- end services, or opening browsers in a background. </li>
</ul>
<p>Backgrounds are useful for taking Given (and sometimes When) steps that are repeated in each scenario and moving them to a single place. This helps keep your scenarios clear and concise.</p>
<h2 id="Discovery-Workshops"><a href="#Discovery-Workshops" class="headerlink" title="Discovery Workshops"></a>Discovery Workshops</h2><p>Discovery workshops (or Specification workshops) are short and frequent meetings where business and IT meet to gain a common understanding of how the software should behave.</p>
<h2 id="Relationship-with-TDD"><a href="#Relationship-with-TDD" class="headerlink" title="Relationship with TDD"></a>Relationship with TDD</h2><p>The main difference is that Cucumber operates on a higher abstraction level, closer to the domain and farther away from classes and methods. BDD builds on TDD, while preserving a strong link between the business requirements and the technical solution.</p>
<h2 id="Outside-in"><a href="#Outside-in" class="headerlink" title="Outside in"></a>Outside in</h2><p>This technique is called Outside-in because programmers typically start with the functionality that is closest to the user (the user interface, which is on the outside of the system) and gradually work towards the guts of the system (business logic, persistence, messaging and so on) as they discover more of what needs to be implemented.</p>
<blockquote>
<p>Your cucumber features should drive your implementation, not reflect it.</p>
</blockquote>
<p>This means Cucumber features should be written before the code implementing the feature.</p>
<p>Notice that we’re just sketching out the interface to the class, rather than adding any implementation to it. This way of working is fundamental to out- side-in development. We try not to think about how the Account is going to work yet but concentrate on what it should be able to do.</p>
<p>Keeping specifications, regression tests and documentation in a single place reduces the overhead of keeping multiple documents in sync - the Cucumber scenarios work as a shared source of truth for business and IT.</p>
<p>While many people focus on the value added by the automated “tests” you get out of BDD, the real value is actually the shared understanding we get at the beginning.</p>
<p>Cucumber is not a tool for testing software. It is a tool for testing people’s understanding of how software (yet to be written) should behave.</p>
<p>The biggest advantage of BDD approach for software development might be that they describe a set of functions that a user expects from a system in a very concrete and direct manner. The sum of these behaviors essentially document a contract with the user/client. If any of the tests fail, this contract is not upheld.</p>
<h1 id="Process"><a href="#Process" class="headerlink" title="Process"></a>Process</h1><p>the most important stage of BDD. Three amigos (business persons, developers, testers) get together and identify the expected behavior of our product by discussing examples. We can use feature mapping approach to effectively analyse and elaborate the product behavior.</p>
<p>always make sure that your scenarios are not tightly coupled with your tests. Your BDD scenarios should change only when the requirement changes, not when the the implementation changes (i.e. your BDD scenarios must drive the implementation, not the other way around).</p>
<h1 id="Executable-Specification"><a href="#Executable-Specification" class="headerlink" title="Executable Specification"></a>Executable Specification</h1><p>An Executable Specification is a Definition of Done that you can run as a test. In Behavior Driven Development (BDD), we refer to acceptance criteria as “executable specifications.” Executable Specifications are meant to be clear, unambiguous, written in business terms, and easy to automate. Each acceptance criteria is a concrete example of how a user interacts with the system to achieve some business goal.</p>
<p>The most well-known format for BDD acceptance criteria uses the “Given-When-Then” structure:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Given &lt;some precondition&gt;</span><br><span class="line">When &lt;something happens&gt;</span><br><span class="line">Then &lt;we expect some outcome&gt;</span><br></pre></td></tr></table></figure>

<p>This format is a great way to make sure that we are thinking in terms of the outcomes we want to achieve. After all, the outcomes of an application are where the value lies.</p>
<p>These scenarios are also easy to automate with BDD tools like Cucumber and Specflow.</p>
<h1 id="No-silver-bullet"><a href="#No-silver-bullet" class="headerlink" title="No silver bullet"></a>No silver bullet</h1><p>“The hardest single part of building a software system is deciding precisely what to build.”<br>We’ve all worked on projects where, because of a misunderstanding, code that we’d worked hard on for several days or more had to be thrown away. Better communication between developers and stakeholders is essential to help avoid this kind of wasted time. One technique that really helps facilitate this communication is the use of concrete examples to illustrate what we want the software to do.</p>
<h2 id="Concrete-Examples"><a href="#Concrete-Examples" class="headerlink" title="Concrete Examples"></a>Concrete Examples</h2><p>By using real-world examples to describe the desired behavior of the system we want to build, we stay grounded in language and terminology that makes sense to our stakeholders: we’re speaking their language. </p>
<p>To illustrate this, let’s imagine you’re building a credit card payment system. One of the requirements is to make sure users can’t enter bad data. Here’s one way of expressing that:<br><code>Customers should be prevented from entering invalid credit card details.</code><br>This is an example of what Agile teams often call acceptance criteria or condi- tions of satisfaction.1 We use the word acceptance because they tell us what the system must be able to do in order for our stakeholders to find it acceptable.</p>
<p>The previous requirements statement is useful, but it leaves far too much room for ambiguity and misunderstanding. It lacks precision. What exactly makes a set of details invalid? How exactly should the user be prevented from entering them? We’ve seen too many projects get dragged into the tar pit2 by these kind of worthy but vague statements. Let’s try illustrating this requirement with a concrete example:<br><code>If a customer enters a credit card number that isn’t exactly 16 digits long, when they try to submit the form, it should be redisplayed with an error message advising them of the correct number of digits.</code></p>
<p>Can you see how much more specific this second statement is? As a developer implementing this feature, we know almost everything we need to be able to sit down and start working on the code. As a stakeholder, we have a much clearer idea of what the developer is going to build.<br>In fact, a stakeholder reading this might point out that there are certain types of cards that are valid with fewer than 16 digits and give us another example. This is the real power of examples: they stimulate our imagination, enabling us to explore and discover edge cases we might otherwise not have found until much later.</p>
<p>By giving an example to illustrate our requirement, we’ve turned an acceptance criterion into an acceptance test. Now we have something unambiguous that we can use to test the behavior of the system, either manually or by using an automated test script.</p>
<h1 id="Gherkins"><a href="#Gherkins" class="headerlink" title="Gherkins"></a>Gherkins</h1><p>Gherkin use main keywords: Feature, Scenario, Given, When, Then, And, But, Background, Scenario Outline, Examplesand some extra syntax “”” (Doc strings), | (Data tables), @(Tags), # (Comments).</p>
<h2 id="dry-run"><a href="#dry-run" class="headerlink" title="dry run"></a>dry run</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -cp <span class="string">".:jars/*"</span> cucumber.api.cli.Main -g step_definitions --dry-run features</span><br></pre></td></tr></table></figure>

<p>The –dry-run switch tells Cucumber to parse the file without executing it. It<br>will tell you if your Gherkin isn’t valid.</p>
<h1 id="Replacing-Given-When-Then-with-Bullets"><a href="#Replacing-Given-When-Then-with-Bullets" class="headerlink" title="Replacing Given/When/Then with Bullets"></a>Replacing Given/When/Then with Bullets</h1><p>Some people find Given, When, Then, And, and But a little verbose. There is an additional keyword you can use to start a step: * (an asterisk). We could have written the previous scenario like this:<br>Scenario: Attempt withdrawal using stolen card * I have $100 in my account</p>
<ul>
<li>my card is invalid</li>
<li>I request $50</li>
<li>my card should not be returned</li>
<li>I should be told to contact the bank<br>To Cucumber, this is exactly the same scenario. Do you find this version easier to read? Maybe. Did some of the meaning get lost? Maybe. It’s up to you and your team how you want to word things. The only thing that matters is that everybody understands what’s communicated.</li>
</ul>
<h2 id="CucumberOptions"><a href="#CucumberOptions" class="headerlink" title="CucumberOptions"></a>CucumberOptions</h2><p>the @CucumberOptions. One can define the location of features, glue files (step definitions), and formatter plugins inside this Cucumber options. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CucumberOptions</span>(</span><br><span class="line">        features = <span class="string">"src/test/resources/features"</span>,</span><br><span class="line">        glue = &#123;<span class="string">"stepdefs"</span>&#125;,</span><br><span class="line">        tags = &#123;<span class="string">"~@Ignore"</span>&#125;,</span><br><span class="line">        format = &#123;</span><br><span class="line">                <span class="string">"pretty"</span>,</span><br><span class="line">                <span class="string">"html:target/cucumber-reports/cucumber-pretty"</span>,</span><br><span class="line">                <span class="string">"json:target/cucumber-reports/CucumberTestReport.json"</span>,</span><br><span class="line">                <span class="string">"rerun:target/cucumber-reports/rerun.txt"</span></span><br><span class="line">        &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestRunner</span> </span>&#123;</span><br></pre></td></tr></table></figure>

<h3 id="Step-definitions"><a href="#Step-definitions" class="headerlink" title="Step definitions"></a>Step definitions</h3><p>Cucumber doesn’t know how to execute your scenarios out-of-the-box. It needs Step Definitions to translate plain text Gherkin steps into actionsthat will interact with the system. When Cucumber executes a Step in a Scenario, it will look for a matching Step Definition to execute.</p>
<h3 id="After"><a href="#After" class="headerlink" title="After"></a>After</h3><p>one can implement initial configurations of the project in TestNG’s BeforeClass method. In cucumber’s Before hook, one can implement code to open web browser which is a prerequisite for all scenarios. In Background of each feature, one can implement steps to navigate to web site and/or login to account. In Cucumber’s After hook, one can take a snapshot of failure and close the browser.</p>
<h2 id="tags"><a href="#tags" class="headerlink" title="tags"></a>tags</h2><p>Grouping Features, Scenarios, and Step Definitions using Tags<br>Tags is a great way made for Cucumber power users to organize their features and scenarios. In above example, by changing tags = {“~@Ignore”} line totags = {“@UpdateProfile”}, one can choose run only the features and scenarios tagged with @UpdateProfile tag. A Scenario or feature can have as many tags as you like. Just separate them with spaces: @important @maintenance @db @auth</p>
<p>If subfolders are the chapters in your book of features, then tags are the sticky notes you’ve put on pages you want to be able to find easily. You tag a scenario by putting a word prefixed with the @ character on the line before the Scenario keyword, like this:<br>@widgets<br>Scenario: Generate report<br>Given I am logged in</p>
<p>There are three main reasons for tagging scenarios:</p>
<ul>
<li>Documentation: You want to use a tag to attach a label to certain scenarios, for example to label them with an ID from a project management tool.</li>
<li>Filtering: Cucumber allows you to use tags as a filter to pick out specific scenarios to run or report on. You can even have Cucumber fail your test run if a certain tag appears too many times.</li>
<li>Hooks: Run a block of code whenever a scenario with a particular tag is about to start or has just finished.</li>
</ul>
<h3 id="config-tag"><a href="#config-tag" class="headerlink" title="config tag"></a>config tag</h3><p>Tags are a great way to organise your features and scenarios. Consider this example:</p>
<p>@billing<br>Feature: Verify billing</p>
<p>  @important<br>  Scenario: Missing product description<br>    Given hello</p>
<p>  Scenario: Several products<br>    Given hello<br>A feature or scenario or can have as many tags as you like. Just separate them with spaces:</p>
<p>@billing @bicker @annoy<br>Feature: Verify billing<br>Tags can be placed above the following Gherkin elements:</p>
<p>Feature<br>Scenario<br>Scenario Outline<br>Examples<br>It is not possible to place tags above Background or steps (Given, When, Then, And and But).</p>
<h1 id="Cucumber-for-java-8-lambda"><a href="#Cucumber-for-java-8-lambda" class="headerlink" title="Cucumber for java 8 lambda"></a>Cucumber for java 8 lambda</h1><p>Using Lambda Expressions for Step Definitions<br>Java Step Definitions are written in regular classes which don’t need to extend or implement anything. They can be written either using lambda expressions or method annotations. In the above, we used the method annotations. To use lambda expressions, use cucumber-java8 module instead of cucumber-java module in your pom.xml file.</p>
<p>When you use the cucumber-java8 module, you can write the Step Definitions using lambdas:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cucumber;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cucumber.api.java8.En;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StepDefinitions</span> <span class="keyword">implements</span> <span class="title">En</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StepDefinitions</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Given(<span class="string">"I have (\\d+) cukes in my belly"</span>, (Integer cukes) -&gt; &#123;</span><br><span class="line">            System.out.format(<span class="string">"Cukes: %n\n"</span>, cukes);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> steps;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> cucumber.api.java8.En;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyStepdefs</span> <span class="keyword">implements</span> <span class="title">En</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyStepdefs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       Given(<span class="string">"I login as (.*)$"</span>,(String name)-&gt; System.out.println(name));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Gherkin-1"><a href="#Gherkin-1" class="headerlink" title="Gherkin"></a>Gherkin</h1><p>Cucumber tests are expressed using a syntax called Gherkin. Gherkin files are plain text and have a .feature extension.</p>
<h1 id="Steps-and-Step-Definitions"><a href="#Steps-and-Step-Definitions" class="headerlink" title="Steps and Step Definitions"></a>Steps and Step Definitions</h1><p>Let’s start by clarifying the distinction between a step and a step definition.<br>Each Gherkin scenario is made up of a series of steps, written in plain lan- guage. On its own, a step is just documentation; it needs a step definition to bring it to life. A step definition is a piece of code that says to Cucumber, “If you see a step that looks like this…, then here’s what I want you to do….”<br>When Cucumber tries to execute each step, it looks for a matching step defi- nition to execute. So, how does Cucumber match a step definition to a step?</p>
<h1 id="Creating-a-Step-Definition"><a href="#Creating-a-Step-Definition" class="headerlink" title="Creating a Step Definition"></a>Creating a Step Definition</h1><p>If Cucumber sees a step definition with this regular expression, it will execute it when it comes to the first step of our scenario. So, how do we create a step definition?</p>
<p>Step definitions live in ordinary files. To create a step definition in Java, you use a special Cucumber annotation, such as @Given, like this:<br>@Given(“I have \$100 in my Account”)<br>public void iHave$100InMyAccount() throws Throwable {<br>    // TODO: code that puts $100 into User’s Account goes here<br>}</p>
<h2 id="Given-When-Then-Are-the-Same"><a href="#Given-When-Then-Are-the-Same" class="headerlink" title="Given, When, Then Are the Same"></a>Given, When, Then Are the Same</h2><p>It doesn’t actually matter which of the three methods you use to register a step definition, because Cucumber ignores the keyword when matching a step. Under the hood, all of the annotations are aliases for StepDefAnnotation.</p>
<p>The best way we’ve found to avoid this kind of problem is to pay careful attention to the precise wording in your steps. You could change both steps to be less ambiguous:<br>Given I have deposited $100 in my Account Then the balance of my Account should be $100<br>By rewording the steps like this, you’ve made them better at communicating exactly what they will do when executed. Learning to spot and remove this kind of ambiguity is something that takes practice. Paying attention to the distinction in wording between two steps like this can also give you hints about concepts that may not be expressed in your code but need to be. It might seem pedantic, but we’ve found that teams who pay this much careful attention to detail write much better software, faster.</p>
<h3 id="Alternation"><a href="#Alternation" class="headerlink" title="Alternation"></a>Alternation</h3><p>We can specify a wildcard in a regular expression using a few different approaches. One of the simplest is alternation, where we express different options separated by a pipe character |, like this:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Given</span>(<span class="string">"I have deposited \\$(100|250) in my Account"</span>) <span class="keyword">public</span> <span class="keyword">void</span> iHaveDeposited$InMyAccount(<span class="keyword">int</span> amount) &#123;</span><br><span class="line">  <span class="comment">// <span class="doctag">TODO:</span> code goes here</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This step definition will now match a step with either of the two values 100 or 250 in it, and the number will be captured and passed to the method as an argument. Alternation can be useful if there are a fixed set of values that you want to accept in your step definition, but normally you’ll want something a little looser.</p>
<h3 id="The-Dot"><a href="#The-Dot" class="headerlink" title="The Dot"></a>The Dot</h3><p>The dot is a metacharacter, meaning it has magical powers in a regular expression. Literally, a dot means match any single character. So, we can try this instead:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Given</span>(<span class="string">"I have deposited \\$(...) in my Account"</span>) <span class="keyword">public</span> <span class="keyword">void</span> iHaveDeposited$InMyAccount(<span class="keyword">int</span> amount) &#123;</span><br><span class="line">  <span class="comment">// <span class="doctag">TODO:</span> code goes here</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>That will now match a step with any three-figure dollar sum and send the matched amount into the method. </p>
<h4 id="What-If-I-Actually-Want-to-Match-a-Dot"><a href="#What-If-I-Actually-Want-to-Match-a-Dot" class="headerlink" title="What If I Actually Want to Match a Dot?"></a>What If I Actually Want to Match a Dot?</h4><p>Any of the metacharacters like the dot can be escaped by preceding them with a backslash. So, if you wanted to specifically match, say 3.14, you could use “3\.14”.<br>You might have noticed that there’s a backslash in front of the dollar amount in the step definition we’re using. That’s because $ itself is a metacharacter (it’s an anchor, which we’ll explain later), so we need to escape to make it match a normal dollar sign.</p>
<h2 id="Star-modifier"><a href="#Star-modifier" class="headerlink" title="Star modifier"></a>Star modifier</h2><p>The star modifier means any number of times. So, with .* we’re capturing any character, any number of times. Now we’re getting somewhere—this will allow us to capture all those different amounts. But there’s still a problem.<br>The star modifier is a bit of a blunt instrument. Because we’re using it with the dot that matches any character, it will gobble up any text at all up until the phrase in my Account. This is why, in regex terminology, the star modifier is known as a greedy operator. For example, it would happily match this step:<br>Given I have deposited $1 and a cucumber in my Account<br>The amount captured by our regular expression in this case would be 1 and a cucumber. We need to be more specific about the characters we want to match and just capture numbers. Instead of a dot, we can use something else.</p>
<h3 id="Character-Classes"><a href="#Character-Classes" class="headerlink" title="Character Classes"></a>Character Classes</h3><p>Character classes allow you to tell the regular expression engine to match one of a range of characters. You just place all of the characters you would accept inside square brackets:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Given</span>(<span class="string">"I have deposited \\$([01234567890]*) in my Account"</span>) <span class="keyword">public</span> <span class="keyword">void</span> iHaveDeposited$InMyAccount(<span class="keyword">int</span> amount) &#123;</span><br><span class="line">  <span class="comment">// <span class="doctag">TODO:</span> code goes here</span></span><br><span class="line">&#125;</span><br><span class="line">For a continuous range of characters like we have, you can use a hyphen:</span><br><span class="line"><span class="meta">@Given</span>(<span class="string">"I have deposited \\$([0-9]*) in my Account"</span>) <span class="keyword">public</span> <span class="keyword">void</span> iHaveDeposited$InMyAccount(<span class="keyword">int</span> amount) &#123;</span><br><span class="line">  <span class="comment">// <span class="doctag">TODO:</span> code goes here</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Shorthand-Character-Classes"><a href="#Shorthand-Character-Classes" class="headerlink" title="Shorthand Character Classes"></a>Shorthand Character Classes</h3><p>For common patterns of characters like [0-9], there are a few shorthand char- acter classes that you can use instead. You may find this just makes your regular expressions more cryptic, but there are only a few to learn. For a digit, you can use \d as a shorthand for [0-9]:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Given</span>(<span class="string">"I have deposited \\$(\\d*) in my Account"</span>) <span class="keyword">public</span> <span class="keyword">void</span> iHaveDeposited$InMyAccount(<span class="keyword">int</span> amount) &#123;</span><br><span class="line">  <span class="comment">// <span class="doctag">TODO:</span> code goes here</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here are the most useful shorthand character classes: \d stands for digit, or [0-9].<br>\w stands for word character, specifically [A-Za-z0-9_]. Notice that underscores and digits are included but not hyphens.<br>\s stands for whitespace character, specifically [ \t\r\n]. That means a space, a tab, or a line break.<br>\b stands for word boundary, which is a lot like \s but actually means the opposite of \w. Anything that is not a word character is a word boundary.<br>You can also negate shorthand character classes by capitalizing them, so for example, \D means any character except a digit.<br>Back to matching our amount. It looks like we’re done, but there’s one last problem to fix. Can you see what it is?</p>
<h3 id="question-mark"><a href="#question-mark" class="headerlink" title="question mark"></a>question mark</h3><p>Like the star and the plus, the question mark modifies the character that precedes it, specifying how many times it can be repeated. The question mark modifier means zero or one times; in other words, it makes the preceding character optional. In step definitions, it’s particularly useful for plurals:<br>@Given(“I have (\d+) cucumbers? in my basket”) public void iHaveCucumbersInMyBasket(int number) {<br>  // TODO: code goes here<br>}</p>
<h3 id="noncapturing-group"><a href="#noncapturing-group" class="headerlink" title="noncapturing group"></a>noncapturing group</h3><p>@When(“I (?:visit|go to) the homepage”) public void iVisitTheHomepage() {<br>  // TODO: code goes here<br>}
Notice that we’ve had to prefix the list of alternates with another bit of regular expression magic. The ?: at the start of the group marks it as noncapturing, meaning Cucumber won’t pass it as an argument to our block.</p>
<h3 id="Anchors"><a href="#Anchors" class="headerlink" title="Anchors"></a>Anchors</h3><p>The undefined steps start with a ^ and end with a $. These two metacharacters are called anchors, because they’re used to tie down each end of the regular expression to the beginning and end of the string that they match on.</p>
<p>Generally, it’s best to keep your regular expressions as tight as you can so that there’s less chance of two step definitions clashing with each other.</p>
<h1 id="Guides-on-how-to-write-scenarios"><a href="#Guides-on-how-to-write-scenarios" class="headerlink" title="Guides on how to write scenarios"></a>Guides on how to write scenarios</h1><p>Try to avoid being guided by existing step definitions when you write your scenarios and just write down exactly what you want to happen, in plain English. In fact, try to avoid programmers or testers writing scenarios on their own. Instead, get nontechnical stakeholders or analysts to write the first draft of each scenario from a purely business-focused perspective or ideally in a pair with a programmer to help them share their mental model. With a well- engineered support layer, you can confidently and quickly write new step definitions to match the way the scenario has been expressed.</p>
<h1 id="Imperative-Steps"><a href="#Imperative-Steps" class="headerlink" title="Imperative Steps"></a>Imperative Steps</h1><p>In computer programming, there are two contrasting styles for expressing the instructions you give to a computer to make it do something for you. These styles are called imperative programming and declarative programming.</p>
<p>Imperative programming means using a sequence of commands for the com- puter to perform in a particular order. Java is an example of an imperative language: you write a program as a series of statements that Java runs one at a time, in order. A declarative program tells the computer what it should do without prescribing precisely how to do it. CSS is an example of a declar- ative language: you tell the computer what you want the various elements on a web page to look like, and you leave it to take care of the rest.</p>
<h2 id="Use-a-Declarative-Style-Instead"><a href="#Use-a-Declarative-Style-Instead" class="headerlink" title="Use a Declarative Style Instead"></a>Use a Declarative Style Instead</h2><p>Let’s raise the level of abstraction in this scenario and rewrite it using a more declarative style:<br>Scenario: Redirect user to originally requested page after logging in Given I am an unauthenticated User<br>When I attempt to view some restricted content<br>Then I am shown a login form<br>When I authenticate with valid credentials Then I should be shown the restricted content<br>The beauty of this style is that it is not coupled to any specific implementation of the user interface. This same scenario could apply to a thick-client or mobile application. The words it uses aren’t technical and are instead written in a language (unauthenticated, restricted, credentials) that any stakeholder interested in security should be able to clearly understand. It’s by expressing every scenario at this level of abstraction that you discover your team’s ubiquitous language.</p>
<h1 id="DAMP"><a href="#DAMP" class="headerlink" title="DAMP"></a>DAMP</h1><p>However, when you are using examples to drive your code, there is another principle in play that I believe trumps the DRY principle: the examples should tell a good story. They are the docu- mentation narrative that will guide future programmers (including you when you come back to change this code in three months time and you’ve forgotten what it does). In this case, clarity of intent is found in the quality of the narrative, not necessarily in minimizing duplication.</p>
<p>Some people refer to this as the DAMP principle: Descriptive and Meaningful Phrases. When you’re writing examples, readability is paramount, and DAMP trumps DRY.</p>
<p>We consider fixture data to be an antipattern. We much prefer using Test Data Builders, on page 104, where the relevant data is created within the test itself, rather than being buried away in a big tangled set of fixture data.</p>
<p>We find that teams that have a single humongous build also tend to have an architecture that could best be described as a big ball of mud. Because all of the behavior in the system is implemented in one place, all the tests have to live in one place, too, and have to all be run together as one big lump. This is a classic ailment of long-lived applications, which have grown organically without obvious interfaces between their subsystems.</p>
<h1 id="Defect-Prevention"><a href="#Defect-Prevention" class="headerlink" title="Defect Prevention"></a>Defect Prevention</h1><p>Toyota’s counterintuitive but hugely successful policy of stopping the line works because it’s part of a wider process, known as defect prevention, that focuses on continuously improving the manufacturing system. Without this wider process, stop the line itself would have very little effect. There are four steps to this process:</p>
<ul>
<li>Detect the abnormality.</li>
<li>Stop what you’re doing.</li>
<li>Fix or correct the immediate problem.</li>
<li>Investigate the root cause and install a countermeasure.<br>This fourth step is crucial because it seizes the opportunity offered by the problem at hand to understand something more fundamental about your process. It also means that fixing things becomes a habit, rather than some- thing you put off to do someday later when you’re not in such a hurry.</li>
</ul>
<p>Cucumber might just seem like a testing tool, but at its heart it’s really a collaboration tool. If you make a genuine effort to write features that work as documentation for the nontechnical stakeholders on your team, you’ll find you are forced to talk with them about details that you might never have otherwise made the time to talk about. Those conversations reveal insights about their understanding of the problem, insights that will help you build a much better solution than you would have otherwise. This is Cucumber’s big secret: the tests and documentation are just a happy side effect; the real value lies in the knowledge you discover during those conversations.</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul>
<li><a href="https://medium.com/agile-vision/cucumber-bdd-part-2-creating-a-sample-java-project-with-cucumber-testng-and-maven-127a1053c180" target="_blank" rel="noopener">https://medium.com/agile-vision/cucumber-bdd-part-2-creating-a-sample-java-project-with-cucumber-testng-and-maven-127a1053c180</a></li>
<li><a href="https://codoid.com/cucumber-lambda-expressions/" target="_blank" rel="noopener">https://codoid.com/cucumber-lambda-expressions/</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.todzhang.com/2018-08-08-Cucumber/" data-id="cjxaajrs8006zbhq1s0so5jq7" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2018-08-09-Chronicle" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018-08-09-Chronicle/" class="article-date">
  <time datetime="2019-05-31T13:03:27.000Z" itemprop="datePublished">2019-05-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018-08-09-Chronicle/">Chronicle</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h1><p>Chronicle Software is about simplifying fast data.  It is a suite of libraries to make it easier to write, monitor and tune data processing systems where performance and scalability are concerned.</p>
<h1 id="Writing-to-a-Queue"><a href="#Writing-to-a-Queue" class="headerlink" title="Writing to a Queue"></a>Writing to a Queue</h1><p>In Chronicle Queue we refer to the act of writing your data to the Chronicle queue, as storing an excerpt. This data could be made up from any data type, including text, numbers, or serialised blobs. Ultimately, all your data, regardless of what it is, is stored as a series of bytes.</p>
<p>Just before storing your excerpt, Chronicle Queue reserves an 8-byte header. Chronicle Queue writes the length of your data into this header. This way, when Chronicle Queue comes to read your excerpt, it knows how long each blob of data is. We refer to this 8-byte header, along with your excerpt, as a document. So strictly speaking Chronicle Queue can be used to read and write documents.</p>
<blockquote>
<p>Within this 8-byte header we also reserve a few bits for a number of internal operations, such as locking, to make Chronicle Queue thread-safe across both processors and threads. The important thing to note is that because of this, you can’t strictly convert the 8 bytes to an integer to find the length of your data blob.</p>
</blockquote>
<p>To write data to a Chronicle-Queue, you must first create an Appender</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (ChronicleQueue queue = SingleChronicleQueueBuilder.binary(path + <span class="string">"/trades"</span>).build()) &#123;</span><br><span class="line">   <span class="keyword">final</span> ExcerptAppender appender = queue.acquireAppender();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Chronicle Queue uses the following low-level interface to write the data:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="keyword">final</span> DocumentContext dc = appender.writingDocument()) &#123;</span><br><span class="line">      dc.wire().write().text(“your text data“);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>So, Chronicle Queue uses an <code>Appender to write</code> to the queue and a <code>Tailer to read</code> from the queue. Unlike other java queuing solutions, messages are not lost when they are read with a Tailer. </p>
<p>Each Chronicle Queue excerpt has a unique index.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="keyword">final</span> DocumentContext dc = appender.writingDocument()) &#123;</span><br><span class="line">    dc.wire().write().text(“your text data“);</span><br><span class="line">    System.out.println(<span class="string">"your data was store to index="</span>+ dc.index());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The high-level methods below such as writeText() are convenience methods on calling appender.writingDocument(), but both approaches essentially do the same thing. The actual code of writeText(CharSequence text) looks like this:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> text to write a message</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">writeText</span><span class="params">(CharSequence text)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> (DocumentContext dc = writingDocument()) &#123;</span><br><span class="line">        dc.wire().bytes().append8bit(text);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This is the highest-level API which hides the fact you are writing to messaging at all. The benefit is that you can swap calls to the interface with a real component, or an interface to a different protocol.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// using the method writer interface.</span></span><br><span class="line">RiskMonitor riskMonitor = appender.methodWriter(RiskMonitor.class);</span><br><span class="line"><span class="keyword">final</span> LocalDateTime now = LocalDateTime.now(Clock.systemUTC());</span><br><span class="line">riskMonitor.trade(<span class="keyword">new</span> TradeDetails(now, <span class="string">"GBPUSD"</span>, <span class="number">1.3095</span>, <span class="number">10e6</span>, Side.Buy, <span class="string">"peter"</span>));</span><br></pre></td></tr></table></figure>

<p>You can write a “self-describing message”. Such messages can support schema changes. They are also easier to understand when debugging or diagnosing problems.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// writing a self describing message</span></span><br><span class="line">appender.writeDocument(w -&gt; w.write(<span class="string">"trade"</span>).marshallable(</span><br><span class="line">        m -&gt; m.write(<span class="string">"timestamp"</span>).dateTime(now)</span><br><span class="line">                .write(<span class="string">"symbol"</span>).text(<span class="string">"EURUSD"</span>)</span><br><span class="line">                .write(<span class="string">"price"</span>).float64(<span class="number">1.1101</span>)</span><br><span class="line">                .write(<span class="string">"quantity"</span>).float64(<span class="number">15e6</span>)</span><br><span class="line">                .write(<span class="string">"side"</span>).object(Side.class, Side.Sell)</span><br><span class="line">                .write(<span class="string">"trader"</span>).text(<span class="string">"peter"</span>)));</span><br></pre></td></tr></table></figure>

<p>You can write “raw data” which is self-describing. The types will always be correct; position is the only indication as to the meaning of those values.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// writing just data</span></span><br><span class="line">appender.writeDocument(w -&gt; w</span><br><span class="line">        .getValueOut().int32(<span class="number">0x123456</span>)</span><br><span class="line">        .getValueOut().int64(<span class="number">0x999000999000L</span>)</span><br><span class="line">        .getValueOut().text(<span class="string">"Hello World"</span>));</span><br></pre></td></tr></table></figure>

<p>You can write “raw data” which is not self-describing. Your reader must know what this data means, and the types that were used.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// writing raw data</span></span><br><span class="line">appender.writeBytes(b -&gt; b</span><br><span class="line">        .writeByte((<span class="keyword">byte</span>) <span class="number">0x12</span>)</span><br><span class="line">        .writeInt(<span class="number">0x345678</span>)</span><br><span class="line">        .writeLong(<span class="number">0x999000999000L</span>)</span><br><span class="line">        .writeUtf8(<span class="string">"Hello World"</span>));</span><br></pre></td></tr></table></figure>

<p>This is the lowest level way to write data. You get an address to raw memory and you can write what you want.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Unsafe low level</span></span><br><span class="line">appender.writeBytes(b -&gt; &#123;</span><br><span class="line">    <span class="keyword">long</span> address = b.address(b.writePosition());</span><br><span class="line">    Unsafe unsafe = UnsafeMemory.UNSAFE;</span><br><span class="line">    unsafe.putByte(address, (<span class="keyword">byte</span>) <span class="number">0x12</span>);</span><br><span class="line">    address += <span class="number">1</span>;</span><br><span class="line">    unsafe.putInt(address, <span class="number">0x345678</span>);</span><br><span class="line">    address += <span class="number">4</span>;</span><br><span class="line">    unsafe.putLong(address, <span class="number">0x999000999000L</span>);</span><br><span class="line">    address += <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">byte</span>[] bytes = <span class="string">"Hello World"</span>.getBytes(StandardCharsets.ISO_8859_1);</span><br><span class="line">    unsafe.copyMemory(bytes, Unsafe.ARRAY_BYTE_BASE_OFFSET, <span class="keyword">null</span>, address, bytes.length);</span><br><span class="line">    b.writeSkip(<span class="number">1</span> + <span class="number">4</span> + <span class="number">8</span> + bytes.length);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>You can print the contents of the queue. You can see the first two, and last two messages store the same data.</p>
<p>// dump the content of the queue<br>System.out.println(queue.dump());</p>
<h1 id="position-262568-header-0"><a href="#position-262568-header-0" class="headerlink" title="position: 262568, header: 0"></a>position: 262568, header: 0</h1><p>— !!data #binary<br>trade: {<br>  timestamp: 2016-07-17T15:18:41.141,<br>  symbol: GBPUSD,<br>  price: 1.3095,<br>  quantity: 10000000.0,<br>  side: Buy,<br>  trader: peter<br>}</p>
<h1 id="position-262684-header-1"><a href="#position-262684-header-1" class="headerlink" title="position: 262684, header: 1"></a>position: 262684, header: 1</h1><p>— !!data #binary<br>trade: {<br>  timestamp: 2016-07-17T15:18:41.141,<br>  symbol: EURUSD,<br>  price: 1.1101,<br>  quantity: 15000000.0,<br>  side: Sell,<br>  trader: peter<br>}</p>
<h1 id="position-262800-header-2"><a href="#position-262800-header-2" class="headerlink" title="position: 262800, header: 2"></a>position: 262800, header: 2</h1><p>— !!data #binary<br>!int 1193046<br>168843764404224<br>Hello World</p>
<h1 id="position-262830-header-3"><a href="#position-262830-header-3" class="headerlink" title="position: 262830, header: 3"></a>position: 262830, header: 3</h1><p>— !!data #binary<br>000402b0       12 78 56 34 00 00  90 99 00 90 99 00 00 0B   ·xV4·· ········<br>000402c0 48 65 6C 6C 6F 20 57 6F  72 6C 64                Hello Wo rld</p>
<h1 id="position-262859-header-4"><a href="#position-262859-header-4" class="headerlink" title="position: 262859, header: 4"></a>position: 262859, header: 4</h1><p>— !!data #binary<br>000402c0                                               12                 ·<br>000402d0 78 56 34 00 00 90 99 00  90 99 00 00 0B 48 65 6C xV4····· ·····Hel<br>000402e0 6C 6F 20 57 6F 72 6C 64 </p>
<h2 id="Finding-the-index-at-the-end-of-a-Chronicle-Queue"><a href="#Finding-the-index-at-the-end-of-a-Chronicle-Queue" class="headerlink" title="Finding the index at the end of a Chronicle Queue"></a>Finding the index at the end of a Chronicle Queue</h2><p>Chronicle Queue appenders are thread-local. In fact when you ask for:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> ExcerptAppender appender = queue.acquireAppender();</span><br></pre></td></tr></table></figure>

<p>the acquireAppender() uses a thread-local pool to give you an appender which will be reused to reduce object creation.</p>
<p>As such, the method call to:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">long</span> index = appender.lastIndexAppended();</span><br></pre></td></tr></table></figure>

<p>will only give you the last index appended by this appender; not the last index appended by any appender.</p>
<p>If you wish to find the index of the last record written, then you have to call:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">long</span> index = queue.createTailer().toEnd().index();</span><br></pre></td></tr></table></figure>

<h2 id="Dumping-a-Chronicle-Queue-cq4-file-as-text-to-the-Command-Line"><a href="#Dumping-a-Chronicle-Queue-cq4-file-as-text-to-the-Command-Line" class="headerlink" title="Dumping a Chronicle Queue, cq4 file as text to the Command Line"></a>Dumping a Chronicle Queue, cq4 file as text to the Command Line</h2><p>Chronicle Queue stores its data in binary format, with a file extension of cq4:</p>
<p>\��@π�header∂�SCQStoreÇE���»wireType∂�WireTypeÊBINARYÕwritePositionèèèèß��������ƒroll∂�SCQSRollÇ*���∆length¶ÄÓ6�∆format<br>ÎyyyyMMdd-HH≈epoch¶ÄÓ6�»indexing∂SCQSIndexingÇN��� indexCount•��ÃindexSpacing�Àindex2Indexé����ß��������…lastIndexé�<br>���ß��������ﬂlastAcknowledgedIndexReplicatedé������ßˇˇˇˇˇˇˇˇ»recovery∂�TimedStoreRecoveryÇ����…timeStampèèèß����������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������������<br>This can often be a bit difficult to read, so it is better to dump the cq4 files as text. This can also help you fix your production issues, as it gives you the visibility as to what has been stored in the queue, and in what order.</p>
<p>You have to use the chronicle-queue.jar, from any version 4.5.3 or later, and set up the dependent files in the class path. </p>
<p>$ java -cp chronicle-queue-4.5.5.jar net.openhft.chronicle.queue.DumpQueueMain 19700101-02.cq4</p>
<p>this will dump the 19700101-02.cq4 file out as text, as shown below:</p>
<p>— !!meta-data #binary<br>header: !SCQStore {<br>  wireType: !WireType BINARY,<br>  writePosition: 0,<br>  roll: !SCQSRoll {<br>    length: !int 3600000,<br>    format: yyyyMMdd-HH,<br>    epoch: !int 3600000<br>  },<br>  indexing: !SCQSIndexing {<br>    indexCount: !short 4096,<br>    indexSpacing: 4,<br>    index2Index: 0,<br>    lastIndex: 0<br>  },<br>  lastAcknowledgedIndexReplicated: -1,<br>  recovery: !TimedStoreRecovery {<br>    timeStamp: 0<br>  }<br>}</p>
<p>…<br>4198044 bytes remaining</p>
<h2 id="Reading-from-a-Queue-using-a-Tailer"><a href="#Reading-from-a-Queue-using-a-Tailer" class="headerlink" title="Reading from a Queue using a Tailer"></a>Reading from a Queue using a Tailer</h2><p>Reading the queue follows the same pattern as writing, except there is a possibility there is not a message when you attempt to read it.</p>
<p>Start Reading</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (ChronicleQueue queue = SingleChronicleQueueBuilder.binary(path + <span class="string">"/trades"</span>).build()) &#123;</span><br><span class="line">   <span class="keyword">final</span> ExcerptTailer tailer = queue.createTailer();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can turn each message into a method call based on the content of the message.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// reading using method calls</span></span><br><span class="line">RiskMonitor monitor = System.out::println;</span><br><span class="line">MethodReader reader = tailer.methodReader(monitor);</span><br><span class="line"><span class="comment">// read one message</span></span><br><span class="line">assertTrue(reader.readOne());</span><br></pre></td></tr></table></figure>

<p>You can decode the message yourself.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">assertTrue(tailer.readDocument(w -&gt; w.read(<span class="string">"trade"</span>).marshallable(</span><br><span class="line">        m -&gt; &#123;</span><br><span class="line">            LocalDateTime timestamp = m.read(<span class="string">"timestamp"</span>).dateTime();</span><br><span class="line">            String symbol = m.read(<span class="string">"symbol"</span>).text();</span><br><span class="line">            <span class="keyword">double</span> price = m.read(<span class="string">"price"</span>).float64();</span><br><span class="line">            <span class="keyword">double</span> quantity = m.read(<span class="string">"quantity"</span>).float64();</span><br><span class="line">            Side side = m.read(<span class="string">"side"</span>).object(Side.class);</span><br><span class="line">            String trader = m.read(<span class="string">"trader"</span>).text();</span><br><span class="line">            <span class="comment">// do something with values.</span></span><br><span class="line">        &#125;)));</span><br></pre></td></tr></table></figure>

<p>You can read self-describing data values. This will check the types are correct, and convert as required.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">assertTrue(tailer.readDocument(w -&gt; &#123;</span><br><span class="line">    ValueIn in = w.getValueIn();</span><br><span class="line">    <span class="keyword">int</span> num = in.int32();</span><br><span class="line">    <span class="keyword">long</span> num2 = in.int64();</span><br><span class="line">    String text = in.text();</span><br><span class="line">    <span class="comment">// do something with values</span></span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>

<p>You can read raw data as primitives and strings.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">assertTrue(tailer.readBytes(in -&gt; &#123;</span><br><span class="line">    <span class="keyword">int</span> code = in.readByte();</span><br><span class="line">    <span class="keyword">int</span> num = in.readInt();</span><br><span class="line">    <span class="keyword">long</span> num2 = in.readLong();</span><br><span class="line">    String text = in.readUtf8();</span><br><span class="line">    assertEquals(<span class="string">"Hello World"</span>, text);</span><br><span class="line">    <span class="comment">// do something with values</span></span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>

<p>or, you can get the underlying memory address and access the native memory.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">assertTrue(tailer.readBytes(b -&gt; &#123;</span><br><span class="line">    <span class="keyword">long</span> address = b.address(b.readPosition());</span><br><span class="line">    Unsafe unsafe = UnsafeMemory.UNSAFE;</span><br><span class="line">    <span class="keyword">int</span> code = unsafe.getByte(address);</span><br><span class="line">    address++;</span><br><span class="line">    <span class="keyword">int</span> num = unsafe.getInt(address);</span><br><span class="line">    address += <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">long</span> num2 = unsafe.getLong(address);</span><br><span class="line">    address += <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">int</span> length = unsafe.getByte(address);</span><br><span class="line">    address++;</span><br><span class="line">    <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[length];</span><br><span class="line">    unsafe.copyMemory(<span class="keyword">null</span>, address, bytes, Unsafe.ARRAY_BYTE_BASE_OFFSET, bytes.length);</span><br><span class="line">    String text = <span class="keyword">new</span> String(bytes, StandardCharsets.UTF_8);</span><br><span class="line">    assertEquals(<span class="string">"Hello World"</span>, text);</span><br><span class="line">    <span class="comment">// do something with values</span></span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>

<h3 id="Tailers-and-File-Handlers-Clean-up"><a href="#Tailers-and-File-Handlers-Clean-up" class="headerlink" title="Tailers and File Handlers Clean up"></a>Tailers and File Handlers Clean up</h3><p>Chronicle queue tailers may create file handlers, the file handlers are cleaned up whenever the associated chronicle queue is close() or whenever the Jvm runs a Garbage Collection. </p>
<h3 id="ExcerptTailer-toEnd"><a href="#ExcerptTailer-toEnd" class="headerlink" title="ExcerptTailer.toEnd()"></a>ExcerptTailer.toEnd()</h3><p>In some applications, it may be necessary to start reading from the end of the queue (e.g. in a restart scenario). For this use-case, ExcerptTailer provides the toEnd() method.</p>
<p>If it is necessary to read backwards through the queue from the end, then the tailer can be set to read backwards:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ExcerptTailer tailer = queue.createTailer();</span><br><span class="line">tailer.direction(TailerDirection.BACKWARD).toEnd();</span><br></pre></td></tr></table></figure>

<p>When reading backwards, then the toEnd() method will move the tailer to the last record in the queue. If the queue is not empty, then there will be a DocumentContext available for reading:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// this will be true if there is at least one message in the queue</span></span><br><span class="line"><span class="keyword">boolean</span> messageAvailable = tailer.toEnd().direction(TailerDirection.BACKWARD).</span><br><span class="line">        readingDocument().isPresent();</span><br></pre></td></tr></table></figure>

<h1 id="Low-GC"><a href="#Low-GC" class="headerlink" title="Low GC"></a>Low GC</h1><p>Ultra low GC means less than one minor collection per day.</p>
<p>the principles of Zero-copy eliminating unnecessary garbage collection and increased speed. Runtime code generation that reduces code size for efficient CPU cache usage and increased speed. Smart ordering for optimal parsing and you guessed it increased speed. All these combine to allow Chronicle FIX to achieve excellent performance results.</p>
<h1 id="Low-garbage-rate"><a href="#Low-garbage-rate" class="headerlink" title="Low garbage rate"></a>Low garbage rate</h1><p>Minimising garbage is key to avoiding GC pauses. To use your L1 and L2 cache efficiently, you need to keep your garbage rates very low.  If you are not using these cache efficiently your application can be 2-5x slower. </p>
<p>The garbage from Chronicle is low enough that you can process one million events without jstat detecting you have created any garbage.  jstat only displays multiples of 4 KB, and only when a new TLAB is allocated.  Chronicle does create garbage, but it is extremely low. i.e. a few objects per million events processes.</p>
<p>Once you make the GC pauses manageable, or non-existent, you start to see other sources of delay in your system.   Take away the boulders and you start to see the rocks.  Take away the rocks and you start to see the pebbles.</p>
<h1 id="Chronicle-has-minimal-interaction-with-the-Operating-System"><a href="#Chronicle-has-minimal-interaction-with-the-Operating-System" class="headerlink" title="Chronicle has minimal interaction with the Operating System."></a>Chronicle has minimal interaction with the Operating System.</h1><p>System calls are slow, and if you can avoid call the OS, you can save significant amounts of latency. </p>
<p>For example, if you send a message over TCP on loopback, this can add a 10 micro-seconds latency between writing and reading the data.  You can write to a chronicle, which is a plain write to memory, and read from chronicle, which is also a read from memory with a latency of 0.2 micro-seconds. (And as I mentioned before, you get persistence as well)</p>
<h1 id="No-need-to-worry-about-running-out-of-heap"><a href="#No-need-to-worry-about-running-out-of-heap" class="headerlink" title="No need to worry about running out of heap."></a>No need to worry about running out of heap.</h1><p>A common problem with unbounded queues and this uses an open ended amount of heap.  </p>
<p>Chronicle solves this by not using the heap to store data, but instead using memory mapped files.  This improve memory utilisation by making the data more compact but also means a 1 GB JVM can stream 1 TB of data over a day without worrying about the heap or how much main memory you have.  In this case, an unbounded queue becomes easier to manage.</p>
<h1 id="how-it-works"><a href="#how-it-works" class="headerlink" title="how it works"></a>how it works</h1><p>Chronicle uses a memory mapped file to continuously journal messages, chronicles file-based storage will slowly grow in size as more data is written to the queue, the size of the queue can exceed your available memory, you are only constrained by the amount of disk space you have on your server. Chronicle writes data directly into off-heap memory which is shared between java processes on the same server.</p>
<p>Chronicle is very fast, it is able to write and read a message in just two microseconds with no garbage. Typically at the end of each day, you archive the queue and start the next day with a fresh empty queue.</p>
<h1 id="Chronicle-Queue-is-a-distributed-unbounded-persisted-queue"><a href="#Chronicle-Queue-is-a-distributed-unbounded-persisted-queue" class="headerlink" title="Chronicle Queue is a distributed unbounded persisted queue."></a>Chronicle Queue is a distributed unbounded persisted queue.</h1><p>Chronicle Queue:</p>
<p>supports asynchronous RMI and Publish/Subscribe interfaces with microsecond latencies.</p>
<p>passes messages between JVMs in under a microsecond (in optimised examples)</p>
<p>passes messages between JVMs on different machines via replication in under 10 microseconds (in optimised examples)</p>
<p>provides stable, soft, real time latencies into the millions of messages per second for a single thread to one queue; with total ordering of every event.</p>
<h2 id="Queue-introduction"><a href="#Queue-introduction" class="headerlink" title="Queue introduction"></a>Queue introduction</h2><p>Chronicle Queue is a Java project focused on building a persisted low-latency messaging framework for high performance and critical applications.</p>
<p>Chronicle diagram 005<br>At first glance Chronicle Queue can be seen as simply another queue implementation. However, it has major design choices that should be emphasised.</p>
<p>Using non-heap storage options (RandomAccessFile), Chronicle Queue provides a processing environment where applications do not suffer from Garbage Collection (GC). When implementing high-performance and memory-intensive applications (you heard the fancy term “bigdata”?) in Java, one of the biggest problems is garbage collection.</p>
<p>Garbage collection may slow down your critical operations non-deterministically at any time. In order to avoid non-determinism, and escape from garbage collection delays, off-heap memory solutions are ideal. The main idea is to manage your memory manually so it does not suffer from garbage collection. Chronicle Queue behaves like a management interface over off-heap memory so you can build your own solutions over it.</p>
<p>Chronicle Queue uses RandomAccessFiles while managing memory and this choice brings lots of possibilities. RandomAccessFiles permit non-sequential, or random, access to a file’s contents. To access a file randomly, you open the file, seek a particular location, and read from or write to that file. RandomAccessFiles can be seen as “large” C-type byte arrays that you can access at any random index “directly” using pointers. File portions can be used as ByteBuffers if the portion is mapped into memory.</p>
<p>This memory mapped file is also used for exceptionally fast interprocess communication (IPC) without affecting your system performance. There is no garbage collection as everything is done off-heap.</p>
<h2 id="Message-type"><a href="#Message-type" class="headerlink" title="Message type"></a>Message type</h2><ul>
<li>TCP: Stream-oriented </li>
<li>UDP, SCTP: message-oriented .</li>
</ul>
<h2 id="On-heap-vs-off-heap-memory-usage"><a href="#On-heap-vs-off-heap-memory-usage" class="headerlink" title="On heap vs off heap memory usage"></a>On heap vs off heap memory usage</h2><p>Overview</p>
<p>I was recently asked about the benefits and wisdom of using off heap memory in Java.  The answers may be of interest to others facing the same choices.</p>
<p>Off heap memory is nothing special.  The thread stacks, application code, NIO buffers are all off heap.  In fact in C and C++, you only have unmanaged memory as it does not have a managed heap by default.  The use of managed memory or “heap” in Java is a special feature of the language. Note: Java is not the only language to do this.<br>new Object() vs Object pool vs Off Heap memory.</p>
<p>new Object()</p>
<p>Before Java 5.0, using object pools was very popular.  Creating objects was still very expensive.   However, from Java 5.0, object allocation and garbage cleanup was made much cheaper, and developers found they got a performance speed up and a simplification of their code by removing object pools and just creating new objects whenever needed.  Before Java 5.0, almost any object pool, even an object pool which used objects provided an improvement, from Java 5.0 pooling only expensive objects obviously made sense e.g. threads, socket and database connections.</p>
<p>Object pools</p>
<p>In the low latency space it was still apparent that recycling mutable objects improved performance by reduced pressure on your CPU caches.  These objects have to have simple life cycles and have a simple structure, but you could see significant improvements in performance and jitter by using them.<br>Another area where it made sense to use object pools is when loading large amounts of data with many duplicate objects. With a significant reduction in memory usage and a reduction in the number of objects the GC had to manage, you saw a reduction in GC times and an increase in throughput.<br>These object pools were designed to be more light weight than say using a synchronized HashMap, and so they still helped.</p>
<p>Take this StringInterner class as an example. You pass it a recycled mutable StringBuilder of the text you want as a String and it will provide a String which matches.  Passing a String would be inefficient as you would have already created the object.  The StringBuilder can be recycled.<br>Note: this structure has an interesting property that requires no additional thread safety features, like volatile or synchronized, other than is provided by the minimum Java guarantees. i.e. you can see the final fields in a String correctly and only read consistent references.</p>
<p>public class StringInterner {<br>    private final String[] interner;<br>    private final int mask;<br>    public StringInterner(int capacity) {<br>        int n = Maths.nextPower2(capacity, 128);<br>        interner = new String[n];<br>        mask = n - 1;<br>    }</p>
<pre><code>private static boolean isEqual(@Nullable CharSequence s, @NotNull CharSequence cs) {
    if (s == null) return false;
    if (s.length() != cs.length()) return false;
    for (int i = 0; i &lt; cs.length(); i++)
        if (s.charAt(i) != cs.charAt(i))
            return false;
    return true;
}

@NotNull
public String intern(@NotNull CharSequence cs) {
    long hash = 0;
    for (int i = 0; i &lt; cs.length(); i++)
        hash = 57 * hash + cs.charAt(i);
    int h = (int) Maths.hash(hash) &amp; mask;
    String s = interner[h];
    if (isEqual(s, cs))
        return s;
    String s2 = cs.toString();
    return interner[h] = s2;
}</code></pre><p>}
Off heap memory usage</p>
<p>Using off heap memory and using object pools both help reduce GC pauses, this is their only similarity.  Object pools are good for short lived mutable objects, expensive to create objects and long live immutable objects where there is a lot of duplication.  Medium lived mutable objects, or complex objects are more likely to be better left to the GC to handle.  However, medium to long lived mutable objects suffer in a number of ways which off heap memory solves.</p>
<p>Off heap memory provides;</p>
<p>Scalability to large memory sizes e.g. over 1 TB and larger than main memory.<br>Notional impact on GC pause times.<br>Sharing between processes, reducing duplication between JVMs, and making it easier to split JVMs.<br>Persistence for faster restarts or replying of production data in test.<br>The use of off heap memory gives you more options in terms of how you design your system.  The most important improvement is not performance, but determinism.</p>
<p>Off heap and testing</p>
<p>One of the biggest challenges in high performance computing is reproducing obscure bugs and being able to prove you have fixed them.  By storing all your input events and data off heap in a persisted way you can turn your critical systems into a series of complex state machines. (Or in simple cases, just one state machine) In this way you get reproducible behaviour and performance between test and production.</p>
<p>A number of investment banks use this technique to replay a system reliably to any event in the day and work out exactly why that event was processed the way it was.  More importantly, once you have a fix you can show that you have fixed the issue which occurred in production, instead of finding an issue and hoping this was the issue.</p>
<p>Along with deterministic behaviour comes deterministic performance.  In test environments, you can replay the events with realistic timings and show the latency distribution you expect to get in production.  Some system jitter can’t be reproduce esp if the hardware is not the same, but you can get pretty close when you take a statistical view.  To avoid taking a day to replay a day of data you can add a threshold. e.g. if the time between events is more than 10 ms you might only wait 10 ms.  This can allow you to replay a day of events with realistic timing in under an hour and see whether your changes have improved your latency distribution or not.</p>
<p>By going more low level don’t you lose some of “compile once, run anywhere”?</p>
<p>To some degree this is true, but it is far less than you might think.  When you are working closer the processor and so you are more dependant on how the processor, or OS behaves.  Fortunately, most systems use AMD/Intel processors and even ARM processors are becoming more compatible in terms of the low level guarantees they provide.  There is also differences in the OSes, and these techniques tend to work better on Linux than Windows.  However, if you develop on MacOSX or Windows and use Linux for production, you shouldn’t have any issues.  This is what we do at Higher Frequency Trading.</p>
<p>What new problems are we creating by using off heap?</p>
<p>Nothing comes for free, and this is the case with off heap.  The biggest issue with off heap is your data structures become less natural.  You either need a simple data structure which can be mapped directly to off heap, or you have a complex data structure which serializes and deserializes to put it off heap.  Obvious using serialization has its own headaches and performance hit.  Using serialization thus much slower than on heap objects.</p>
<p>In the financial world, most high ticking data structure are flat and simple, full of primitives which maps nicely off heap with little overhead.</p>
<h1 id="How-does-Chronicle-Queue-work"><a href="#How-does-Chronicle-Queue-work" class="headerlink" title="How does Chronicle Queue work"></a>How does Chronicle Queue work</h1><h2 id="Terminology"><a href="#Terminology" class="headerlink" title="Terminology"></a>Terminology</h2><ul>
<li>Messages are grouped by topics. A topic can contain any number of sub-topics which are logically stored together under the queue/topic.</li>
<li>An appender is the source of messages.</li>
<li>A tailer is a receiver of messages.</li>
<li>Chronicle Queue is <code>broker-less</code> by default. You can use Chronicle Engine to act as a broker for remote access.</li>
</ul>
<blockquote>
<p>Note<br>We deliberately avoid the term consumer as messages are not consumed/destroyed by reading.</p>
</blockquote>
<h2 id="At-a-high-level"><a href="#At-a-high-level" class="headerlink" title="At a high level:"></a>At a high level:</h2><ul>
<li><p>appenders write to the end of a queue. There is no way to insert, or delete excerpts.</p>
</li>
<li><p>tailers read the next available message each time they are called.</p>
</li>
</ul>
<p>By using Chronicle Engine, a Java or C# client can publish to a queue to act as a remote appender, and you subscribe to a queue to act as a remote tailer.</p>
<h2 id="Topics-and-Queue-files"><a href="#Topics-and-Queue-files" class="headerlink" title="Topics and Queue files"></a>Topics and Queue files</h2><p>Each topic is a directory of queues. There is a file for each roll cycle. If you have a topic called mytopic, the layout could look like this:</p>
<p>mytopic/<br>    20160710.cq4<br>    20160711.cq4<br>    20160712.cq4<br>    20160713.cq4<br>To copy all the data for a single day (or cycle), you can copy the file for that day on to your development machine for replay testing.</p>
<p>Appenders and tailers are cheap as they don’t even require a TCP connection; they are just a few Java objects.</p>
<h2 id="File-Retention"><a href="#File-Retention" class="headerlink" title="File Retention"></a>File Retention</h2><p>You can add a StoreFileListener to notify you when a file is added, or no longer used. This can be used to delete files after a period of time. However, by default, files are retained forever. Our largest users have over 100 TB of data stored in queues.</p>
<h2 id="Every-Tailer-sees-every-message"><a href="#Every-Tailer-sees-every-message" class="headerlink" title="Every Tailer sees every message."></a>Every Tailer sees every message.</h2><p>An abstraction can be added to filter messages, or assign messages to just one message processor. However, in general you only need one main tailer for a topic, with possibly, some supporting tailers for monitoring etc.</p>
<p>As Chronicle Queue doesn’t partition its topics, you get total ordering of all messages within that topic. Across topics, there is no guarantee of ordering; if you want to replay deterministically from a system which consumes from multiple topics, we suggest replaying from that system’s output.</p>
<h1 id="Guarantees"><a href="#Guarantees" class="headerlink" title="Guarantees"></a>Guarantees</h1><p>Chronicle Queue provides the following guarantees;</p>
<p>for each appender, messages are written in the order the appender wrote them. Messages by different appenders are interleaved,</p>
<p>for each tailer, it will see every message for a topic in the same order as every other tailer,</p>
<p>when replicated, every replica has a copy of every message.</p>
<h1 id="Use-Cases"><a href="#Use-Cases" class="headerlink" title="Use Cases"></a>Use Cases</h1><p>Chronicle Queue is most often used for producer-centric systems where you need to retain a lot of data for days or years.</p>
<h2 id="What-is-a-producer-centric-system"><a href="#What-is-a-producer-centric-system" class="headerlink" title="What is a producer-centric system?"></a>What is a producer-centric system?</h2><p>Most messaging systems are consumer-centric. Flow control is implemented to avoid the consumer ever getting overloaded; even momentarily. A common example is a server supporting multiple GUI users. Those users might be on different machines (OS and hardware), different qualities of network (latency and bandwidth), doing a variety of other things at different times. For this reason it makes sense for the client consumer to tell the producer when to back off, delaying any data until the consumer is ready to take more data.</p>
<p>Chronicle Queue is a producer-centric solution and does everything possible to never push back on the producer, or tell it to slow down. This makes it a powerful tool, providing a big buffer between your system, and an upstream producer over which you have little, or no, control.</p>
<p>For market data in particular, real time means in a few microseconds; it doesn’t mean intra-day (during the day).</p>
<p>Chronicle Queue is fast and efficient, and has been used to increase the speed that data is passed between threads. In addition, it also keeps a record of every message passed allowing you to significantly reduce the amount of logging that you need to do.</p>
<h2 id="Latency-Sensitive-Micro-services"><a href="#Latency-Sensitive-Micro-services" class="headerlink" title="Latency Sensitive Micro-services"></a>Latency Sensitive Micro-services</h2><p>Chronicle Queue supports low latency IPC (Inter Process Communication) between JVMs on the same machine in the order of magnitude of 1 microsecond; as well as between machines with a typical latency of 10 microseconds for modest throughputs of a few hundred thousands. Chronicle Queue supports throughputs of millions of events per second, with stable microsecond latencies.</p>
<h2 id="Log-Replacement"><a href="#Log-Replacement" class="headerlink" title="Log Replacement"></a>Log Replacement</h2><p>As Chronicle Queue can be used to build state machines. All the information about the state of those components can be reproduced externally, without direct access to the components, or to their state. This significantly reduces the need for additional logging.</p>
<p>However, any logging you do need can be recorded in great detail. This makes enabling DEBUG logging in production practical. This is because the cost of logging is very low; less than 10 microseconds. Logs can be replicated centrally for log consolidation.</p>
<p>Chronicle Queue is being used to store 100+ TB of data, which can be replayed from any point in time.</p>
<h1 id="Source-code"><a href="#Source-code" class="headerlink" title="Source code"></a>Source code</h1><h2 id="MappedFile"><a href="#MappedFile" class="headerlink" title="MappedFile"></a>MappedFile</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.openhft.chronicle.bytes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.openhft.chronicle.core.Jvm;</span><br><span class="line"><span class="keyword">import</span> net.openhft.chronicle.core.OS;</span><br><span class="line"><span class="keyword">import</span> net.openhft.chronicle.core.ReferenceCounted;</span><br><span class="line"><span class="keyword">import</span> net.openhft.chronicle.core.ReferenceCounter;</span><br><span class="line"><span class="keyword">import</span> net.openhft.chronicle.core.io.IORuntimeException;</span><br><span class="line"><span class="keyword">import</span> org.jetbrains.annotations.NotNull;</span><br><span class="line"><span class="keyword">import</span> org.jetbrains.annotations.Nullable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.RandomAccessFile;</span><br><span class="line"><span class="keyword">import</span> java.lang.ref.WeakReference;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.FileChannel;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.FileChannel.MapMode;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.FileLock;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicBoolean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> net.openhft.chronicle.core.io.Closeable.closeQuietly;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A memory mapped files which can be randomly accessed in chunks. It has overlapping regions to</span></span><br><span class="line"><span class="comment"> * avoid wasting bytes at the end of chunks.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MappedFile</span> <span class="keyword">implements</span> <span class="title">ReferenceCounted</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> DEFAULT_CAPACITY = <span class="number">128L</span> &lt;&lt; <span class="number">40</span>;</span><br><span class="line">    <span class="comment">// A single JVM cannot lock a file more than once.</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object GLOBAL_FILE_LOCK = <span class="keyword">new</span> Object();</span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RandomAccessFile raf;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> FileChannel fileChannel;</span><br></pre></td></tr></table></figure>

<p>public interface BytesStore extends RandomDataInput, RandomDataOutput, ReferencedCount, CharSequence</p>
<p>public interface Memory {<br>    default long heapUsed() {<br>        Runtime runtime = Runtime.getRuntime();<br>        return runtime.totalMemory() - runtime.freeMemory();<br>    }</p>
<pre><code>@Override
@ForceInline
public void writeByte(long address, byte b) {
    UNSAFE.putByte(address, b);
}</code></pre><p>/**</p>
<ul>
<li>Marker annotation for some methods and constructors in the JSR 292 implementation.</li>
<li><p></p></li>
<li>To utilise this annotation se Chronicle Enterprise Warmup module.</li>
<li>/
@Target({ElementType.METHOD, ElementType.CONSTRUCTOR})<br>@Retention(RetentionPolicy.RUNTIME)<br>public @interface ForceInline {<br>}</li>
</ul>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul>
<li><a href="https://github.com/OpenHFT/Chronicle-Queue" target="_blank" rel="noopener">https://github.com/OpenHFT/Chronicle-Queue</a></li>
<li><a href="http://vanillajava.blogspot.com/2015/08/what-does-chronicle-software-do.html" target="_blank" rel="noopener">http://vanillajava.blogspot.com/2015/08/what-does-chronicle-software-do.html</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.todzhang.com/2018-08-09-Chronicle/" data-id="cjxaajrs90072bhq14d0znja3" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2018-08-15-PrestoDB" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018-08-15-PrestoDB/" class="article-date">
  <time datetime="2019-05-31T13:03:27.000Z" itemprop="datePublished">2019-05-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018-08-15-PrestoDB/">Presto DB</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="WHAT-IS-PRESTO"><a href="#WHAT-IS-PRESTO" class="headerlink" title="WHAT IS PRESTO?"></a>WHAT IS PRESTO?</h1><p>Presto is an open source distributed SQL query engine for running interactive analytic queries against data sources of all sizes ranging from gigabytes to petabytes.</p>
<p>Presto was designed and written from the ground up for interactive analytics and approaches the speed of commercial data warehouses while scaling to the size of organizations like Facebook.</p>
<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Presto is a distributed system that runs on a cluster of machines. A full installation includes a coordinator and multiple workers. Queries are submitted from a client such as the Presto CLI to the coordinator. The coordinator parses, analyzes and plans the query execution, then distributes the processing to the workers.</p>
<p>Presto does not use MapReduce and thus only requires HDFS.</p>
<h2 id="Separation-of-Storage-and-Compute"><a href="#Separation-of-Storage-and-Compute" class="headerlink" title="Separation of Storage and Compute"></a>Separation of Storage and Compute</h2><p>Architected for separation of storage and compute, Presto can scale up and down based on your analytics demand to access this data. There’s no need to move your data and provisioning compute to the exact need results in significant cost savings.</p>
<h3 id="Config-Properties"><a href="#Config-Properties" class="headerlink" title="Config Properties"></a>Config Properties</h3><p>The config properties file, etc/config.properties, contains the configuration for the Presto server. Every Presto server can function as both a coordinator and a worker, but dedicating a single machine to only perform coordination work provides the best performance on larger clusters.</p>
<h3 id="Catalog-Properties"><a href="#Catalog-Properties" class="headerlink" title="Catalog Properties"></a>Catalog Properties</h3><p>Presto accesses data via connectors, which are mounted in catalogs. The connector provides all of the schemas and tables inside of the catalog. For example, the Hive connector maps each Hive database to a schema, so if the Hive connector is mounted as the hive catalog, and Hive contains a table clicks in database web, that table would be accessed in Presto as hive.web.clicks.</p>
<p>Catalogs are registered by creating a catalog properties file in the etc/catalog directory. For example, create etc/catalog/jmx.properties with the following contents to mount the jmx connector as the jmx catalog:</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.todzhang.com/2018-08-15-PrestoDB/" data-id="cjxaajrsa0074bhq1bcpu0gxv" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2018-08-16-Kafka" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018-08-16-Kafka/" class="article-date">
  <time datetime="2019-05-31T13:03:27.000Z" itemprop="datePublished">2019-05-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018-08-16-Kafka/">KDB</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h1><p>Kafka is fast. A single node can handle hundreds of read/writes from thousands of clients in real time. Kafka is also distributed and scalable. It creates and takes down nodes in an elastic manner, without incurring any downtime. Data streams are split into partitions and spread over different brokers for capability and redundancy.</p>
<h2 id="here-is-some-useful-terminology"><a href="#here-is-some-useful-terminology" class="headerlink" title="here is some useful terminology:"></a>here is some useful terminology:</h2><p>Topic: a feed of messages or packages</p>
<p>Partition: group of topics split for scalability and redundancy</p>
<p>Producer: process that introduces messages into the queue</p>
<p>Consumer: process that subscribes to various topics and processes from a feed of published messages</p>
<p>Broker: a node that is part of the Kafka cluster</p>
<h2 id="Memeroy"><a href="#Memeroy" class="headerlink" title="Memeroy"></a>Memeroy</h2><p>Kafka should run entirely on RAM. JVM heap size shouldn’t be bigger than your available RAM. That is to avoid swapping.</p>
<h3 id="Swap-usage"><a href="#Swap-usage" class="headerlink" title="Swap usage"></a>Swap usage</h3><p>Watch for swap usage, as it will degrade performance on Kafka and lead to operations timing out (set vm.swappiness = 0).    When used swap is &gt; 128MB.</p>
<h1 id="Kafka-Monitoring-Tools"><a href="#Kafka-Monitoring-Tools" class="headerlink" title="Kafka Monitoring Tools"></a>Kafka Monitoring Tools</h1><p>Any monitoring tools with JMX support should be able to monitor a Kafka cluster. Here are 3 monitoring tools we liked:</p>
<p>First one is check_kafka.pl from Hari Sekhon. It performs a complete end to end test, i.e. it inserts a message in Kafka as a producer and then extracts it as a consumer. This makes our life easier when measuring service times.</p>
<p>Another useful tool is KafkaOffsetMonitor for monitoring Kafka consumers and their position (offset) in the queue. It aids our understanding of how our queue grows and which consumers groups are lagging behind.</p>
<p>Last but not least, the LinkedIn folks have developed what we think is the smartest tool out there: Burrow. It analyzes consumer offsets and lags over a window of time and determines the consumer status. You can retrieve this status over an HTTP endpoint and then plug it into your favourite monitoring tool (Server Density for example).</p>
<p>Oh, and we would be amiss if we didn’t mention Yahoo’s Kafka-Manager. While it does include some basic monitoring, it is more of a management tool. If you are just looking for a Kafka management tool, check out AirBnb’s kafkat.</p>
<h1 id="commands"><a href="#commands" class="headerlink" title="commands"></a>commands</h1><h2 id="Start-zookeeper"><a href="#Start-zookeeper" class="headerlink" title="Start zookeeper"></a>Start zookeeper</h2><p>bin/zookeeper-server-start.sh config/zookeeper.properties</p>
<p>bin/kafka-server-start.sh config/server.properties</p>
<p>~/dev/git/kafka-demo/kafka_2.11-2.0.0/bin/kafka-topics.sh –create –zookeeper localhost:2181 –replication-factor 1 –partitions 1 –topic todtest<br> bin/kafka-topics.sh –list –zookeeper localhost:2181<br>bin/kafka-console-producer.sh –broker-list localhost:9092 –topic todtest<br>bin/kafka-console-consumer.sh –bootstrap-server localhost:9092 –topic todtest –from-beginning</p>
<p>bin/kafka-topics.sh –describe –zookeeper localhost:2181 –topic test</p>
<h2 id="list-topics"><a href="#list-topics" class="headerlink" title="list topics"></a>list topics</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./kafka-topics.sh --list --zookeeper localhost:2181</span><br></pre></td></tr></table></figure>

<h2 id="describe-topics"><a href="#describe-topics" class="headerlink" title="describe topics"></a>describe topics</h2><p>./kafka-topics.sh –describe –zookeeper localhost:2181</p>
<h3 id="using-connector"><a href="#using-connector" class="headerlink" title="using connector"></a>using connector</h3><p>bin/connect-standalone.sh config/connect-standalone.properties config/connect-file-source.properties config/connect-file-sink.properties</p>
<p>mvn archetype:generate <br>    -DarchetypeGroupId=org.apache.kafka <br>    -DarchetypeArtifactId=streams-quickstart-java <br>    -DarchetypeVersion=2.0.0 <br>    -DgroupId=io <br>    -DartifactId=todzhang <br>    -Dversion=0.1 <br>    -Dpackage=todzhangapp</p>
<h1 id="Security"><a href="#Security" class="headerlink" title="Security"></a>Security</h1><p>The keystore stores each machine’s own identity. The truststore stores all the certificates that the machine should trust. Importing a certificate into one’s truststore also means trusting all certificates that are signed by that certificate. As the analogy above, trusting the government (CA) also means trusting all passports (certificates) that it has issued. This attribute is called the chain of trust, and it is particularly useful when deploying SSL on a large Kafka cluster. You can sign all certificates in the cluster with a single CA, and have all machines share the same truststore that trusts the CA. That way all machines can authenticate all other machines.</p>
<p>To deploy SSL, the general steps are:</p>
<ul>
<li>Generate the keys and certificates</li>
<li>Create your own Certificate Authority (CA)</li>
<li>Sign the certificate</li>
</ul>
<p>Generate the key and the certificate for each Kafka broker in the cluster. Generate the key into a keystore called kafka.server.keystore so that you can export and sign it later with CA. The keystore file contains the private key of the certificate; therefore, it needs to be kept safely.</p>
<h2 id="With-user-prompts"><a href="#With-user-prompts" class="headerlink" title="With user prompts"></a>With user prompts</h2><p>keytool -keystore kafka.server.keystore.jks -alias localhost -genkey</p>
<h2 id="Without-user-prompts-pass-command-line-arguments"><a href="#Without-user-prompts-pass-command-line-arguments" class="headerlink" title="Without user prompts, pass command line arguments"></a>Without user prompts, pass command line arguments</h2><p>keytool -keystore kafka.server.keystore.jks -alias localhost -validity {validity} -genkey -storepass {keystore-pass} -keypass {key-pass} -dname {distinguished-name} -ext SAN=DNS:{hostname}<br>Ensure that the common name (CN) exactly matches the fully qualified domain name (FQDN) of the server. The client compares the CN with the DNS domain name to ensure that it is indeed connecting to the desired server, not a malicious one. The hostname of the server can also be specified in the Subject Alternative Name (SAN). Since the distinguished name is used as the server principal when SSL is used as the inter-broker security protocol, it is useful to have hostname as a SAN rather than the CN.</p>
<h2 id="Create-your-own-Certificate-Authority-CA"><a href="#Create-your-own-Certificate-Authority-CA" class="headerlink" title="Create your own Certificate Authority (CA)"></a>Create your own Certificate Authority (CA)</h2><p>Generate a CA that is simply a public-private key pair and certificate, and it is intended to sign other certificates.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -x509 -keyout ca-key -out ca-cert -days &#123;validity&#125;</span><br></pre></td></tr></table></figure>

<p>Add the generated CA to the clients’ truststore so that the clients can trust this CA:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -keystore kafka.client.truststore.jks -<span class="built_in">alias</span> CARoot -import -file ca-cert</span><br></pre></td></tr></table></figure>

<p>Add the generated CA to the brokers’ truststore so that the brokers can trust this CA.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -keystore kafka.server.truststore.jks -<span class="built_in">alias</span> CARoot -import -file ca-cert</span><br></pre></td></tr></table></figure>

<h2 id="Sign-the-certificate"><a href="#Sign-the-certificate" class="headerlink" title="Sign the certificate"></a>Sign the certificate</h2><p>To sign all certificates in the keystore with the CA that you generated:</p>
<p>Export the certificate from the keystore:</p>
<p>keytool -keystore kafka.server.keystore.jks -alias localhost -certreq -file cert-file<br>Sign it with the CA:</p>
<p>openssl x509 -req -CA ca-cert -CAkey ca-key -in cert-file -out cert-signed -days {validity} -CAcreateserial -passin pass:{ca-password}<br>Import both the certificate of the CA and the signed certificate into the broker keystore:</p>
<p>keytool -keystore kafka.server.keystore.jks -alias CARoot -import -file ca-cert<br>keytool -keystore kafka.server.keystore.jks -alias localhost -import -file cert-signed</p>
<h2 id="SASL"><a href="#SASL" class="headerlink" title="SASL"></a>SASL</h2><p>Simple Authentication and Security Layer (SASL) is a framework for authentication and data security in Internet protocols. It decouples authentication mechanisms from application protocols, in theory allowing any authentication mechanism supported by SASL to be used in any application protocol that uses SASL. Authentication mechanisms can also support proxy authorization, a facility allowing one user to assume the identity of another. They can also provide a data security layer offering data integrity and data confidentiality services. DIGEST-MD5 provides an example of mechanisms which can provide a data-security layer. Application protocols that support SASL typically also support Transport Layer Security (TLS) to complement the services offered by SASL.</p>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ul>
<li><a href="https://blog.serverdensity.com/how-to-monitor-kafka/" target="_blank" rel="noopener">https://blog.serverdensity.com/how-to-monitor-kafka/</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.todzhang.com/2018-08-16-Kafka/" data-id="cjxaajrsb0076bhq1da05rhwl" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/12/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="page-number" href="/page/12/">12</a><span class="page-number current">13</span><a class="page-number" href="/page/14/">14</a><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/14/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AS400/">AS400</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AWS/">AWS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Angular/">Angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Apache/">Apache</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Architect/">Architect</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BA/">BA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BigData/">BigData</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CAS/">CAS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CI/">CI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CTO/">CTO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Camel/">Camel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cloud/">Cloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Coding/">Coding</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Collections/">Collections</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Concurrent/">Concurrent</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cryptography/">Cryptography</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DB/">DB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Data-Science/">Data Science</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DeepLearning/">DeepLearning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dev/">Dev</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DevOps/">DevOps</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/">Docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Eclipse/">Eclipse</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Efficiency/">Efficiency</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Equity/">Equity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FX/">FX</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FacialRecognition/">FacialRecognition</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Finance/">Finance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Financial/">Financial</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GC/">GC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GitPages/">GitPages</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Global-Market/">Global Market</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Haddop/">Haddop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IBM-Personal-Communications/">IBM Personal Communications</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IO/">IO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JIT/">JIT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/">JVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jboss/">Jboss</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JetBrains/">JetBrains</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MQ/">MQ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MTF/">MTF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mac/">Mac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MachineLearning/">MachineLearning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Microservices/">Microservices</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mifid/">Mifid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mint/">Mint</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MobileInternet/">MobileInternet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MyBlog/">MyBlog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NavigableMap/">NavigableMap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NodeJs/">NodeJs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenShift/">OpenShift</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenStack/">OpenStack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Openshift/">Openshift</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Protocols/">Protocols</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Questions/">Questions</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/R/">R</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RESTul/">RESTul</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RMB/">RMB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RxJS/">RxJS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SFTP/">SFTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SOA/">SOA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL/">SQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSH/">SSH</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sharding/">Sharding</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spark/">Spark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Storm/">Storm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP/">TCP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WAS/">WAS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebSphere/">WebSphere</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XA/">XA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/angular/">angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/anugar/">anugar</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blockchain/">blockchain</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/class-loader/">class loader`</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cloud/">cloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/clud/">clud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/compare/">compare</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/concurrent/">concurrent</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/data-strucutre/">data strucutre</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/database/">database</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dead-lock/">dead lock</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/desgin/">desgin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/development/">development</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/efficiency/">efficiency</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elasticsearch/">elasticsearch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/enum/">enum</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ethereum/">ethereum</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/finance/">finance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fund/">fund</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hashcode/">hashcode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/heavy-load/">heavy load</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hyperledger/">hyperledger</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS/">iOS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/intelliJ/">intelliJ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/">maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mobile-internet/">mobile internet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ngrx/">ngrx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/">node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/">nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/principals/">principals</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/programming/">programming</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rfc/">rfc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rxjs/">rxjs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scraphy/">scraphy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/security/">security</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/serialVersionUID/">serialVersionUID</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shortcut/">shortcut</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/source-code/">source code</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring/">spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/swift/">swift</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tag/">tag</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/testing/">testing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/typescript/">typescript</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/AS400/" style="font-size: 10px;">AS400</a> <a href="/tags/AWS/" style="font-size: 10px;">AWS</a> <a href="/tags/Angular/" style="font-size: 18px;">Angular</a> <a href="/tags/Apache/" style="font-size: 12px;">Apache</a> <a href="/tags/Architect/" style="font-size: 12px;">Architect</a> <a href="/tags/BA/" style="font-size: 10px;">BA</a> <a href="/tags/BigData/" style="font-size: 10px;">BigData</a> <a href="/tags/CAS/" style="font-size: 10px;">CAS</a> <a href="/tags/CI/" style="font-size: 10px;">CI</a> <a href="/tags/CTO/" style="font-size: 12px;">CTO</a> <a href="/tags/Camel/" style="font-size: 10px;">Camel</a> <a href="/tags/Cloud/" style="font-size: 10px;">Cloud</a> <a href="/tags/Coding/" style="font-size: 15px;">Coding</a> <a href="/tags/Collections/" style="font-size: 10px;">Collections</a> <a href="/tags/Concurrent/" style="font-size: 11px;">Concurrent</a> <a href="/tags/Cryptography/" style="font-size: 10px;">Cryptography</a> <a href="/tags/DB/" style="font-size: 11px;">DB</a> <a href="/tags/Data-Science/" style="font-size: 10px;">Data Science</a> <a href="/tags/DeepLearning/" style="font-size: 11px;">DeepLearning</a> <a href="/tags/Dev/" style="font-size: 10px;">Dev</a> <a href="/tags/DevOps/" style="font-size: 19px;">DevOps</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/Eclipse/" style="font-size: 10px;">Eclipse</a> <a href="/tags/Efficiency/" style="font-size: 10px;">Efficiency</a> <a href="/tags/Equity/" style="font-size: 10px;">Equity</a> <a href="/tags/FX/" style="font-size: 11px;">FX</a> <a href="/tags/FacialRecognition/" style="font-size: 11px;">FacialRecognition</a> <a href="/tags/Finance/" style="font-size: 10px;">Finance</a> <a href="/tags/Financial/" style="font-size: 10px;">Financial</a> <a href="/tags/GC/" style="font-size: 10px;">GC</a> <a href="/tags/Git/" style="font-size: 13px;">Git</a> <a href="/tags/GitPages/" style="font-size: 11px;">GitPages</a> <a href="/tags/Global-Market/" style="font-size: 10px;">Global Market</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/Haddop/" style="font-size: 10px;">Haddop</a> <a href="/tags/IBM-Personal-Communications/" style="font-size: 10px;">IBM Personal Communications</a> <a href="/tags/IO/" style="font-size: 10px;">IO</a> <a href="/tags/JIT/" style="font-size: 10px;">JIT</a> <a href="/tags/JVM/" style="font-size: 10px;">JVM</a> <a href="/tags/Java/" style="font-size: 18px;">Java</a> <a href="/tags/JavaScript/" style="font-size: 16px;">JavaScript</a> <a href="/tags/Jboss/" style="font-size: 10px;">Jboss</a> <a href="/tags/JetBrains/" style="font-size: 10px;">JetBrains</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/MQ/" style="font-size: 10px;">MQ</a> <a href="/tags/MTF/" style="font-size: 10px;">MTF</a> <a href="/tags/Mac/" style="font-size: 11px;">Mac</a> <a href="/tags/MachineLearning/" style="font-size: 10px;">MachineLearning</a> <a href="/tags/Microservices/" style="font-size: 10px;">Microservices</a> <a href="/tags/Mifid/" style="font-size: 10px;">Mifid</a> <a href="/tags/Mint/" style="font-size: 10px;">Mint</a> <a href="/tags/MobileInternet/" style="font-size: 15px;">MobileInternet</a> <a href="/tags/MyBlog/" style="font-size: 17px;">MyBlog</a> <a href="/tags/NavigableMap/" style="font-size: 10px;">NavigableMap</a> <a href="/tags/NodeJs/" style="font-size: 14px;">NodeJs</a> <a href="/tags/OpenShift/" style="font-size: 10px;">OpenShift</a> <a href="/tags/OpenStack/" style="font-size: 10px;">OpenStack</a> <a href="/tags/Openshift/" style="font-size: 10px;">Openshift</a> <a href="/tags/Protocols/" style="font-size: 10px;">Protocols</a> <a href="/tags/Python/" style="font-size: 11px;">Python</a> <a href="/tags/Questions/" style="font-size: 11px;">Questions</a> <a href="/tags/R/" style="font-size: 10px;">R</a> <a href="/tags/RESTul/" style="font-size: 10px;">RESTul</a> <a href="/tags/RMB/" style="font-size: 10px;">RMB</a> <a href="/tags/RxJS/" style="font-size: 10px;">RxJS</a> <a href="/tags/SFTP/" style="font-size: 10px;">SFTP</a> <a href="/tags/SOA/" style="font-size: 10px;">SOA</a> <a href="/tags/SQL/" style="font-size: 10px;">SQL</a> <a href="/tags/SSH/" style="font-size: 10px;">SSH</a> <a href="/tags/Sharding/" style="font-size: 10px;">Sharding</a> <a href="/tags/Spark/" style="font-size: 10px;">Spark</a> <a href="/tags/Storm/" style="font-size: 10px;">Storm</a> <a href="/tags/TCP/" style="font-size: 10px;">TCP</a> <a href="/tags/WAS/" style="font-size: 10px;">WAS</a> <a href="/tags/WebSphere/" style="font-size: 10px;">WebSphere</a> <a href="/tags/XA/" style="font-size: 10px;">XA</a> <a href="/tags/angular/" style="font-size: 12px;">angular</a> <a href="/tags/anugar/" style="font-size: 10px;">anugar</a> <a href="/tags/blockchain/" style="font-size: 12px;">blockchain</a> <a href="/tags/class-loader/" style="font-size: 10px;">class loader`</a> <a href="/tags/cloud/" style="font-size: 12px;">cloud</a> <a href="/tags/clud/" style="font-size: 10px;">clud</a> <a href="/tags/compare/" style="font-size: 10px;">compare</a> <a href="/tags/concurrent/" style="font-size: 10px;">concurrent</a> <a href="/tags/data-strucutre/" style="font-size: 10px;">data strucutre</a> <a href="/tags/database/" style="font-size: 10px;">database</a> <a href="/tags/dead-lock/" style="font-size: 10px;">dead lock</a> <a href="/tags/desgin/" style="font-size: 10px;">desgin</a> <a href="/tags/development/" style="font-size: 10px;">development</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/efficiency/" style="font-size: 10px;">efficiency</a> <a href="/tags/elasticsearch/" style="font-size: 11px;">elasticsearch</a> <a href="/tags/enum/" style="font-size: 10px;">enum</a> <a href="/tags/ethereum/" style="font-size: 10px;">ethereum</a> <a href="/tags/finance/" style="font-size: 10px;">finance</a> <a href="/tags/fund/" style="font-size: 10px;">fund</a> <a href="/tags/hashcode/" style="font-size: 10px;">hashcode</a> <a href="/tags/heavy-load/" style="font-size: 10px;">heavy load</a> <a href="/tags/http/" style="font-size: 10px;">http</a> <a href="/tags/hyperledger/" style="font-size: 11px;">hyperledger</a> <a href="/tags/iOS/" style="font-size: 10px;">iOS</a> <a href="/tags/intelliJ/" style="font-size: 10px;">intelliJ</a> <a href="/tags/java/" style="font-size: 20px;">java</a> <a href="/tags/javascript/" style="font-size: 14px;">javascript</a> <a href="/tags/maven/" style="font-size: 10px;">maven</a> <a href="/tags/mobile-internet/" style="font-size: 10px;">mobile internet</a> <a href="/tags/ngrx/" style="font-size: 10px;">ngrx</a> <a href="/tags/node/" style="font-size: 10px;">node</a> <a href="/tags/nodejs/" style="font-size: 11px;">nodejs</a> <a href="/tags/principals/" style="font-size: 10px;">principals</a> <a href="/tags/programming/" style="font-size: 10px;">programming</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/rfc/" style="font-size: 10px;">rfc</a> <a href="/tags/rxjs/" style="font-size: 10px;">rxjs</a> <a href="/tags/scraphy/" style="font-size: 10px;">scraphy</a> <a href="/tags/security/" style="font-size: 10px;">security</a> <a href="/tags/serialVersionUID/" style="font-size: 10px;">serialVersionUID</a> <a href="/tags/shortcut/" style="font-size: 11px;">shortcut</a> <a href="/tags/source-code/" style="font-size: 10px;">source code</a> <a href="/tags/spring/" style="font-size: 10px;">spring</a> <a href="/tags/swift/" style="font-size: 10px;">swift</a> <a href="/tags/tag/" style="font-size: 10px;">tag</a> <a href="/tags/testing/" style="font-size: 10px;">testing</a> <a href="/tags/typescript/" style="font-size: 10px;">typescript</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2007/04/">April 2007</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018-06-12-KDB/">KDB</a>
          </li>
        
          <li>
            <a href="/2019-02-26-TLS-SSL-HTTPS/">SSL certificates</a>
          </li>
        
          <li>
            <a href="/2016-09-01-Mac-Tips/">Mac tips</a>
          </li>
        
          <li>
            <a href="/2018-11-01-seconds/">Seconds</a>
          </li>
        
          <li>
            <a href="/2016-02-25-Java-Class-Loader/">Java Class Loader</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Todd Zhang<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>